try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="d1f5edf1-b800-4f12-9cc9-eddfda223615",e._sentryDebugIdIdentifier="sentry-dbid-d1f5edf1-b800-4f12-9cc9-eddfda223615")}catch(e){}("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{}).SENTRY_RELEASE={id:"landing-client-rspack-arm64@16bbc019b29226c9a21b14bfc04acd34ef160b9c"},(self.webpackChunk=self.webpackChunk||[]).push([["4795"],{83395:function(e,t,n){"use strict";n.d(t,{BH:()=>d,G6:()=>I,L:()=>o,LL:()=>S,Pz:()=>h,Sg:()=>f,UG:()=>g,ZB:()=>function e(t,n){if(!(n instanceof Object))return n;switch(n.constructor){case Date:return new Date(n.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return n}for(let r in n)n.hasOwnProperty(r)&&"__proto__"!==r&&(t[r]=e(t[r],n[r]));return t},ZR:()=>T,aH:()=>c,b$:()=>w,eu:()=>E,hl:()=>_,jU:()=>y,m9:()=>M,ne:()=>O,pd:()=>x,r3:()=>A,ru:()=>v,tV:()=>l,uI:()=>m,vZ:()=>function e(t,n){if(t===n)return!0;let r=Object.keys(t),i=Object.keys(n);for(let s of r){if(!i.includes(s))return!1;let r=t[s],a=n[s];if(D(r)&&D(a)){if(!e(r,a))return!1}else if(r!==a)return!1}for(let e of i)if(!r.includes(e))return!1;return!0},w1:()=>b,xO:()=>N,xb:()=>C,z$:()=>p,zd:()=>R});let r=function(e){let t=[],n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:((64512&i)==55296&&r+1<e.length&&(64512&e.charCodeAt(r+1))==56320?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128):t[n++]=i>>12|224,t[n++]=i>>6&63|128),t[n++]=63&i|128)}return t},i=function(e){let t=[],n=0,r=0;for(;n<e.length;){let i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){let s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){let s=e[n++],a=((7&i)<<18|(63&s)<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(a>>10)),t[r++]=String.fromCharCode(56320+(1023&a))}else{let s=e[n++],a=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&a)}}return t.join("")},s={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){let i=e[t],s=t+1<e.length,a=s?e[t+1]:0,o=t+2<e.length,l=o?e[t+2]:0,u=i>>2,c=(3&i)<<4|a>>4,h=(15&a)<<2|l>>6,d=63&l;!o&&(d=64,s||(h=64)),r.push(n[u],n[c],n[h],n[d])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(r(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):i(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let t=0;t<e.length;){let i=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0,a=++t<e.length?n[e.charAt(t)]:64,o=++t<e.length?n[e.charAt(t)]:64;if(++t,null==i||null==s||null==a||null==o)throw Error();let l=i<<2|s>>4;if(r.push(l),64!==a){let e=s<<4&240|a>>2;if(r.push(e),64!==o){let e=a<<6&192|o;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},a=function(e){let t=r(e);return s.encodeByteArray(t,!0)},o=function(e){return a(e).replace(/\./g,"")},l=function(e){try{return s.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null},u=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n.g)return n.g;throw Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process)return;let e=void 0;if(e)return JSON.parse(e)})()||(()=>{let e;if("undefined"==typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&l(e[1]);return t&&JSON.parse(t)})()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},c=()=>{var e;return null==(e=u())?void 0:e.config},h=e=>{var t;return null==(t=u())?void 0:t[`_${e}`]};class d{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function f(e,t){if(e.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let s=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[o(JSON.stringify({alg:"none",type:"JWT"})),o(JSON.stringify(s)),""].join(".")}function p(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function m(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(p())}function g(){var e;let t=null==(e=u())?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(e){return!1}}function y(){return"object"==typeof self&&self.self===self}function v(){let e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function w(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function b(){let e=p();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function I(){return!g()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function _(){try{return"object"==typeof indexedDB}catch(e){return!1}}function E(){return new Promise((e,t)=>{try{let n=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null==(e=i.error)?void 0:e.message)||"")}}catch(e){t(e)}})}class T extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,T.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,S.prototype.create)}}class S{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){var n,r;let i=t[0]||{},s=`${this.service}/${e}`,a=this.errors[e],o=a?(n=a,r=i,n.replace(k,(e,t)=>{let n=r[t];return null!=n?String(n):`<${t}?>`})):"Error",l=`${this.serviceName}: ${o} (${s}).`;return new T(s,l,i)}}let k=/\{\$([^}]+)}/g;function A(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function C(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function D(e){return null!==e&&"object"==typeof e}function N(e){let t=[];for(let[n,r]of Object.entries(e))Array.isArray(r)?r.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function R(e){let t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){let[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}}),t}function x(e){let t=e.indexOf("?");if(!t)return"";let n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}function O(e,t){let n=new P(e,t);return n.subscribe.bind(n)}class P{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw Error("Missing Observer.");void 0===(r=!function(e,t){if("object"!=typeof e||null===e)return!1;for(let n of t)if(n in e&&"function"==typeof e[n])return!0;return!1}(e,["next","error","complete"])?{next:e,error:t,complete:n}:e).next&&(r.next=L),void 0===r.error&&(r.error=L),void 0===r.complete&&(r.complete=L);let i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}}),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function L(){}function M(e){return e&&e._delegate?e._delegate:e}},84541:function(e,t,n){"undefined"!=typeof self&&self,e.exports=function(e){var t=[function(t,n){t.exports=e},function(e,t,n){"use strict";n.r(t),n.d(t,"apiReducer",function(){return D}),n.d(t,"combineConfigs",function(){return R}),n.d(t,"middleWare",function(){return y}),n.d(t,"railsActions",function(){return N});let r=0,i=({resourceConfig:e,config:t,defaultConfig:n={}})=>l(e.optimisticUpdateEnabled)?e.optimisticUpdateEnabled:l(t.resources.optimisticUpdateEnabled)?t.resources.optimisticUpdateEnabled:l(t.optimisticUpdateEnabled)?t.optimisticUpdateEnabled:!l(n.optimisticUpdateEnabled)||n.optimisticUpdateEnabled,s=({controller:e})=>"s"===e[e.length-1]?"collection":"member",a=({config:e,resource:t})=>"collection"===s({controller:e.resources[t].controller})?"models":"attributes",o=({config:e,resource:t})=>e.resources[t].idAttribute||"id",l=e=>"boolean"==typeof e,u=({config:e,store:t})=>"function"==typeof e?e(t):e,c={},h={SHOW:"GET",INDEX:"GET",CREATE:"POST",UPDATE:"PUT",DESTROY:"DELETE"},d=(e,t)=>`${e}=${encodeURIComponent(t)}`,f=({store:e,resource:t,railsAction:n,error:r,id:i,cId:s,optimisticUpdateEnabled:a,reject:o})=>{let l={type:`${t}.${n}_ERROR`,error:r,id:i,cId:s},u="CREATE"===n;e.dispatch(l),["CREATE","UPDATE"].includes(n)&&a&&e.dispatch({type:t+".UNSET_OPTIMISTIC_DATA",id:i,cId:s,destroy:u}),o(l)},p=({store:e,resource:t,config:n,data:a={},railsAction:l,controllerOverride:u,fetchParamsOverride:c,queryParamsOverride:y,resolve:v,reject:w})=>{let b,I=n.resources[t],_=I.baseUrl||n.baseUrl,E=u||I.controller,T=o({config:n,resource:t}),S=c||I.fetchParams||n.fetchParams,k=y||I.queryParams||n.queryParams,A=(({railsAction:e,resource:t,config:n,data:r,fetchParams:i={}})=>{let s=h[e],a=new Headers(i.headers||{}),o=Object.assign({},i,{method:s,headers:a});return"object"==typeof r&&"GET"!==s&&(o.body=JSON.stringify(r)),o})({railsAction:l,resource:t,data:a,config:n,fetchParams:S}),C=(({baseUrl:e,controller:t,railsAction:n,data:r,queryParams:i={}})=>{let a,o=s({controller:t}),l=t.includes("/:id/"),u=()=>l||"collection"===o&&"INDEX"!==n&&"CREATE"!==n?"/"+r.id:"",c=((e={},t)=>{let n=Object.keys(e).filter(t=>void 0!==e[t]||null!==e[t]);return 0===n.length||"GET"!==h[t]?"":"?"+n.map(t=>{var n;return Array.isArray(n=e[t])?n.map(e=>d(t+"[]",e)):d(t,n)}).join("&")})(i,n);return a=l?`${e}${t}`.replace("/:id",u()):`${e}${t}${u()}`,`${a}${c}`})({baseUrl:_,controller:E,railsAction:l,data:a,fetchParams:S,queryParams:k}),D=i({resourceConfig:I,config:n});"CREATE"===l&&(b=++r,e.dispatch({type:t+".ASSIGN_CID",cId:b}),e.dispatch({type:t+".SET_LOADING",cId:b})),["CREATE","UPDATE"].includes(l)&&D&&e.dispatch({type:t+".SET_OPTIMISTIC_DATA",id:a.id,cId:b,data:a}),fetch(C,A).then(r=>{r.json().then(i=>{let o=i&&i[T]||a.id;if(!r.ok)return f({store:e,resource:t,railsAction:l,id:o,cId:b,optimisticUpdateEnabled:D,reject:w,error:i.error||{message:r.statusText}});(({store:e,resource:t,railsAction:n,id:r,cId:i,json:a,config:o,controller:l,resolve:u})=>{let c=`${t}.${n}_SUCCESS`,{response:h,metaData:d}=g({json:a,resource:t,config:o,resourceType:s({controller:l})}),f={cId:i,id:r,metaData:d,response:h,type:c};e.dispatch(f),u(f)})({store:e,resource:t,railsAction:l,id:o,cId:b,json:i,config:n,controller:E,optimisticUpdateEnabled:D,resolve:v})}).catch(n=>{f({store:e,resource:t,railsAction:l,error:n&&n.toString&&n.toString(),id:a.id,cId:b,optimisticUpdateEnabled:D,reject:w})})}).catch(n=>{f({store:e,resource:t,railsAction:l,error:n,id:a.id,cId:b,optimisticUpdateEnabled:D,reject:w})}).then(()=>(({resource:e})=>{let t=m({resource:e});t.shift(),t.length>0&&p(t[0])})({resource:t}))},m=({resource:e})=>(c[e]||(c[e]={queue:[]}),c[e].queue),g=({json:e,resource:t,config:n,resourceType:r})=>{let i=n.resources[t].parse,s=n.resources[t].setMetadata,a,o={};switch(typeof i){case"object":{let t=i&&i[r];if(!t){a=e;break}a=t(e);break}case"function":a=i(e);break;default:a=e}switch(typeof s){case"object":{let t=s&&s[r];if(!t)break;o=t(e);break}case"function":o=s(e);break;default:o={}}return{response:a,metaData:o}};var y=e=>t=>n=>r=>{let i=u({config:e,store:t.getState()}),[s,a]=r.type.split("."),{data:o,controller:l,fetchParams:c}=r,{queryParams:d}=o||{},f=i.resources[s];return f&&h[a]?(({action:e,config:t,fetchData:n,next:r,resource:i,resourceConfig:s})=>{let a=new Promise((e,r)=>{let a={resolve:e,reject:r,...n};(t.disableFetchQueueing||s.disableFetchQueueing)&&p(a),((e,t)=>{let n=m({resource:e});n.push(t),n.length<=1&&p(t)})(i,a)});return r(e),a})({action:r,config:i,fetchData:{store:t,resource:s,config:i,data:o,railsAction:a,controllerOverride:l,fetchParamsOverride:c,queryParamsOverride:d},next:n,resource:s,resourceConfig:f}):n(r)},v=n(0);let w={loading:!1,loadingError:void 0,__prevData:void 0},b=({id:e,cId:t,state:n})=>{let r,i;return(n.models&&n.models.slice(0)||[]).find(n=>(r=void 0!==n.id,i=void 0!==t,r&&n.id===e||i&&n.cId===t))},I=({id:e,cId:t,metaData:n,attributes:r={}})=>{let i={id:e,cId:t,attributes:{...r}};return Object.keys(i).forEach(e=>void 0===i[e]?delete i[e]:""),{...w,...n,...i}},_=({metaData:e,models:t=[]})=>({...w,...e,models:t}),E=({state:e,model:t})=>[...e.models||[],t],T=({id:e,cId:t,state:n,updatedModel:r})=>{let i,s;return(n.models&&n.models.slice(0)||[]).map(n=>(i=void 0!==n.id,s=void 0!==t,i&&n.id===e||s&&n.cId===t?r:n))},S=({id:e,data:t,metaData:n,state:r,cId:i,replaceAttributes:s=!0,replaceMeta:a=!0})=>{let o,l=b({id:e,cId:i,state:r});return l?(o=s?t:{...l.attributes,...t},!i&&l.cId&&(i=l.cId),T({id:e,cId:i,state:r,updatedModel:I({id:e,cId:i,metaData:n,attributes:o})})):E({state:r,model:I({id:e,cId:i,metaData:n,attributes:t})})},k=({id:e,cId:t,state:n,queryParams:r})=>{let i=b({id:e,cId:t,state:n});return i?T({id:e,cId:t,state:n,updatedModel:I({id:e,cId:t,metaData:{loading:!0,queryParams:r},attributes:i.attributes})}):E({state:n,model:I({id:e,cId:t,metaData:{loading:!0,queryParams:r}})})},A=({id:e,cId:t,state:n,error:r})=>{let i=b({id:e,cId:t,state:n});return i||e?i?T({id:e,state:n,cId:t,updatedModel:I({...i,metaData:{loadingError:r,__prevData:i.__prevData}})}):E({state:n,model:I({id:e,metaData:{loadingError:r}})}):n.models.slice(0)},C=({config:e,resource:t})=>{let n=a({config:e,resource:t}),r=e.resources[t]||{},i=o({config:e,resource:t});return"attributes"===n?I({id:r[n]?r[i]||r.attributes[i]:void 0,idAttribute:i,attributes:r.attributes}):_({models:(r.models||[]).map(e=>I({idAttribute:i,id:e[i],attributes:e}))})};var D=e=>{let t=u({config:e}),n={};return Object.keys(t.resources).forEach(e=>{n[e]=(n=C({config:t,resource:e}),r={})=>{let i=t.resources[e]||{},s="attributes"===a({config:t,resource:e}),l=o({config:t,resource:e}),{queryParams:u}=r.data||{};switch(r.type){case e+".INDEX":{let{paginated:e}=i;return{...n,..._({metaData:{loading:!0,queryParams:u},models:e?n.models:[]})}}case e+".INDEX_SUCCESS":{let{response:t,metaData:s}=r,a=r.response[e]||r.response[e.toLowerCase()];if(!Array.isArray(r.response)){if(!a||!Array.isArray(a))return console.error("Response to INDEX actions must be of type array OR contain a top-level key matching the resource name with an array as the value. You can use the parse method(s) set in your config for this resource to transform returned data if needed."),{...n,..._({metaData:{loading:!1,loadingError:"Bad data received from server. INDEX calls expect an array."}})};t=a}if(i.paginated){let e=t.reduce((e,t)=>({...e,[t.id]:t}),{}),r=n.models.map(e=>e.attributes),i={};t=[...r.map(t=>e[t.id]?(i[t.id]=!0,e[t.id]):t),...t.filter(e=>!i[e.id])]}return{...n,..._({models:t.map(e=>I({id:e[l],attributes:e})),metaData:s})}}case e+".INDEX_ERROR":{let{error:e}=r;return{...n,..._({metaData:{loading:!1,loadingError:e}})}}case e+".SHOW":{let{id:e}=r.data||{};return s?I({metaData:{loading:!0,queryParams:u},attributes:n.attributes}):{...n,models:k({id:e,state:n,queryParams:u})}}case e+".SHOW_SUCCESS":{let{id:e,response:t,metaData:i}=r;return s?I({id:e,metaData:i,attributes:{...n.attributes,...t}}):{...n,..._({models:S({id:e,data:t,state:n,metaData:{loading:!1,...i}})})}}case e+".SHOW_ERROR":{let{id:e,error:t}=r;return s?I({id:e,attributes:{...n.attributes},metaData:{loadingError:t}}):{...n,models:A({state:n,id:e,error:t})}}case e+".ASSIGN_CID":{let{cId:e}=r;return s?I({cId:e}):_({models:S({cId:e,state:n})})}case e+".CREATE_SUCCESS":{let{cId:e,id:t,response:i,metaData:a}=r;return s?I({id:t,cId:e,attributes:{...n.attributes,...i},metaData:a}):_({models:S({data:i,state:n,id:t,cId:e,metaData:a})})}case e+".CREATE_ERROR":{let{id:e,cId:t,error:i}=r;return s?I({id:e,cId:t,metaData:{loadingError:i}}):{...n,models:A({state:n,id:e,cId:t,error:i})}}case e+".UPDATE":{let{id:e}=r.data||{},t=n.__prevData;return s?I({id:e,metaData:{loading:!0,__prevData:t},attributes:n.attributes}):{...n,models:k({id:e,state:n})}}case e+".UPDATE_SUCCESS":{let{id:e,metaData:t,response:i}=r;return s?I({id:e,attributes:{...n.attributes,...i},metaData:t}):{...n,models:S({id:e,data:i,metaData:t,state:n,replaceAttributes:!1})}}case e+".UPDATE_ERROR":{let{id:e,error:t}=r;return s?I({id:e,attributes:n.attributes,metaData:{loadingError:t}}):{...n,models:A({state:n,id:e,error:t})}}case e+".DESTROY":{let e=(r.data||{}).id||n.id;return s?I({id:e,attributes:n.attributes,metaData:{loading:!0}}):{...n,models:k({idAttribute:l,id:e,state:n})}}case e+".DESTROY_SUCCESS":{let{id:e}=r;return s?null:{...n,models:(({id:e,state:t})=>t.models.filter(t=>t.id!==e))({idAttribute:l,id:e,state:n})}}case e+".DESTROY_ERROR":{let{id:e,error:t}=r;return s?{...n,loading:!1,loadingError:t}:{...n,models:A({state:n,id:e,idAttribute:l,error:t})}}case e+".SET_LOADING":{let{id:e,cId:t}=r;return s?{...n,loading:!0,loadingError:void 0}:{...n,models:k({idAttribute:l,id:e,cId:t,state:n})}}case e+".SET_OPTIMISTIC_DATA":{let{id:e,cId:t,data:i}=r,a=s?n:b({id:e,cId:t,state:n}),o={...a.attributes},l,u={};return Object.keys(w).forEach(e=>{u[e]=a[e]}),l={...u,__prevData:o},s?I({id:e,cId:t,attributes:{...a.attributes,...i},metaData:l}):_({models:S({data:i,state:n,id:e,cId:t,metaData:l})})}case e+".UNSET_OPTIMISTIC_DATA":{let{id:e,cId:t,destroy:i}=r,a=s?n:b({id:e,cId:t,state:n});return i&&s?null:i?{...n,models:(({cId:e,state:t})=>t.models.filter(t=>t.cId!==e))({cId:t,state:n})}:s?I({id:e,cId:t,attributes:a.__prevData}):_({models:S({data:a.__prevData,state:n,id:e,cId:t})})}default:{let i=t.resources[e];return i&&i.reducer?i.reducer(n,r):n}}}}),Object(v.combineReducers)(n)},N={index:({resource:e,controller:t,queryParams:n})=>({type:e+".INDEX",data:{queryParams:n},controller:t}),show:({id:e,resource:t,controller:n,queryParams:r})=>({type:t+".SHOW",data:{id:e,queryParams:r},controller:n}),update:({id:e,attributes:t,resource:n,controller:r})=>({type:n+".UPDATE",data:{id:e,...t},controller:r}),create:({resource:e,attributes:t,controller:n})=>({type:e+".CREATE",data:t,controller:n}),destroy:({id:e,resource:t,controller:n})=>({type:t+".DESTROY",data:{id:e},controller:n})},R=(...e)=>{let t=u({config:e[0]})||{},n=Object.assign({},t,{resources:Object.assign({},t.resources)});return e.map(e=>{let n=u({config:e});if(!n.resources)return;let r={};return Object.keys(n.resources||{}).forEach(e=>{let s=n.resources[e];"baseUrl"===e&&"string"==typeof s||"optimisticUpdateEnabled"===e&&l(s)||(r[e]=Object.assign({},s,{baseUrl:s.baseUrl||n.resources.baseUrl||t.baseUrl,optimisticUpdateEnabled:i({resourceConfig:s,config:n,defaultConfig:t})}))}),r}).filter(e=>void 0!==e).forEach(e=>{Object.keys(e).forEach(t=>{let r=e[t];n.resources[t]=Object.assign({},r)})}),n}}],n={};function r(e){if(n[e])return n[e].exports;var i=n[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=n,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t||4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,(function(t){return e[t]}).bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)}(n(65403))},65403:function(e,t,n){"use strict";n.r(t),n.d(t,{legacy_createStore:()=>h,applyMiddleware:()=>g,combineReducers:()=>d,bindActionCreators:()=>p,createStore:()=>c,__DO_NOT_USE__ActionTypes:()=>u,compose:()=>m});var r=n(89924);function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach(function(t){var i,s;i=t,s=n[t],(i=(0,r.Z)(i))in e?Object.defineProperty(e,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[i]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function a(e){return"Minified Redux error #"+e+"; visit https://redux.js.org/Errors?code="+e+" for the full message or use the non-minified dev environment for full errors. "}var o="function"==typeof Symbol&&Symbol.observable||"@@observable",l=function(){return Math.random().toString(36).substring(7).split("").join(".")},u={INIT:"@@redux/INIT"+l(),REPLACE:"@@redux/REPLACE"+l(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+l()}};function c(e,t,n){if("function"==typeof t&&"function"==typeof n||"function"==typeof n&&"function"==typeof arguments[3])throw Error(a(0));if("function"==typeof t&&void 0===n&&(n=t,t=void 0),void 0!==n){if("function"!=typeof n)throw Error(a(1));return n(c)(e,t)}if("function"!=typeof e)throw Error(a(2));var r,i=e,s=t,l=[],h=l,d=!1;function f(){h===l&&(h=l.slice())}function p(){if(d)throw Error(a(3));return s}function m(e){if("function"!=typeof e)throw Error(a(4));if(d)throw Error(a(5));var t=!0;return f(),h.push(e),function(){if(t){if(d)throw Error(a(6));t=!1,f();var n=h.indexOf(e);h.splice(n,1),l=null}}}function g(e){if(!function(e){if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}(e))throw Error(a(7));if(void 0===e.type)throw Error(a(8));if(d)throw Error(a(9));try{d=!0,s=i(s,e)}finally{d=!1}for(var t=l=h,n=0;n<t.length;n++)(0,t[n])();return e}return g({type:u.INIT}),(r={dispatch:g,subscribe:m,getState:p,replaceReducer:function(e){if("function"!=typeof e)throw Error(a(10));i=e,g({type:u.REPLACE})}})[o]=function(){var e;return(e={subscribe:function(e){if("object"!=typeof e||null===e)throw Error(a(11));function t(){e.next&&e.next(p())}return t(),{unsubscribe:m(t)}}})[o]=function(){return this},e},r}var h=c;function d(e){for(var t,n=Object.keys(e),r={},i=0;i<n.length;i++){var s=n[i];"function"==typeof e[s]&&(r[s]=e[s])}var o=Object.keys(r);try{Object.keys(r).forEach(function(e){var t=r[e];if(void 0===t(void 0,{type:u.INIT}))throw Error(a(12));if(void 0===t(void 0,{type:u.PROBE_UNKNOWN_ACTION()}))throw Error(a(13))})}catch(e){t=e}return function(e,n){if(void 0===e&&(e={}),t)throw t;for(var i=!1,s={},l=0;l<o.length;l++){var u=o[l],c=r[u],h=e[u],d=c(h,n);if(void 0===d)throw n&&n.type,Error(a(14));s[u]=d,i=i||d!==h}return(i=i||o.length!==Object.keys(e).length)?s:e}}function f(e,t){return function(){return t(e.apply(this,arguments))}}function p(e,t){if("function"==typeof e)return f(e,t);if("object"!=typeof e||null===e)throw Error(a(16));var n={};for(var r in e){var i=e[r];"function"==typeof i&&(n[r]=f(i,t))}return n}function m(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return 0===t.length?function(e){return e}:1===t.length?t[0]:t.reduce(function(e,t){return function(){return e(t.apply(void 0,arguments))}})}function g(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return function(){var n=e.apply(void 0,arguments),r=function(){throw Error(a(15))},i={getState:n.getState,dispatch:function(){return r.apply(void 0,arguments)}},o=t.map(function(e){return e(i)});return r=m.apply(void 0,o)(n.dispatch),s(s({},n),{},{dispatch:r})}}}},60985:function(e,t,n){"use strict";function r(e,t){return e===t}n.d(t,{P1:()=>i});var i=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return function(){for(var t=arguments.length,r=Array(t),i=0;i<t;i++)r[i]=arguments[i];var s=0,a=r.pop(),o=function(e){var t=Array.isArray(e[0])?e[0]:e;if(!t.every(function(e){return"function"==typeof e}))throw Error("Selector creators expect all input-selectors to be functions, instead received the following types: ["+t.map(function(e){return typeof e}).join(", ")+"]");return t}(r),l=e.apply(void 0,[function(){return s++,a.apply(null,arguments)}].concat(n)),u=e(function(){for(var e=[],t=o.length,n=0;n<t;n++)e.push(o[n].apply(null,arguments));return l.apply(null,e)});return u.resultFunc=a,u.dependencies=o,u.recomputations=function(){return s},u.resetRecomputations=function(){return s=0},u}}(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r,n=null,i=null;return function(){return!function(e,t,n){if(null===t||null===n||t.length!==n.length)return!1;for(var r=t.length,i=0;i<r;i++)if(!e(t[i],n[i]))return!1;return!0}(t,n,arguments)&&(i=e.apply(null,arguments)),n=arguments,i}})},99789:function(e,t,n){"use strict";n.d(t,{Z:()=>h});var r=n(83395),i=n(86808),s=n(36513),a=n(13660);class o{constructor(e,t){this._delegate=e,this.firebase=t,(0,s._addComponent)(e,new i.wA("app-compat",()=>this,"PUBLIC")),this.container=e.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this._delegate.automaticDataCollectionEnabled=e}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise(e=>{this._delegate.checkDestroyed(),e()}).then(()=>(this.firebase.INTERNAL.removeApp(this.name),(0,s.deleteApp)(this._delegate)))}_getService(e,t=s._DEFAULT_ENTRY_NAME){var n;this._delegate.checkDestroyed();let r=this._delegate.container.getProvider(e);return r.isInitialized()||(null==(n=r.getComponent())?void 0:n.instantiationMode)!=="EXPLICIT"||r.initialize(),r.getImmediate({identifier:t})}_removeServiceInstance(e,t=s._DEFAULT_ENTRY_NAME){this._delegate.container.getProvider(e).clearInstance(t)}_addComponent(e){(0,s._addComponent)(this._delegate,e)}_addOrOverwriteComponent(e){(0,s._addOrOverwriteComponent)(this._delegate,e)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}let l=new r.LL("app-compat","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."}),u=function e(){let t=function(e){let t={},n={__esModule:!0,initializeApp:function(i,a={}){let o=s.initializeApp(i,a);if((0,r.r3)(t,o.name))return t[o.name];let l=new e(o,n);return t[o.name]=l,l},app:i,registerVersion:s.registerVersion,setLogLevel:s.setLogLevel,onLog:s.onLog,apps:null,SDK_VERSION:s.SDK_VERSION,INTERNAL:{registerComponent:function(t){let a=t.name,o=a.replace("-compat","");if(s._registerComponent(t)&&"PUBLIC"===t.type){let s=(e=i())=>{if("function"!=typeof e[o])throw l.create("invalid-app-argument",{appName:a});return e[o]()};void 0!==t.serviceProps&&(0,r.ZB)(s,t.serviceProps),n[o]=s,e.prototype[o]=function(...e){return this._getService.bind(this,a).apply(this,t.multipleInstances?e:[])}}return"PUBLIC"===t.type?n[o]:null},removeApp:function(e){delete t[e]},useAsService:function(e,t){return"serverAuth"===t?null:t},modularAPIs:s}};function i(e){if(e=e||s._DEFAULT_ENTRY_NAME,!(0,r.r3)(t,e))throw l.create("no-app",{appName:e});return t[e]}return n.default=n,Object.defineProperty(n,"apps",{get:function(){return Object.keys(t).map(e=>t[e])}}),i.App=e,n}(o);return t.INTERNAL=Object.assign(Object.assign({},t.INTERNAL),{createFirebaseNamespace:e,extendNamespace:function(e){(0,r.ZB)(t,e)},createSubscribe:r.ne,ErrorFactory:r.LL,deepExtend:r.ZB}),t}(),c=new a.Yd("@firebase/app-compat");if((0,r.jU)()&&void 0!==self.firebase){c.warn(`
    Warning: Firebase is already defined in the global scope. Please make sure
    Firebase library is only loaded once.
  `);let e=self.firebase.SDK_VERSION;e&&e.indexOf("LITE")>=0&&c.warn(`
    Warning: You are trying to load Firebase while using Firebase Performance standalone script.
    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.
    `)}let h=u;(0,s.registerVersion)("@firebase/app-compat","0.2.3",void 0)},36513:function(e,t,n){"use strict";let r,i,s;n.r(t),n.d(t,{_getProvider:()=>x,FirebaseError:()=>l.ZR,getApp:()=>V,_registerComponent:()=>R,setLogLevel:()=>G,SDK_VERSION:()=>F,_removeServiceInstance:()=>O,registerVersion:()=>j,_DEFAULT_ENTRY_NAME:()=>S,_clearComponents:()=>P,_addComponent:()=>D,_addOrOverwriteComponent:()=>N,_apps:()=>A,initializeApp:()=>U,deleteApp:()=>B,_components:()=>C,getApps:()=>q,onLog:()=>$});var a=n(86808),o=n(13660),l=n(83395);let u=new WeakMap,c=new WeakMap,h=new WeakMap,d=new WeakMap,f=new WeakMap,p={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return c.get(e);if("objectStoreNames"===t)return e.objectStoreNames||h.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return m(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function m(e){if(e instanceof IDBRequest){let t=new Promise((t,n)=>{let r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(m(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",s)});return t.then(t=>{t instanceof IDBCursor&&u.set(t,e)}).catch(()=>{}),f.set(t,e),t}if(d.has(e))return d.get(e);let t=function(e){if("function"==typeof e)return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(i||(i=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(g(this),t),m(u.get(this))}:function(...t){return m(e.apply(g(this),t))}:function(t,...n){let r=e.call(g(this),t,...n);return h.set(r,t.sort?t.sort():[t]),m(r)};return e instanceof IDBTransaction&&function(e){if(c.has(e))return;let t=new Promise((t,n)=>{let r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});c.set(e,t)}(e),(r||(r=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(t=>e instanceof t)?new Proxy(e,p):e}(e);return t!==e&&(d.set(e,t),f.set(t,e)),t}let g=e=>f.get(e),y=["get","getKey","getAll","getAllKeys","count"],v=["put","add","delete","clear"],w=new Map;function b(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(w.get(t))return w.get(t);let n=t.replace(/FromIndex$/,""),r=t!==n,i=v.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||y.includes(n)))return;let s=async function(e,...t){let s=this.transaction(e,i?"readwrite":"readonly"),a=s.store;return r&&(a=a.index(t.shift())),(await Promise.all([a[n](...t),i&&s.done]))[0]};return w.set(t,s),s}p={...s=p,get:(e,t,n)=>b(e,t)||s.get(e,t,n),has:(e,t)=>!!b(e,t)||s.has(e,t)};class I{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(!function(e){let t=e.getComponent();return(null==t?void 0:t.type)==="VERSION"}(e))return null;{let t=e.getImmediate();return`${t.library}/${t.version}`}}).filter(e=>e).join(" ")}}let _="@firebase/app",E="0.9.3",T=new o.Yd("@firebase/app"),S="[DEFAULT]",k={[_]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},A=new Map,C=new Map;function D(e,t){try{e.container.addComponent(t)}catch(n){T.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function N(e,t){e.container.addOrOverwriteComponent(t)}function R(e){let t=e.name;if(C.has(t))return T.debug(`There were multiple attempts to register component ${t}.`),!1;for(let n of(C.set(t,e),A.values()))D(n,e);return!0}function x(e,t){let n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function O(e,t,n=S){x(e,t).clearInstance(n)}function P(){C.clear()}let L=new l.LL("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class M{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new a.wA("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw L.create("app-deleted",{appName:this._name})}}let F="9.17.1";function U(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});let r=Object.assign({name:S,automaticDataCollectionEnabled:!1},t),i=r.name;if("string"!=typeof i||!i)throw L.create("bad-app-name",{appName:String(i)});if(n||(n=(0,l.aH)()),!n)throw L.create("no-options");let s=A.get(i);if(s)if((0,l.vZ)(n,s.options)&&(0,l.vZ)(r,s.config))return s;else throw L.create("duplicate-app",{appName:i});let o=new a.H0(i);for(let e of C.values())o.addComponent(e);let u=new M(n,r,o);return A.set(i,u),u}function V(e=S){let t=A.get(e);if(!t&&e===S)return U();if(!t)throw L.create("no-app",{appName:e});return t}function q(){return Array.from(A.values())}async function B(e){let t=e.name;A.has(t)&&(A.delete(t),await Promise.all(e.container.getProviders().map(e=>e.delete())),e.isDeleted=!0)}function j(e,t,n){var r;let i=null!=(r=k[e])?r:e;n&&(i+=`-${n}`);let s=i.match(/\s|\//),o=t.match(/\s|\//);if(s||o){let e=[`Unable to register library "${i}" with version "${t}":`];s&&e.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),T.warn(e.join(" "));return}R(new a.wA(`${i}-version`,()=>({library:i,version:t}),"VERSION"))}function $(e,t){if(null!==e&&"function"!=typeof e)throw L.create("invalid-log-argument");(0,o.Am)(e,t)}function G(e){(0,o.Ub)(e)}let K="firebase-heartbeat-store",z=null;function W(){return z||(z=(function(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){let a=indexedDB.open(e,1),o=m(a);return r&&a.addEventListener("upgradeneeded",e=>{r(m(a.result),e.oldVersion,e.newVersion,m(a.transaction))}),n&&a.addEventListener("blocked",()=>n()),o.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",()=>i())}).catch(()=>{}),o})("firebase-heartbeat-database",0,{upgrade:(e,t)=>{0===t&&e.createObjectStore(K)}}).catch(e=>{throw L.create("idb-open",{originalErrorMessage:e.message})})),z}async function H(e){try{return(await W()).transaction(K).objectStore(K).get(Y(e))}catch(e){if(e instanceof l.ZR)T.warn(e.message);else{let t=L.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});T.warn(t.message)}}}async function Q(e,t){try{let n=(await W()).transaction(K,"readwrite"),r=n.objectStore(K);return await r.put(t,Y(e)),n.done}catch(e){if(e instanceof l.ZR)T.warn(e.message);else{let t=L.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});T.warn(t.message)}}}function Y(e){return`${e.name}!${e.options.appId}`}class X{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new Z(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){let e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=J();return(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate===t||this._heartbeatsCache.heartbeats.some(e=>e.date===t))?void 0:(this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(e=>{let t=new Date(e.date).valueOf();return Date.now()-t<=2592e6}),this._storage.overwrite(this._heartbeatsCache))}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";let e=J(),{heartbeatsToSend:t,unsentEntries:n}=function(e,t=1024){let n=[],r=e.slice();for(let i of e){let e=n.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),ee(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),ee(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),r=(0,l.L)(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}}function J(){return new Date().toISOString().substring(0,10)}class Z{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!(0,l.hl)()&&(0,l.eu)().then(()=>!0).catch(()=>!1)}async read(){return await this._canUseIndexedDBPromise&&await H(this.app)||{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){let n=await this.read();return Q(this.app,{lastSentHeartbeatDate:null!=(t=e.lastSentHeartbeatDate)?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){let n=await this.read();return Q(this.app,{lastSentHeartbeatDate:null!=(t=e.lastSentHeartbeatDate)?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function ee(e){return(0,l.L)(JSON.stringify({version:2,heartbeats:e})).length}R(new a.wA("platform-logger",e=>new I(e),"PRIVATE")),R(new a.wA("heartbeat",e=>new X(e),"PRIVATE")),j(_,E,""),j(_,E,"esm2017"),j("fire-js","")},86808:function(e,t,n){"use strict";n.d(t,{H0:()=>o,wA:()=>i});var r=n(83395);class i{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}let s="[DEFAULT]";class a{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let e=new r.BH;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{let n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;let n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!=(t=null==e?void 0:e.optional)&&t;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(r)return null;throw e}if(r)return null;throw Error(`Service ${this.name} is not available`)}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:s})}catch(e){}for(let[e,t]of this.instancesDeferred.entries()){let n=this.normalizeInstanceIdentifier(e);try{let e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=s){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=s){return this.instances.has(e)}getOptions(e=s){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(let[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(r);return r}onInit(e,t){var n;let r=this.normalizeInstanceIdentifier(t),i=null!=(n=this.onInitCallbacks.get(r))?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);let s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){let n=this.onInitCallbacks.get(t);if(n)for(let r of n)try{r(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){var n;let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:(n=e)===s?void 0:n,options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch(e){}return r||null}normalizeInstanceIdentifier(e=s){return this.component?this.component.multipleInstances?e:s:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class o{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new a(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}},13660:function(e,t,n){"use strict";var r,i;n.d(t,{Am:()=>d,Ub:()=>h,Yd:()=>c,in:()=>r});let s=[];(i=r||(r={}))[i.DEBUG=0]="DEBUG",i[i.VERBOSE=1]="VERBOSE",i[i.INFO=2]="INFO",i[i.WARN=3]="WARN",i[i.ERROR=4]="ERROR",i[i.SILENT=5]="SILENT";let a={debug:r.DEBUG,verbose:r.VERBOSE,info:r.INFO,warn:r.WARN,error:r.ERROR,silent:r.SILENT},o=r.INFO,l={[r.DEBUG]:"log",[r.VERBOSE]:"log",[r.INFO]:"info",[r.WARN]:"warn",[r.ERROR]:"error"},u=(e,t,...n)=>{if(t<e.logLevel)return;let r=new Date().toISOString(),i=l[t];if(i)console[i](`[${r}]  ${e.name}:`,...n);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class c{constructor(e){this.name=e,this._logLevel=o,this._logHandler=u,this._userLogHandler=null,s.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in r))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?a[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,r.DEBUG,...e),this._logHandler(this,r.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,r.VERBOSE,...e),this._logHandler(this,r.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,r.INFO,...e),this._logHandler(this,r.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,r.WARN,...e),this._logHandler(this,r.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,r.ERROR,...e),this._logHandler(this,r.ERROR,...e)}}function h(e){s.forEach(t=>{t.setLogLevel(e)})}function d(e,t){for(let n of s){let i=null;t&&t.level&&(i=a[t.level]),null===e?n.userLogHandler=null:n.userLogHandler=(t,n,...s)=>{let a=s.map(e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}}).filter(e=>e).join(" ");n>=(null!=i?i:t.logLevel)&&e({level:r[n].toLowerCase(),message:a,args:s,type:t.name})}}}},34732:function(e,t,n){"use strict";n.d(t,{Z:()=>r.Z});var r=n(99789);r.Z.registerVersion("firebase","9.17.1","app-compat")},5996:function(e,t,n){"use strict";var r,i,s=n(99789),a=n(83395),o=n(36513),l=n(13660),u=n(85452),c=n(86808);function h(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}let d=function(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance."}},f=new a.LL("auth","Firebase",h()),p=new l.Yd("@firebase/auth");function m(e,...t){p.logLevel<=l.in.ERROR&&p.error(`Auth (${o.SDK_VERSION}): ${e}`,...t)}function g(e,...t){throw b(e,...t)}function y(e,...t){return b(e,...t)}function v(e,t,n){let r=Object.assign(Object.assign({},h()),{[t]:n});return new a.LL("auth","Firebase",r).create(t,{appName:e.name})}function w(e,t,n){if(!(t instanceof n))throw n.name!==t.constructor.name&&g(e,"argument-error"),v(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function b(e,...t){if("string"!=typeof e){let n=t[0],r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}return f.create(e,...t)}function I(e,t,...n){if(!e)throw b(t,...n)}function _(e){let t="INTERNAL ASSERTION FAILED: "+e;throw m(t),Error(t)}let E=new Map;function T(e){var t,n;t="Expected a class definition",e instanceof Function||_(t);let r=E.get(e);return r?(n="Instance stored in cache mismatched with class",r instanceof e||_(n)):(r=new e,E.set(e,r)),r}function S(){var e;return"undefined"!=typeof self&&(null==(e=self.location)?void 0:e.href)||""}function k(){return"http:"===A()||"https:"===A()}function A(){var e;return"undefined"!=typeof self&&(null==(e=self.location)?void 0:e.protocol)||null}class C{constructor(e,t){var n;this.shortDelay=e,this.longDelay=t,n="Short delay should be less than long delay!",t>e||_(n),this.isMobile=(0,a.uI)()||(0,a.b$)()}get(){return!("undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(k()||(0,a.ru)()||"connection"in navigator))||navigator.onLine?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function D(e,t){var n,r;n=e.emulator,r="Emulator should always be set here",n||_(r);let{url:i}=e.emulator;return t?`${i}${t.startsWith("/")?t.slice(1):t}`:i}class N{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:void _("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:void _("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:void _("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}let R={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"},x=new C(3e4,6e4);function O(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function P(e,t,n,r,i={}){return L(e,i,async()=>{let i={},s={};r&&("GET"===t?s=r:i={body:JSON.stringify(r)});let o=(0,a.xO)(Object.assign({key:e.config.apiKey},s)).slice(1),l=await e._getAdditionalHeaders();return l["Content-Type"]="application/json",e.languageCode&&(l["X-Firebase-Locale"]=e.languageCode),N.fetch()(F(e,e.config.apiHost,n,o),Object.assign({method:t,headers:l,referrerPolicy:"no-referrer"},i))})}async function L(e,t,n){e._canInitEmulator=!1;let r=Object.assign(Object.assign({},R),t);try{let t=new U(e),i=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();let s=await i.json();if("needConfirmation"in s)throw V(e,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{let[t,n]=(i.ok?s.errorMessage:s.error.message).split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===t)throw V(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===t)throw V(e,"email-already-in-use",s);if("USER_DISABLED"===t)throw V(e,"user-disabled",s);let a=r[t]||t.toLowerCase().replace(/[_\s]+/g,"-");if(n)throw v(e,a,n);g(e,a)}}catch(t){if(t instanceof a.ZR)throw t;g(e,"network-request-failed")}}async function M(e,t,n,r,i={}){let s=await P(e,t,n,r,i);return"mfaPendingCredential"in s&&g(e,"multi-factor-auth-required",{_serverResponse:s}),s}function F(e,t,n,r){let i=`${t}${n}?${r}`;return e.config.emulator?D(e.config,i):`${e.config.apiScheme}://${i}`}class U{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(y(this.auth,"network-request-failed")),x.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function V(e,t,n){let r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);let i=y(e,t,r);return i.customData._tokenResponse=n,i}async function q(e,t){return P(e,"POST","/v1/accounts:delete",t)}async function B(e,t){return P(e,"POST","/v1/accounts:update",t)}async function j(e,t){return P(e,"POST","/v1/accounts:lookup",t)}function $(e){if(e)try{let t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}async function G(e,t=!1){let n=(0,a.m9)(e),r=await n.getIdToken(t),i=z(r);I(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");let s="object"==typeof i.firebase?i.firebase:void 0,o=null==s?void 0:s.sign_in_provider;return{claims:i,token:r,authTime:$(K(i.auth_time)),issuedAtTime:$(K(i.iat)),expirationTime:$(K(i.exp)),signInProvider:o||null,signInSecondFactor:(null==s?void 0:s.sign_in_second_factor)||null}}function K(e){return 1e3*Number(e)}function z(e){let[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return m("JWT malformed, contained fewer than 3 sections"),null;try{let e=(0,a.tV)(n);if(!e)return m("Failed to decode base64 JWT payload"),null;return JSON.parse(e)}catch(e){return m("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}async function W(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof a.ZR&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class H{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(!e)return this.errorBackoff=3e4,Math.max(0,(null!=(t=this.user.stsTokenManager.expirationTime)?t:0)-Date.now()-3e5);{let e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(null==e?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class Q{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=$(this.lastLoginAt),this.creationTime=$(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Y(e){var t,n,r;let i=e.auth,s=await e.getIdToken(),a=await W(e,j(i,{idToken:s}));I(null==a?void 0:a.users.length,i,"internal-error");let o=a.users[0];e._notifyReloadListener(o);let l=(null==(t=o.providerUserInfo)?void 0:t.length)?o.providerUserInfo.map(e=>{var{providerId:t}=e,n=(0,u._T)(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}}):[],c=(n=e.providerData,r=l,[...n.filter(e=>!r.some(t=>t.providerId===e.providerId)),...r]),h=e.isAnonymous,d=!(e.email&&o.passwordHash)&&!(null==c?void 0:c.length);Object.assign(e,{uid:o.localId,displayName:o.displayName||null,photoURL:o.photoUrl||null,email:o.email||null,emailVerified:o.emailVerified||!1,phoneNumber:o.phoneNumber||null,tenantId:o.tenantId||null,providerData:c,metadata:new Q(o.createdAt,o.lastLoginAt),isAnonymous:!!h&&d})}async function X(e){let t=(0,a.m9)(e);await Y(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}async function J(e,t){let n=await L(e,{},async()=>{let n=(0,a.xO)({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:i}=e.config,s=F(e,r,"/v1/token",`key=${i}`),o=await e._getAdditionalHeaders();return o["Content-Type"]="application/x-www-form-urlencoded",N.fetch()(s,{method:"POST",headers:o,body:n})});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}class Z{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){I(e.idToken,"internal-error"),I(void 0!==e.idToken,"internal-error"),I(void 0!==e.refreshToken,"internal-error");let t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):function(e){let t=z(e);return I(t,"internal-error"),I(void 0!==t.exp,"internal-error"),I(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}async getToken(e,t=!1){return(I(!this.accessToken||this.refreshToken,e,"user-token-expired"),t||!this.accessToken||this.isExpired)?this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){let{accessToken:n,refreshToken:r,expiresIn:i}=await J(e,t);this.updateTokensAndExpiration(n,r,Number(i))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){let{refreshToken:n,accessToken:r,expirationTime:i}=t,s=new Z;return n&&(I("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),r&&(I("string"==typeof r,"internal-error",{appName:e}),s.accessToken=r),i&&(I("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Z,this.toJSON())}_performRefresh(){return _("not implemented")}}function ee(e,t){I("string"==typeof e||void 0===e,"internal-error",{appName:t})}class et{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,i=(0,u._T)(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new H(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Q(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){let t=await W(this,this.stsTokenManager.getToken(this.auth,e));return I(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return G(this,e)}reload(){return X(this)}_assign(e){this!==e&&(I(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>Object.assign({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){return new et(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(e){I(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await Y(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){let e=await this.getIdToken();return await W(this,q(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,r,i,s,a,o,l,u;let c=null!=(n=t.displayName)?n:void 0,h=null!=(r=t.email)?r:void 0,d=null!=(i=t.phoneNumber)?i:void 0,f=null!=(s=t.photoURL)?s:void 0,p=null!=(a=t.tenantId)?a:void 0,m=null!=(o=t._redirectEventId)?o:void 0,g=null!=(l=t.createdAt)?l:void 0,y=null!=(u=t.lastLoginAt)?u:void 0,{uid:v,emailVerified:w,isAnonymous:b,providerData:_,stsTokenManager:E}=t;I(v&&E,e,"internal-error");let T=Z.fromJSON(this.name,E);I("string"==typeof v,e,"internal-error"),ee(c,e.name),ee(h,e.name),I("boolean"==typeof w,e,"internal-error"),I("boolean"==typeof b,e,"internal-error"),ee(d,e.name),ee(f,e.name),ee(p,e.name),ee(m,e.name),ee(g,e.name),ee(y,e.name);let S=new et({uid:v,auth:e,email:h,emailVerified:w,displayName:c,isAnonymous:b,photoURL:f,phoneNumber:d,tenantId:p,stsTokenManager:T,createdAt:g,lastLoginAt:y});return _&&Array.isArray(_)&&(S.providerData=_.map(e=>Object.assign({},e))),m&&(S._redirectEventId=m),S}static async _fromIdTokenResponse(e,t,n=!1){let r=new Z;r.updateFromServerResponse(t);let i=new et({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await Y(i),i}}class en{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){let t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}function er(e,t,n){return`firebase:${e}:${t}:${n}`}en.type="NONE";class ei{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;let{config:r,name:i}=this.auth;this.fullUserKey=er(this.userKey,r.apiKey,i),this.fullPersistenceKey=er("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){let e=await this.persistence._get(this.fullUserKey);return e?et._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;let t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new ei(T(en),e,n);let r=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e),i=r[0]||T(en),s=er(n,e.config.apiKey,e.name),a=null;for(let n of t)try{let t=await n._get(s);if(t){let r=et._fromJSON(e,t);n!==i&&(a=r),i=n;break}}catch(e){}let o=r.filter(e=>e._shouldAllowMigration);return i._shouldAllowMigration&&o.length&&(i=o[0],a&&await i._set(s,a.toJSON()),await Promise.all(t.map(async e=>{if(e!==i)try{await e._remove(s)}catch(e){}}))),new ei(i,e,n)}}function es(e){let t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";{if(eu(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(ea(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(eh(t))return"Blackberry";if(ed(t))return"Webos";if(eo(t))return"Safari";if((t.includes("chrome/")||el(t))&&!t.includes("edge/"))return"Chrome";if(ec(t))return"Android";let n=e.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if((null==n?void 0:n.length)===2)return n[1]}return"Other"}function ea(e=(0,a.z$)()){return/firefox\//i.test(e)}function eo(e=(0,a.z$)()){let t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function el(e=(0,a.z$)()){return/crios\//i.test(e)}function eu(e=(0,a.z$)()){return/iemobile/i.test(e)}function ec(e=(0,a.z$)()){return/android/i.test(e)}function eh(e=(0,a.z$)()){return/blackberry/i.test(e)}function ed(e=(0,a.z$)()){return/webos/i.test(e)}function ef(e=(0,a.z$)()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function ep(e=(0,a.z$)()){return ef(e)||ec(e)||ed(e)||eh(e)||/windows phone/i.test(e)||eu(e)}function em(e,t=[]){let n;switch(e){case"Browser":n=es((0,a.z$)());break;case"Worker":n=`${es((0,a.z$)())}-${e}`;break;default:n=e}let r=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${o.SDK_VERSION}/${r}`}class eg{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let n=t=>new Promise((n,r)=>{try{let r=e(t);n(r)}catch(e){r(e)}});n.onAbort=t,this.queue.push(n);let r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;let t=[];try{for(let n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){for(let e of(t.reverse(),t))try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}class ey{constructor(e,t,n){this.app=e,this.heartbeatServiceProvider=t,this.config=n,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new ew(this),this.idTokenSubscription=new ew(this),this.beforeStateQueue=new eg(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=f,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=n.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=T(t)),this._initializationPromise=this.queue(async()=>{var n,r;if(!this._deleted){if(this.persistenceManager=await ei.create(this,e),!this._deleted){if(null==(n=this._popupRedirectResolver)?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null==(r=this.currentUser)?void 0:r.uid)||null,this._deleted||(this._isInitialized=!0)}}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;let e=await this.assertedPersistence.getCurrentUser();if(this.currentUser||e){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUser(e){var t;let n=await this.assertedPersistence.getCurrentUser(),r=n,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();let n=null==(t=this.redirectUser)?void 0:t._redirectEventId,s=null==r?void 0:r._redirectEventId,a=await this.tryRedirectSignIn(e);(!n||n===s)&&(null==a?void 0:a.user)&&(r=a.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(e){r=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(e))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return(I(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId)?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Y(e)}catch(e){if((null==e?void 0:e.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;let e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){let t=e?(0,a.m9)(e):null;return t&&I(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&I(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue(async()=>{await this.assertedPersistence.setPersistence(T(e))})}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new a.LL("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null==(e=this._currentUser)?void 0:e.toJSON()}}async _setRedirectUser(e,t){let n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){let t=e&&T(e)||this._popupRedirectResolver;I(t,this,"argument-error"),this.redirectPersistenceManager=await ei.create(this,[T(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return(this._isInitialized&&await this.queue(async()=>{}),(null==(t=this._currentUser)?void 0:t._redirectEventId)===e)?this._currentUser:(null==(n=this.redirectUser)?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let n=null!=(t=null==(e=this.currentUser)?void 0:e.uid)?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};let i="function"==typeof t?t:t.next.bind(t),s=this._isInitialized?Promise.resolve():this._initializationPromise;return(I(s,this,"internal-error"),s.then(()=>i(this.currentUser)),"function"==typeof t)?e.addObserver(t,n,r):e.addObserver(t)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return I(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=em(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;let t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);let n=await (null==(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))?void 0:e.getHeartbeatsHeader());return n&&(t["X-Firebase-Client"]=n),t}}function ev(e){return(0,a.m9)(e)}class ew{constructor(e){this.auth=e,this.observer=null,this.addObserver=(0,a.ne)(e=>this.observer=e)}get next(){return I(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function eb(e){let t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function eI(e){if(!e)return null;let t=Number(e);return isNaN(t)?null:t}class e_{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return _("not implemented")}_getIdTokenResponse(e){return _("not implemented")}_linkToIdToken(e,t){return _("not implemented")}_getReauthenticationResolver(e){return _("not implemented")}}async function eE(e,t){return P(e,"POST","/v1/accounts:resetPassword",O(e,t))}async function eT(e,t){return P(e,"POST","/v1/accounts:update",t)}async function eS(e,t){return P(e,"POST","/v1/accounts:update",O(e,t))}async function ek(e,t){return M(e,"POST","/v1/accounts:signInWithPassword",O(e,t))}async function eA(e,t){return P(e,"POST","/v1/accounts:sendOobCode",O(e,t))}async function eC(e,t){return eA(e,t)}async function eD(e,t){return eA(e,t)}async function eN(e,t){return eA(e,t)}async function eR(e,t){return eA(e,t)}async function ex(e,t){return M(e,"POST","/v1/accounts:signInWithEmailLink",O(e,t))}async function eO(e,t){return M(e,"POST","/v1/accounts:signInWithEmailLink",O(e,t))}class eP extends e_{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new eP(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new eP(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){let t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);else if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return ek(e,{returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return ex(e,{email:this._email,oobCode:this._password});default:g(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return eT(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return eO(e,{idToken:t,email:this._email,oobCode:this._password});default:g(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function eL(e,t){return M(e,"POST","/v1/accounts:signInWithIdp",O(e,t))}class eM extends e_{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){let t=new eM(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):g("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){let t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,i=(0,u._T)(t,["providerId","signInMethod"]);if(!n||!r)return null;let s=new eM(n,r);return s.idToken=i.idToken||void 0,s.accessToken=i.accessToken||void 0,s.secret=i.secret,s.nonce=i.nonce,s.pendingToken=i.pendingToken||null,s}_getIdTokenResponse(e){return eL(e,this.buildRequest())}_linkToIdToken(e,t){let n=this.buildRequest();return n.idToken=t,eL(e,n)}_getReauthenticationResolver(e){let t=this.buildRequest();return t.autoCreate=!1,eL(e,t)}buildRequest(){let e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{let t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=(0,a.xO)(t)}return e}}async function eF(e,t){return P(e,"POST","/v1/accounts:sendVerificationCode",O(e,t))}async function eU(e,t){return M(e,"POST","/v1/accounts:signInWithPhoneNumber",O(e,t))}async function eV(e,t){let n=await M(e,"POST","/v1/accounts:signInWithPhoneNumber",O(e,t));if(n.temporaryProof)throw V(e,"account-exists-with-different-credential",n);return n}let eq={USER_NOT_FOUND:"user-not-found"};async function eB(e,t){return M(e,"POST","/v1/accounts:signInWithPhoneNumber",O(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),eq)}class ej extends e_{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new ej({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new ej({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return eU(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return eV(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return eB(e,this._makeVerificationRequest())}_makeVerificationRequest(){let{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){let e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));let{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}=e;return n||t||r||i?new ej({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}):null}}class e${constructor(e){var t,n,r,i,s,o;let l=(0,a.zd)((0,a.pd)(e)),u=null!=(t=l.apiKey)?t:null,c=null!=(n=l.oobCode)?n:null,h=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!=(r=l.mode)?r:null);I(u&&c&&h,"argument-error"),this.apiKey=u,this.operation=h,this.code=c,this.continueUrl=null!=(i=l.continueUrl)?i:null,this.languageCode=null!=(s=l.languageCode)?s:null,this.tenantId=null!=(o=l.tenantId)?o:null}static parseLink(e){let t=function(e){let t=(0,a.zd)((0,a.pd)(e)).link,n=t?(0,a.zd)((0,a.pd)(t)).deep_link_id:null,r=(0,a.zd)((0,a.pd)(e)).deep_link_id;return(r?(0,a.zd)((0,a.pd)(r)).link:null)||r||n||t||e}(e);try{return new e$(t)}catch(e){return null}}}class eG{constructor(){this.providerId=eG.PROVIDER_ID}static credential(e,t){return eP._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){let n=e$.parseLink(t);return I(n,"argument-error"),eP._fromEmailAndCode(e,n.code,n.tenantId)}}eG.PROVIDER_ID="password",eG.EMAIL_PASSWORD_SIGN_IN_METHOD="password",eG.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class eK{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class ez extends eK{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class eW extends ez{static credentialFromJSON(e){let t="string"==typeof e?JSON.parse(e):e;return I("providerId"in t&&"signInMethod"in t,"argument-error"),eM._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return I(e.idToken||e.accessToken,"argument-error"),eM._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return eW.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return eW.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthIdToken:t,oauthAccessToken:n,oauthTokenSecret:r,pendingToken:i,nonce:s,providerId:a}=e;if(!n&&!r&&!t&&!i||!a)return null;try{return new eW(a)._credential({idToken:t,accessToken:n,nonce:s,pendingToken:i})}catch(e){return null}}}class eH extends ez{constructor(){super("facebook.com")}static credential(e){return eM._fromParams({providerId:eH.PROVIDER_ID,signInMethod:eH.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return eH.credentialFromTaggedObject(e)}static credentialFromError(e){return eH.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return eH.credential(e.oauthAccessToken)}catch(e){return null}}}eH.FACEBOOK_SIGN_IN_METHOD="facebook.com",eH.PROVIDER_ID="facebook.com";class eQ extends ez{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return eM._fromParams({providerId:eQ.PROVIDER_ID,signInMethod:eQ.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return eQ.credentialFromTaggedObject(e)}static credentialFromError(e){return eQ.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return eQ.credential(t,n)}catch(e){return null}}}eQ.GOOGLE_SIGN_IN_METHOD="google.com",eQ.PROVIDER_ID="google.com";class eY extends ez{constructor(){super("github.com")}static credential(e){return eM._fromParams({providerId:eY.PROVIDER_ID,signInMethod:eY.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return eY.credentialFromTaggedObject(e)}static credentialFromError(e){return eY.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return eY.credential(e.oauthAccessToken)}catch(e){return null}}}eY.GITHUB_SIGN_IN_METHOD="github.com",eY.PROVIDER_ID="github.com";class eX extends e_{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){return eL(e,this.buildRequest())}_linkToIdToken(e,t){let n=this.buildRequest();return n.idToken=t,eL(e,n)}_getReauthenticationResolver(e){let t=this.buildRequest();return t.autoCreate=!1,eL(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){let{providerId:t,signInMethod:n,pendingToken:r}="string"==typeof e?JSON.parse(e):e;return t&&n&&r&&t===n?new eX(t,r):null}static _create(e,t){return new eX(e,t)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class eJ extends eK{constructor(e){I(e.startsWith("saml."),"argument-error"),super(e)}static credentialFromResult(e){return eJ.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return eJ.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){let t=eX.fromJSON(e);return I(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{pendingToken:t,providerId:n}=e;if(!t||!n)return null;try{return eX._create(n,t)}catch(e){return null}}}class eZ extends ez{constructor(){super("twitter.com")}static credential(e,t){return eM._fromParams({providerId:eZ.PROVIDER_ID,signInMethod:eZ.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return eZ.credentialFromTaggedObject(e)}static credentialFromError(e){return eZ.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return eZ.credential(t,n)}catch(e){return null}}}async function e0(e,t){return M(e,"POST","/v1/accounts:signUp",O(e,t))}eZ.TWITTER_SIGN_IN_METHOD="twitter.com",eZ.PROVIDER_ID="twitter.com";class e1{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){return new e1({user:await et._fromIdTokenResponse(e,n,r),providerId:e2(n),_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){return await e._updateTokensIfNecessary(n,!0),new e1({user:e,providerId:e2(n),_tokenResponse:n,operationType:t})}}function e2(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}async function e3(e){var t;let n=ev(e);if(await n._initializationPromise,null==(t=n.currentUser)?void 0:t.isAnonymous)return new e1({user:n.currentUser,providerId:null,operationType:"signIn"});let r=await e0(n,{returnSecureToken:!0}),i=await e1._fromIdTokenResponse(n,"signIn",r,!0);return await n._updateCurrentUser(i.user),i}class e6 extends a.ZR{constructor(e,t,n,r){var i;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,e6.prototype),this.customData={appName:e.name,tenantId:null!=(i=e.tenantId)?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new e6(e,t,n,r)}}function e4(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch(n=>{if("auth/multi-factor-auth-required"===n.code)throw e6._fromErrorAndOperation(e,n,t,r);throw n})}function e5(e){return new Set(e.map(({providerId:e})=>e).filter(e=>!!e))}async function e9(e,t){let n=(0,a.m9)(e);await e7(!0,n,t);let{providerUserInfo:r}=await B(n.auth,{idToken:await n.getIdToken(),deleteProvider:[t]}),i=e5(r||[]);return n.providerData=n.providerData.filter(e=>i.has(e.providerId)),i.has("phone")||(n.phoneNumber=null),await n.auth._persistUserIfCurrent(n),n}async function e8(e,t,n=!1){let r=await W(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return e1._forOperation(e,"link",r)}async function e7(e,t,n){await Y(t),I(e5(t.providerData).has(n)===e,t.auth,!1===e?"provider-already-linked":"no-such-provider")}async function te(e,t,n=!1){let{auth:r}=e,i="reauthenticate";try{let s=await W(e,e4(r,i,t,e),n);I(s.idToken,r,"internal-error");let a=z(s.idToken);I(a,r,"internal-error");let{sub:o}=a;return I(e.uid===o,r,"user-mismatch"),e1._forOperation(e,i,s)}catch(e){throw(null==e?void 0:e.code)==="auth/user-not-found"&&g(r,"user-mismatch"),e}}async function tt(e,t,n=!1){let r="signIn",i=await e4(e,r,t),s=await e1._fromIdTokenResponse(e,r,i);return n||await e._updateCurrentUser(s.user),s}async function tn(e,t){return tt(ev(e),t)}async function tr(e,t){let n=(0,a.m9)(e);return await e7(!1,n,t.providerId),e8(n,t)}async function ti(e,t){return te((0,a.m9)(e),t)}async function ts(e,t){return M(e,"POST","/v1/accounts:signInWithCustomToken",O(e,t))}async function ta(e,t){let n=ev(e),r=await ts(n,{token:t,returnSecureToken:!0}),i=await e1._fromIdTokenResponse(n,"signIn",r);return await n._updateCurrentUser(i.user),i}class to{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?tl._fromServerResponse(e,t):g(e,"internal-error")}}class tl extends to{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new tl(t)}}function tu(e,t,n){var r;I((null==(r=n.url)?void 0:r.length)>0,e,"invalid-continue-uri"),I(void 0===n.dynamicLinkDomain||n.dynamicLinkDomain.length>0,e,"invalid-dynamic-link-domain"),t.continueUrl=n.url,t.dynamicLinkDomain=n.dynamicLinkDomain,t.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(I(n.iOS.bundleId.length>0,e,"missing-ios-bundle-id"),t.iOSBundleId=n.iOS.bundleId),n.android&&(I(n.android.packageName.length>0,e,"missing-android-pkg-name"),t.androidInstallApp=n.android.installApp,t.androidMinimumVersionCode=n.android.minimumVersion,t.androidPackageName=n.android.packageName)}async function tc(e,t,n){let r=(0,a.m9)(e),i={requestType:"PASSWORD_RESET",email:t};n&&tu(r,i,n),await eD(r,i)}async function th(e,t,n){await eE((0,a.m9)(e),{oobCode:t,newPassword:n})}async function td(e,t){await eS((0,a.m9)(e),{oobCode:t})}async function tf(e,t){let n=(0,a.m9)(e),r=await eE(n,{oobCode:t}),i=r.requestType;switch(I(i,n,"internal-error"),i){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":I(r.newEmail,n,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":I(r.mfaInfo,n,"internal-error");default:I(r.email,n,"internal-error")}let s=null;return r.mfaInfo&&(s=to._fromServerResponse(ev(n),r.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.newEmail:r.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.email:r.newEmail)||null,multiFactorInfo:s},operation:i}}async function tp(e,t){let{data:n}=await tf((0,a.m9)(e),t);return n.email}async function tm(e,t,n){let r=ev(e),i=await e0(r,{returnSecureToken:!0,email:t,password:n}),s=await e1._fromIdTokenResponse(r,"signIn",i);return await r._updateCurrentUser(s.user),s}async function tg(e,t,n){let r=(0,a.m9)(e),i={requestType:"EMAIL_SIGNIN",email:t};I(n.handleCodeInApp,r,"argument-error"),n&&tu(r,i,n),await eN(r,i)}async function ty(e,t,n){let r=(0,a.m9)(e),i=eG.credentialWithLink(t,n||S());return I(i._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),tn(r,i)}async function tv(e,t){return P(e,"POST","/v1/accounts:createAuthUri",O(e,t))}async function tw(e,t){let n=k()?S():"http://localhost",{signinMethods:r}=await tv((0,a.m9)(e),{identifier:t,continueUri:n});return r||[]}async function tb(e,t){let n=(0,a.m9)(e),r={requestType:"VERIFY_EMAIL",idToken:await e.getIdToken()};t&&tu(n.auth,r,t);let{email:i}=await eC(n.auth,r);i!==e.email&&await e.reload()}async function tI(e,t,n){let r=(0,a.m9)(e),i={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await e.getIdToken(),newEmail:t};n&&tu(r.auth,i,n);let{email:s}=await eR(r.auth,i);s!==e.email&&await e.reload()}async function t_(e,t){return P(e,"POST","/v1/accounts:update",t)}async function tE(e,{displayName:t,photoURL:n}){if(void 0===t&&void 0===n)return;let r=(0,a.m9)(e),i=await r.getIdToken(),s=await W(r,t_(r.auth,{idToken:i,displayName:t,photoUrl:n,returnSecureToken:!0}));r.displayName=s.displayName||null,r.photoURL=s.photoUrl||null;let o=r.providerData.find(({providerId:e})=>"password"===e);o&&(o.displayName=r.displayName,o.photoURL=r.photoURL),await r._updateTokensIfNecessary(s)}async function tT(e,t,n){let{auth:r}=e,i={idToken:await e.getIdToken(),returnSecureToken:!0};t&&(i.email=t),n&&(i.password=n);let s=await W(e,eT(r,i));await e._updateTokensIfNecessary(s,!0)}class tS{constructor(e,t,n={}){this.isNewUser=e,this.providerId=t,this.profile=n}}class tk extends tS{constructor(e,t,n,r){super(e,t,n),this.username=r}}class tA extends tS{constructor(e,t){super(e,"facebook.com",t)}}class tC extends tk{constructor(e,t){super(e,"github.com",t,"string"==typeof(null==t?void 0:t.login)?null==t?void 0:t.login:null)}}class tD extends tS{constructor(e,t){super(e,"google.com",t)}}class tN extends tk{constructor(e,t,n){super(e,"twitter.com",t,n)}}class tR{constructor(e,t,n){this.type=e,this.credential=t,this.auth=n}static _fromIdtoken(e,t){return new tR("enroll",e,t)}static _fromMfaPendingCredential(e){return new tR("signin",e)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,n;if(null==e?void 0:e.multiFactorSession){if(null==(t=e.multiFactorSession)?void 0:t.pendingCredential)return tR._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);else if(null==(n=e.multiFactorSession)?void 0:n.idToken)return tR._fromIdtoken(e.multiFactorSession.idToken)}return null}}class tx{constructor(e,t,n){this.session=e,this.hints=t,this.signInResolver=n}static _fromError(e,t){let n=ev(e),r=t.customData._serverResponse,i=(r.mfaInfo||[]).map(e=>to._fromServerResponse(n,e));I(r.mfaPendingCredential,n,"internal-error");let s=tR._fromMfaPendingCredential(r.mfaPendingCredential);return new tx(s,i,async e=>{let i=await e._process(n,s);delete r.mfaInfo,delete r.mfaPendingCredential;let a=Object.assign(Object.assign({},r),{idToken:i.idToken,refreshToken:i.refreshToken});switch(t.operationType){case"signIn":let o=await e1._fromIdTokenResponse(n,t.operationType,a);return await n._updateCurrentUser(o.user),o;case"reauthenticate":return I(t.user,n,"internal-error"),e1._forOperation(t.user,t.operationType,a);default:g(n,"internal-error")}})}async resolveSignIn(e){return this.signInResolver(e)}}class tO{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(t=>to._fromServerResponse(e.auth,t)))})}static _fromUser(e){return new tO(e)}async getSession(){return tR._fromIdtoken(await this.user.getIdToken(),this.user.auth)}async enroll(e,t){let n=await this.getSession(),r=await W(this.user,e._process(this.user.auth,n,t));return await this.user._updateTokensIfNecessary(r),this.user.reload()}async unenroll(e){let t="string"==typeof e?e:e.uid,n=await this.user.getIdToken();try{var r,i;let e=await W(this.user,(r=this.user.auth,i={idToken:n,mfaEnrollmentId:t},P(r,"POST","/v2/accounts/mfaEnrollment:withdraw",O(r,i))));this.enrolledFactors=this.enrolledFactors.filter(({uid:e})=>e!==t),await this.user._updateTokensIfNecessary(e),await this.user.reload()}catch(e){throw e}}}let tP=new WeakMap,tL="__sak";class tM{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{if(!this.storage)return Promise.resolve(!1);return this.storage.setItem(tL,"1"),this.storage.removeItem(tL),Promise.resolve(!0)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){let t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class tF extends tM{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){let e=(0,a.z$)();return eo(e)||ef(e)}()&&function(){try{return!!(window&&window!==window.top)}catch(e){return!1}}(),this.fallbackToPolling=ep(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(let t of Object.keys(this.listeners)){let n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)});let n=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){let r=this.storage.getItem(n);if(e.newValue!==r)null!==e.newValue?this.storage.setItem(n,e.newValue):this.storage.removeItem(n);else if(this.localCache[n]===e.newValue&&!t)return}let r=()=>{let e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},i=this.storage.getItem(n);(0,a.w1)()&&10===document.documentMode&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,10):r()}notifyListeners(e,t){this.localCache[e]=t;let n=this.listeners[e];if(n)for(let e of Array.from(n))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){let t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}tF.type="LOCAL";class tU extends tM{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}tU.type="SESSION";class tV{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){let t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;let n=new tV(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){let{eventId:t,eventType:n,data:r}=e.data,i=this.handlersMap[n];if(!(null==i?void 0:i.size))return;e.ports[0].postMessage({status:"ack",eventId:t,eventType:n});let s=Array.from(i).map(async t=>t(e.origin,r)),a=await Promise.all(s.map(async e=>{try{let t=await e;return{fulfilled:!0,value:t}}catch(e){return{fulfilled:!1,reason:e}}}));e.ports[0].postMessage({status:"done",eventId:t,eventType:n,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function tq(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}tV.receivers=[];class tB{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){let r,i,s="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!s)throw Error("connection_unavailable");return new Promise((a,o)=>{let l=tq("",20);s.port1.start();let u=setTimeout(()=>{o(Error("unsupported_event"))},n);i={messageChannel:s,onMessage(e){if(e.data.eventId===l)switch(e.data.status){case"ack":clearTimeout(u),r=setTimeout(()=>{o(Error("timeout"))},3e3);break;case"done":clearTimeout(r),a(e.data.response);break;default:clearTimeout(u),clearTimeout(r),o(Error("invalid_response"))}}},this.handlers.add(i),s.port1.addEventListener("message",i.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[s.port2])}).finally(()=>{i&&this.removeMessageHandler(i)})}}function tj(){return window}function t$(){return void 0!==tj().WorkerGlobalScope&&"function"==typeof tj().importScripts}async function tG(){if(!(null==navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}let tK="firebaseLocalStorageDb",tz="firebaseLocalStorage",tW="fbase_key";class tH{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function tQ(e,t){return e.transaction([tz],t?"readwrite":"readonly").objectStore(tz)}function tY(){let e=indexedDB.open(tK,1);return new Promise((t,n)=>{e.addEventListener("error",()=>{n(e.error)}),e.addEventListener("upgradeneeded",()=>{let t=e.result;try{t.createObjectStore(tz,{keyPath:tW})}catch(e){n(e)}}),e.addEventListener("success",async()=>{let n=e.result;n.objectStoreNames.contains(tz)?t(n):(n.close(),await new tH(indexedDB.deleteDatabase(tK)).toPromise(),t(await tY()))})})}async function tX(e,t,n){return new tH(tQ(e,!0).put({[tW]:t,value:n})).toPromise()}async function tJ(e,t){let n=tQ(e,!1).get(t),r=await new tH(n).toPromise();return void 0===r?null:r.value}function tZ(e,t){return new tH(tQ(e,!0).delete(t)).toPromise()}class t0{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await tY()),this.db}async _withRetries(e){let t=0;for(;;)try{let t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return t$()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=tV._getInstance(t$()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await tG(),!this.activeServiceWorker)return;this.sender=new tB(this.activeServiceWorker);let n=await this.sender._send("ping",{},800);n&&(null==(e=n[0])?void 0:e.fulfilled)&&(null==(t=n[0])?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null==(t=null==navigator?void 0:navigator.serviceWorker)?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(e){}}async _isAvailable(){try{if(!indexedDB)return!1;let e=await tY();return await tX(e,tL,"1"),await tZ(e,tL),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>tX(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){let t=await this._withRetries(t=>tJ(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>tZ(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){let e=await this._withRetries(e=>new tH(tQ(e,!1).getAll()).toPromise());if(!e||0!==this.pendingWrites)return[];let t=[],n=new Set;for(let{fbase_key:r,value:i}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(let e of Object.keys(this.localCache))this.localCache[e]&&!n.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;let n=this.listeners[e];if(n)for(let e of Array.from(n))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}async function t1(e){return(await P(e,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}function t2(e){return new Promise((t,n)=>{var r,i;let s=document.createElement("script");s.setAttribute("src",e),s.onload=t,s.onerror=e=>{let t=y("internal-error");t.customData=e,n(t)},s.type="text/javascript",s.charset="UTF-8",(null!=(i=null==(r=document.getElementsByTagName("head"))?void 0:r[0])?i:document).appendChild(s)})}function t3(e){return`__${e}${Math.floor(1e6*Math.random())}`}t0.type="LOCAL";class t6{constructor(e){this.auth=e,this.counter=1e12,this._widgets=new Map}render(e,t){let n=this.counter;return this._widgets.set(n,new t4(e,this.auth.name,t||{})),this.counter++,n}reset(e){var t;let n=e||1e12;null==(t=this._widgets.get(n))||t.delete(),this._widgets.delete(n)}getResponse(e){var t;return(null==(t=this._widgets.get(e||1e12))?void 0:t.getResponse())||""}async execute(e){var t;return null==(t=this._widgets.get(e||1e12))||t.execute(),""}}class t4{constructor(e,t,n){this.params=n,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};let r="string"==typeof e?document.getElementById(e):e;I(r,"argument-error",{appName:t}),this.container=r,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),this.timerId||(this.timerId=window.setTimeout(()=>{this.responseToken=function(e){let t=[],n="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let e=0;e<50;e++)t.push(n.charAt(Math.floor(Math.random()*n.length)));return t.join("")}(50);let{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch(e){}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch(e){}this.isVisible&&this.execute()},6e4)},500))}checkIfDeleted(){if(this.deleted)throw Error("reCAPTCHA mock was already deleted!")}}let t5=t3("rcb"),t9=new C(3e4,6e4);class t8{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(null==(e=tj().grecaptcha)?void 0:e.render)}load(e,t=""){var n;return(I((n=t).length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(n),e,"argument-error"),this.shouldResolveImmediately(t))?Promise.resolve(tj().grecaptcha):new Promise((n,r)=>{let i=tj().setTimeout(()=>{r(y(e,"network-request-failed"))},t9.get());tj()[t5]=()=>{tj().clearTimeout(i),delete tj()[t5];let s=tj().grecaptcha;if(!s)return void r(y(e,"internal-error"));let a=s.render;s.render=(e,t)=>{let n=a(e,t);return this.counter++,n},this.hostLanguage=t,n(s)},t2(`https://www.google.com/recaptcha/api.js??${(0,a.xO)({onload:t5,render:"explicit",hl:t})}`).catch(()=>{clearTimeout(i),r(y(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!(null==(t=tj().grecaptcha)?void 0:t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}class t7{async load(e){return new t6(e)}clearedOneInstance(){}}let ne="recaptcha",nt={theme:"light",type:"image"};class nn{constructor(e,t=Object.assign({},nt),n){this.parameters=t,this.type=ne,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=ev(n),this.isInvisible="invisible"===this.parameters.size,I("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment");let r="string"==typeof e?document.getElementById(e):e;I(r,this.auth,"argument-error"),this.container=r,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new t7:new t8,this.validateStartingState()}async verify(){this.assertNotDestroyed();let e=await this.render(),t=this.getAssertedRecaptcha(),n=t.getResponse(e);return n||new Promise(n=>{let r=e=>{e&&(this.tokenChangeListeners.delete(r),n(e))};this.tokenChangeListeners.add(r),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e})),this.renderPromise}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){I(!this.parameters.sitekey,this.auth,"argument-error"),I(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),I("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(e=>e(t)),"function"==typeof e)e(t);else if("string"==typeof e){let n=tj()[e];"function"==typeof n&&n(t)}}}assertNotDestroyed(){I(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){let t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){let e;I(k()&&!t$(),this.auth,"internal-error"),await (e=null,new Promise(t=>{if("complete"===document.readyState)return void t();e=()=>t(),window.addEventListener("load",e)}).catch(t=>{throw e&&window.removeEventListener("load",e),t})),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);let t=await t1(this.auth);I(t,this.auth,"internal-error"),this.parameters.sitekey=t}getAssertedRecaptcha(){return I(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class nr{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){let t=ej._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function ni(e,t,n){let r=ev(e);return new nr(await no(r,t,(0,a.m9)(n)),e=>tn(r,e))}async function ns(e,t,n){let r=(0,a.m9)(e);return await e7(!1,r,"phone"),new nr(await no(r.auth,t,(0,a.m9)(n)),e=>tr(r,e))}async function na(e,t,n){let r=(0,a.m9)(e);return new nr(await no(r.auth,t,(0,a.m9)(n)),e=>ti(r,e))}async function no(e,t,n){var r,i,s;let a=await n.verify();try{let o;if(I("string"==typeof a,e,"argument-error"),I(n.type===ne,e,"argument-error"),o="string"==typeof t?{phoneNumber:t}:t,"session"in o){let t=o.session;if("phoneNumber"in o)return I("enroll"===t.type,e,"internal-error"),(await (i={idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:o.phoneNumber,recaptchaToken:a}},P(e,"POST","/v2/accounts/mfaEnrollment:start",O(e,i)))).phoneSessionInfo.sessionInfo;{I("signin"===t.type,e,"internal-error");let n=(null==(r=o.multiFactorHint)?void 0:r.uid)||o.multiFactorUid;return I(n,e,"missing-multi-factor-info"),(await (s={mfaPendingCredential:t.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:a}},P(e,"POST","/v2/accounts/mfaSignIn:start",O(e,s)))).phoneResponseInfo.sessionInfo}}{let{sessionInfo:t}=await eF(e,{phoneNumber:o.phoneNumber,recaptchaToken:a});return t}}finally{n._reset()}}async function nl(e,t){await e8((0,a.m9)(e),t)}class nu{constructor(e){this.providerId=nu.PROVIDER_ID,this.auth=ev(e)}verifyPhoneNumber(e,t){return no(this.auth,e,(0,a.m9)(t))}static credential(e,t){return ej._fromVerification(e,t)}static credentialFromResult(e){return nu.credentialFromTaggedObject(e)}static credentialFromError(e){return nu.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{phoneNumber:t,temporaryProof:n}=e;return t&&n?ej._fromTokenResponse(t,n):null}}function nc(e,t){return t?T(t):(I(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}nu.PROVIDER_ID="phone",nu.PHONE_SIGN_IN_METHOD="phone";class nh extends e_{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return eL(e,this._buildIdpRequest())}_linkToIdToken(e,t){return eL(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return eL(e,this._buildIdpRequest())}_buildIdpRequest(e){let t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function nd(e){return tt(e.auth,new nh(e),e.bypassAuthState)}function nf(e){let{auth:t,user:n}=e;return I(n,t,"internal-error"),te(n,new nh(e),e.bypassAuthState)}async function np(e){let{auth:t,user:n}=e;return I(n,t,"internal-error"),e8(n,new nh(e),e.bypassAuthState)}class nm{constructor(e,t,n,r,i=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}})}async onAuthEvent(e){let{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:s,type:a}=e;if(s)return void this.reject(s);let o={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(o))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return nd;case"linkViaPopup":case"linkViaRedirect":return np;case"reauthViaPopup":case"reauthViaRedirect":return nf;default:g(this.auth,"internal-error")}}resolve(e){var t,n;t=this.pendingPromise,n="Pending promise was never set",t||_(n),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){var t,n;t=this.pendingPromise,n="Pending promise was never set",t||_(n),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}let ng=new C(2e3,1e4);async function ny(e,t,n){let r=ev(e);w(e,t,eK);let i=nc(r,n);return new nb(r,"signInViaPopup",t,i).executeNotNull()}async function nv(e,t,n){let r=(0,a.m9)(e);w(r.auth,t,eK);let i=nc(r.auth,n);return new nb(r.auth,"reauthViaPopup",t,i,r).executeNotNull()}async function nw(e,t,n){let r=(0,a.m9)(e);w(r.auth,t,eK);let i=nc(r.auth,n);return new nb(r.auth,"linkViaPopup",t,i,r).executeNotNull()}class nb extends nm{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,nb.currentPopupAction&&nb.currentPopupAction.cancel(),nb.currentPopupAction=this}async executeNotNull(){let e=await this.execute();return I(e,this.auth,"internal-error"),e}async onExecution(){var e,t;e=1===this.filter.length,t="Popup operations only handle one event",e||_(t);let n=tq();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],n),this.authWindow.associatedEvent=n,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(y(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return(null==(e=this.authWindow)?void 0:e.associatedEvent)||null}cancel(){this.reject(y(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,nb.currentPopupAction=null}pollUserCancellation(){let e=()=>{var t,n;if(null==(n=null==(t=this.authWindow)?void 0:t.window)?void 0:n.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(y(this.auth,"popup-closed-by-user"))},2e3);return}this.pollId=window.setTimeout(e,ng.get())};e()}}nb.currentPopupAction=null;let nI=new Map;class n_ extends nm{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=nI.get(this.auth._key());if(!e){try{let t=await nE(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}nI.set(this.auth._key(),e)}return this.bypassAuthState||nI.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"===e.type)return void this.resolve(null);if(e.eventId){let t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function nE(e,t){let n=nA(t),r=nk(e);if(!await r._isAvailable())return!1;let i=await r._get(n)==="true";return await r._remove(n),i}async function nT(e,t){return nk(e)._set(nA(t),"true")}function nS(e,t){nI.set(e._key(),t)}function nk(e){return T(e._redirectPersistence)}function nA(e){return er("pendingRedirect",e.config.apiKey,e.name)}async function nC(e,t,n){let r=ev(e);w(e,t,eK),await r._initializationPromise;let i=nc(r,n);return await nT(i,r),i._openRedirect(r,t,"signInViaRedirect")}async function nD(e,t,n){let r=(0,a.m9)(e);w(r.auth,t,eK),await r.auth._initializationPromise;let i=nc(r.auth,n);await nT(i,r.auth);let s=await nO(r);return i._openRedirect(r.auth,t,"reauthViaRedirect",s)}async function nN(e,t,n){let r=(0,a.m9)(e);w(r.auth,t,eK),await r.auth._initializationPromise;let i=nc(r.auth,n);await e7(!1,r,t.providerId),await nT(i,r.auth);let s=await nO(r);return i._openRedirect(r.auth,t,"linkViaRedirect",s)}async function nR(e,t){return await ev(e)._initializationPromise,nx(e,t,!1)}async function nx(e,t,n=!1){let r=ev(e),i=nc(r,t),s=new n_(r,i,n),a=await s.execute();return a&&!n&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,t)),a}async function nO(e){let t=tq(`${e.uid}:::`);return e._redirectEventId=t,await e.auth._setRedirectUser(e),await e.auth._persistUserIfCurrent(e),t}class nP{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return nM(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!nM(e)){let r=(null==(n=e.error.code)?void 0:n.split("auth/")[1])||"internal-error";t.onError(y(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){let n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(nL(e))}saveEventToCache(e){this.cachedEventUids.add(nL(e)),this.lastProcessedEventTime=Date.now()}}function nL(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function nM({type:e,error:t}){return"unknown"===e&&(null==t?void 0:t.code)==="auth/no-auth-event"}async function nF(e,t={}){return P(e,"GET","/v1/projects",t)}let nU=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,nV=/^https?/;async function nq(e){if(e.config.emulator)return;let{authorizedDomains:t}=await nF(e);for(let e of t)try{if(function(e){let t=S(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){let i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!nV.test(n))return!1;if(nU.test(e))return r===e;let i=e.replace(/\./g,"\\.");return RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}(e))return}catch(e){}g(e,"unauthorized-domain")}let nB=new C(3e4,6e4);function nj(){let e=tj().___jsl;if(null==e?void 0:e.H){for(let t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}}let n$=null,nG=new C(5e3,15e3),nK={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},nz=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);async function nW(e){let t=await (n$=n$||new Promise((t,n)=>{var r,i,s;function a(){nj(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{nj(),n(y(e,"network-request-failed"))},timeout:nB.get()})}if(null==(i=null==(r=tj().gapi)?void 0:r.iframes)?void 0:i.Iframe)t(gapi.iframes.getContext());else if(null==(s=tj().gapi)?void 0:s.load)a();else{let t=t3("iframefcb");return tj()[t]=()=>{gapi.load?a():n(y(e,"network-request-failed"))},t2(`https://apis.google.com/js/api.js?onload=${t}`).catch(e=>n(e))}}).catch(e=>{throw n$=null,e})),n=tj().gapi;return I(n,e,"internal-error"),t.open({where:document.body,url:function(e){let t=e.config;I(t.authDomain,e,"auth-domain-config-required");let n=t.emulator?D(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,r={apiKey:t.apiKey,appName:e.name,v:o.SDK_VERSION},i=nz.get(e.config.apiHost);i&&(r.eid=i);let s=e._getFrameworks();return s.length&&(r.fw=s.join(",")),`${n}?${(0,a.xO)(r).slice(1)}`}(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:nK,dontclear:!0},t=>new Promise(async(n,r)=>{await t.restyle({setHideOnLeave:!1});let i=y(e,"network-request-failed"),s=tj().setTimeout(()=>{r(i)},nG.get());function a(){tj().clearTimeout(s),n(t)}t.ping(a).then(a,()=>{r(i)})}))}let nH={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class nQ{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function nY(e,t,n,r,i,s){I(e.config.authDomain,e,"auth-domain-config-required"),I(e.config.apiKey,e,"invalid-api-key");let l={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:o.SDK_VERSION,eventId:i};if(t instanceof eK)for(let[n,r]of(t.setDefaultLanguage(e.languageCode),l.providerId=t.providerId||"",(0,a.xb)(t.getCustomParameters())||(l.customParameters=JSON.stringify(t.getCustomParameters())),Object.entries(s||{})))l[n]=r;if(t instanceof ez){let e=t.getScopes().filter(e=>""!==e);e.length>0&&(l.scopes=e.join(","))}for(let t of(e.tenantId&&(l.tid=e.tenantId),Object.keys(l)))void 0===l[t]&&delete l[t];return`${function({config:e}){return e.emulator?D(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${(0,a.xO)(l).slice(1)}`}let nX="webStorageSupport",nJ=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=tU,this._completeRedirectFn=nx,this._overrideRedirectResult=nS}async _openPopup(e,t,n,r){var i,s,o;s=null==(i=this.eventManagers[e._key()])?void 0:i.manager,o="_initialize() not called before _openPopup()",s||_(o);let l=nY(e,t,n,S(),r);return function(e,t,n,r=500,i=600){let s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString(),l="",u=Object.assign(Object.assign({},nH),{width:r.toString(),height:i.toString(),top:s,left:o}),c=(0,a.z$)().toLowerCase();n&&(l=el(c)?"_blank":n),ea(c)&&(t=t||"http://localhost",u.scrollbars="yes");let h=Object.entries(u).reduce((e,[t,n])=>`${e}${t}=${n},`,"");if(function(e=(0,a.z$)()){var t;return ef(e)&&!!(null==(t=window.navigator)?void 0:t.standalone)}(c)&&"_self"!==l)return function(e,t){let n=document.createElement("a");n.href=e,n.target=t;let r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",l),new nQ(null);let d=window.open(t||"",l,h);I(d,e,"popup-blocked");try{d.focus()}catch(e){}return new nQ(d)}(e,l,tq())}async _openRedirect(e,t,n,r){var i;return await this._originValidation(e),i=nY(e,t,n,S(),r),tj().location.href=i,new Promise(()=>{})}_initialize(e){let t=e._key();if(this.eventManagers[t]){var n;let{manager:e,promise:r}=this.eventManagers[t];return e?Promise.resolve(e):(n="If manager is not set, promise should be",r||_(n),r)}let r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){let t=await nW(e),n=new nP(e);return t.register("authEvent",t=>(I(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(nX,{type:nX},n=>{var r;let i=null==(r=null==n?void 0:n[0])?void 0:r[nX];void 0!==i&&t(!!i),g(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=nq(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return ep()||eo()||ef()}};class nZ{constructor(e){this.factorId=e}_process(e,t,n){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,n);case"signin":return this._finalizeSignIn(e,t.credential);default:return _("unexpected MultiFactorSessionType")}}}class n0 extends nZ{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new n0(e)}_finalizeEnroll(e,t,n){return P(e,"POST","/v2/accounts/mfaEnrollment:finalize",O(e,{idToken:t,displayName:n,phoneVerificationInfo:this.credential._makeVerificationRequest()}))}_finalizeSignIn(e,t){return P(e,"POST","/v2/accounts/mfaSignIn:finalize",O(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()}))}}class n1{constructor(){}static assertion(e){return n0._fromCredential(e)}}n1.FACTOR_ID="phone";var n2="@firebase/auth",n3="0.21.3";class n6{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null==(e=this.auth.currentUser)?void 0:e.uid)||null}async getToken(e){return(this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser)?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){I(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function n4(){return window}async function n5(e,t,n){var r,i,s;let{BuildInfo:a}=n4();i=t.sessionId,s="AuthEvent did not contain a session ID",i||_(s);let o=await n7(t.sessionId),l={};return ef()?l.ibi=a.packageName:ec()?l.apn=a.packageName:g(e,"operation-not-supported-in-this-environment"),a.displayName&&(l.appDisplayName=a.displayName),l.sessionId=o,nY(e,n,t.type,void 0,null!=(r=t.eventId)?r:void 0,l)}async function n9(e){let{BuildInfo:t}=n4(),n={};ef()?n.iosBundleId=t.packageName:ec()?n.androidPackageName=t.packageName:g(e,"operation-not-supported-in-this-environment"),await nF(e,n)}async function n8(e,t,n){let{cordova:r}=n4(),i=()=>{};try{await new Promise((s,a)=>{let o=null;function l(){var e;s();let t=null==(e=r.plugins.browsertab)?void 0:e.close;"function"==typeof t&&t(),"function"==typeof(null==n?void 0:n.close)&&n.close()}function u(){o||(o=window.setTimeout(()=>{a(y(e,"redirect-cancelled-by-user"))},2e3))}function c(){(null==document?void 0:document.visibilityState)==="visible"&&u()}t.addPassiveListener(l),document.addEventListener("resume",u,!1),ec()&&document.addEventListener("visibilitychange",c,!1),i=()=>{t.removePassiveListener(l),document.removeEventListener("resume",u,!1),document.removeEventListener("visibilitychange",c,!1),o&&window.clearTimeout(o)}})}finally{i()}}async function n7(e){let t=function(e){var t,n;if(t=/[0-9a-zA-Z]+/.test(e),n="Can only convert alpha-numeric strings",t||_(n),"undefined"!=typeof TextEncoder)return new TextEncoder().encode(e);let r=new Uint8Array(new ArrayBuffer(e.length));for(let t=0;t<e.length;t++)r[t]=e.charCodeAt(t);return r}(e);return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",t))).map(e=>e.toString(16).padStart(2,"0")).join("")}(0,a.Pz)("authIdTokenMaxAge"),r="Browser",(0,o._registerComponent)(new c.wA("auth",(e,{options:t})=>{let n=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),{apiKey:s,authDomain:a}=n.options;var o=n,l=i;I(s&&!s.includes(":"),"invalid-api-key",{appName:o.name}),I(!(null==a?void 0:a.includes(":")),"argument-error",{appName:o.name});let u=new ey(o,l,{apiKey:s,authDomain:a,clientPlatform:r,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:em(r)}),c=(null==t?void 0:t.persistence)||[],h=(Array.isArray(c)?c:[c]).map(T);return(null==t?void 0:t.errorMap)&&u._updateErrorMap(t.errorMap),u._initializeWithPersistence(h,null==t?void 0:t.popupRedirectResolver),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),(0,o._registerComponent)(new c.wA("auth-internal",e=>new n6(ev(e.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),(0,o.registerVersion)(n2,n3,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(r)),(0,o.registerVersion)(n2,n3,"esm2017");class re extends nP{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(e=>{this.resolveInialized=e})}addPassiveListener(e){this.passiveListeners.add(e)}removePassiveListener(e){this.passiveListeners.delete(e)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(e){return this.resolveInialized(),this.passiveListeners.forEach(t=>t(e)),super.onEvent(e)}async initialized(){await this.initPromise}}async function rt(e){let t=await T(tF)._get(rn(e));return t&&await T(tF)._remove(rn(e)),t}function rn(e){return er("authEvent",e.config.apiKey,e.name)}function rr(e){if(!(null==e?void 0:e.includes("?")))return{};let[t,...n]=e.split("?");return(0,a.zd)(n.join("?"))}let ri=class{constructor(){this._redirectPersistence=tU,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=nx,this._overrideRedirectResult=nS}async _initialize(e){let t=e._key(),n=this.eventManagers.get(t);return n||(n=new re(e),this.eventManagers.set(t,n),this.attachCallbackListeners(e,n)),n}_openPopup(e){g(e,"operation-not-supported-in-this-environment")}async _openRedirect(e,t,n,r){!function(e){var t,n,r,i,s,a,o,l,u,c;let h=n4();I("function"==typeof(null==(t=null==h?void 0:h.universalLinks)?void 0:t.subscribe),e,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),I(void 0!==(null==(n=null==h?void 0:h.BuildInfo)?void 0:n.packageName),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),I("function"==typeof(null==(s=null==(i=null==(r=null==h?void 0:h.cordova)?void 0:r.plugins)?void 0:i.browsertab)?void 0:s.openUrl),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),I("function"==typeof(null==(l=null==(o=null==(a=null==h?void 0:h.cordova)?void 0:a.plugins)?void 0:o.browsertab)?void 0:l.isAvailable),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),I("function"==typeof(null==(c=null==(u=null==h?void 0:h.cordova)?void 0:u.InAppBrowser)?void 0:c.open),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}(e);let i=await this._initialize(e);await i.initialized(),i.resetRedirect(),nI.clear(),await this._originValidation(e);let s=function(e,t,n=null){return{type:t,eventId:n,urlResponse:null,sessionId:function(){let e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let n=0;n<20;n++){let n=Math.floor(Math.random()*t.length);e.push(t.charAt(n))}return e.join("")}(),postBody:null,tenantId:e.tenantId,error:y(e,"no-auth-event")}}(e,n,r);await T(tF)._set(rn(e),s);let o=await n5(e,s,t);return n8(e,i,await function(e){let{cordova:t}=n4();return new Promise(n=>{t.plugins.browsertab.isAvailable(r=>{let i=null;r?t.plugins.browsertab.openUrl(e):i=t.InAppBrowser.open(e,!function(e=(0,a.z$)()){return/(iPad|iPhone|iPod).*OS 7_\d/i.test(e)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(e)}()?"_system":"_blank","location=yes"),n(i)})})}(o))}_isIframeWebStorageSupported(e,t){throw Error("Method not implemented.")}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=n9(e)),this.originValidationPromises[t]}attachCallbackListeners(e,t){let{universalLinks:n,handleOpenURL:r,BuildInfo:i}=n4(),s=setTimeout(async()=>{await rt(e),t.onEvent(rs())},500),a=async n=>{clearTimeout(s);let r=await rt(e),i=null;r&&(null==n?void 0:n.url)&&(i=function(e,t){var n,r;let i=function(e){let t=rr(e),n=t.link?decodeURIComponent(t.link):void 0,r=rr(n).link,i=t.deep_link_id?decodeURIComponent(t.deep_link_id):void 0;return rr(i).link||i||r||n||e}(t);if(i.includes("/__/auth/callback")){let t=rr(i),s=t.firebaseError?function(e){try{return JSON.parse(e)}catch(e){return null}}(decodeURIComponent(t.firebaseError)):null,a=null==(r=null==(n=null==s?void 0:s.code)?void 0:n.split("auth/"))?void 0:r[1],o=a?y(a):null;return o?{type:e.type,eventId:e.eventId,tenantId:e.tenantId,error:o,urlResponse:null,sessionId:null,postBody:null}:{type:e.type,eventId:e.eventId,tenantId:e.tenantId,sessionId:e.sessionId,urlResponse:i,postBody:null}}return null}(r,n.url)),t.onEvent(i||rs())};void 0!==n&&"function"==typeof n.subscribe&&n.subscribe(null,a);let o=`${i.packageName.toLowerCase()}://`;n4().handleOpenURL=async e=>{if(e.toLowerCase().startsWith(o)&&a({url:e}),"function"==typeof r)try{r(e)}catch(e){console.error(e)}}}};function rs(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:y("no-auth-event")}}function ra(){var e;return(null==(e=null==self?void 0:self.location)?void 0:e.protocol)||null}function ro(e=(0,a.z$)()){return!!(("file:"===ra()||"ionic:"===ra()||"capacitor:"===ra())&&e.toLowerCase().match(/iphone|ipad|ipod|android/))}function rl(){try{let e=self.localStorage,t=tq();if(e){if(e.setItem(t,"1"),e.removeItem(t),function(e=(0,a.z$)()){return(0,a.w1)()&&(null==document?void 0:document.documentMode)===11||function(e=(0,a.z$)()){return/Edge\/\d+/.test(e)}(e)}())return(0,a.hl)();return!0}}catch(e){return ru()&&(0,a.hl)()}return!1}function ru(){return void 0!==n.g&&"WorkerGlobalScope"in n.g&&"importScripts"in n.g}function rc(){return("http:"===ra()||"https:"===ra()||(0,a.ru)()||ro())&&!((0,a.b$)()||(0,a.UG)())&&rl()&&!ru()}function rh(){return ro()&&"undefined"!=typeof document}async function rd(){return!!rh()&&new Promise(e=>{let t=setTimeout(()=>{e(!1)},1e3);document.addEventListener("deviceready",()=>{clearTimeout(t),e(!0)})})}let rf={LOCAL:"local",NONE:"none",SESSION:"session"},rp="persistence";async function rm(e){await e._initializationPromise;let t=rg(),n=er(rp,e.config.apiKey,e.name);t&&t.setItem(n,e._getPersistence())}function rg(){var e;try{return(null==(e="undefined"!=typeof window?window:null)?void 0:e.sessionStorage)||null}catch(e){return null}}class ry{constructor(){this.browserResolver=T(nJ),this.cordovaResolver=T(ri),this.underlyingResolver=null,this._redirectPersistence=tU,this._completeRedirectFn=nx,this._overrideRedirectResult=nS}async _initialize(e){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._initialize(e)}async _openPopup(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openPopup(e,t,n,r)}async _openRedirect(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openRedirect(e,t,n,r)}_isIframeWebStorageSupported(e,t){this.assertedUnderlyingResolver._isIframeWebStorageSupported(e,t)}_originValidation(e){return this.assertedUnderlyingResolver._originValidation(e)}get _shouldInitProactively(){return rh()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return I(this.underlyingResolver,"internal-error"),this.underlyingResolver}async selectUnderlyingResolver(){if(this.underlyingResolver)return;let e=await rd();this.underlyingResolver=e?this.cordovaResolver:this.browserResolver}}function rv(e){let t,{_tokenResponse:n}=e instanceof a.ZR?e.customData:e;if(!n)return null;if(!(e instanceof a.ZR)&&"temporaryProof"in n&&"phoneNumber"in n)return nu.credentialFromResult(e);let r=n.providerId;if(!r||"password"===r)return null;switch(r){case"google.com":t=eQ;break;case"facebook.com":t=eH;break;case"github.com":t=eY;break;case"twitter.com":t=eZ;break;default:let{oauthIdToken:i,oauthAccessToken:s,oauthTokenSecret:o,pendingToken:l,nonce:u}=n;if(!s&&!o&&!i&&!l)return null;if(l)if(r.startsWith("saml."))return eX._create(r,l);else return eM._fromParams({providerId:r,signInMethod:r,pendingToken:l,idToken:i,accessToken:s});return new eW(r).credential({idToken:i,accessToken:s,rawNonce:u})}return e instanceof a.ZR?t.credentialFromError(e):t.credentialFromResult(e)}function rw(e,t){return t.catch(t=>{throw t instanceof a.ZR&&function(e,t){var n;let r=null==(n=t.customData)?void 0:n._tokenResponse;if((null==t?void 0:t.code)==="auth/multi-factor-auth-required")t.resolver=new rI(e,function(e,t){var n;let r=(0,a.m9)(e);return I(t.customData.operationType,r,"argument-error"),I(null==(n=t.customData._serverResponse)?void 0:n.mfaPendingCredential,r,"argument-error"),tx._fromError(r,t)}(e,t));else if(r){let e=rv(t);e&&(t.credential=e,t.tenantId=r.tenantId||void 0,t.email=r.email||void 0,t.phoneNumber=r.phoneNumber||void 0)}}(e,t),t}).then(e=>{let t=e.operationType,n=e.user;return{operationType:t,credential:rv(e),additionalUserInfo:function(e){let{user:t,_tokenResponse:n}=e;return t.isAnonymous&&!n?{providerId:null,isNewUser:!1,profile:null}:function(e){var t,n;if(!e)return null;let{providerId:r}=e,i=e.rawUserInfo?JSON.parse(e.rawUserInfo):{},s=e.isNewUser||"identitytoolkit#SignupNewUserResponse"===e.kind;if(!r&&(null==e?void 0:e.idToken)){let r=null==(n=null==(t=z(e.idToken))?void 0:t.firebase)?void 0:n.sign_in_provider;if(r)return new tS(s,"anonymous"!==r&&"custom"!==r?r:null)}if(!r)return null;switch(r){case"facebook.com":return new tA(s,i);case"github.com":return new tC(s,i);case"google.com":return new tD(s,i);case"twitter.com":return new tN(s,i,e.screenName||null);case"custom":case"anonymous":return new tS(s,null);default:return new tS(s,r,i)}}(n)}(e),user:r_.getOrCreate(n)}})}async function rb(e,t){let n=await t;return{verificationId:n.verificationId,confirm:t=>rw(e,n.confirm(t))}}class rI{constructor(e,t){this.resolver=t,this.auth=e.wrapped()}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(e){return rw(this.auth.unwrap(),this.resolver.resolveSignIn(e))}}class r_{constructor(e){this._delegate=e,this.multiFactor=function(e){let t=(0,a.m9)(e);return tP.has(t)||tP.set(t,tO._fromUser(t)),tP.get(t)}(e)}static getOrCreate(e){return r_.USER_MAP.has(e)||r_.USER_MAP.set(e,new r_(e)),r_.USER_MAP.get(e)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(e){return this._delegate.getIdTokenResult(e)}getIdToken(e){return this._delegate.getIdToken(e)}linkAndRetrieveDataWithCredential(e){return this.linkWithCredential(e)}async linkWithCredential(e){return rw(this.auth,tr(this._delegate,e))}async linkWithPhoneNumber(e,t){return rb(this.auth,ns(this._delegate,e,t))}async linkWithPopup(e){return rw(this.auth,nw(this._delegate,e,ry))}async linkWithRedirect(e){return await rm(ev(this.auth)),nN(this._delegate,e,ry)}reauthenticateAndRetrieveDataWithCredential(e){return this.reauthenticateWithCredential(e)}async reauthenticateWithCredential(e){return rw(this.auth,ti(this._delegate,e))}reauthenticateWithPhoneNumber(e,t){return rb(this.auth,na(this._delegate,e,t))}reauthenticateWithPopup(e){return rw(this.auth,nv(this._delegate,e,ry))}async reauthenticateWithRedirect(e){return await rm(ev(this.auth)),nD(this._delegate,e,ry)}sendEmailVerification(e){return tb(this._delegate,e)}async unlink(e){return await e9(this._delegate,e),this}updateEmail(e){var t;return t=this._delegate,tT((0,a.m9)(t),e,null)}updatePassword(e){var t;return t=this._delegate,tT((0,a.m9)(t),null,e)}updatePhoneNumber(e){return nl(this._delegate,e)}updateProfile(e){return tE(this._delegate,e)}verifyBeforeUpdateEmail(e,t){return tI(this._delegate,e,t)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}r_.USER_MAP=new WeakMap;class rE{constructor(e,t){if(this.app=e,t.isInitialized()){this._delegate=t.getImmediate(),this.linkUnderlyingAuth();return}let{apiKey:n}=e.options;I(n,"invalid-api-key",{appName:e.name}),I(n,"invalid-api-key",{appName:e.name});let r="undefined"!=typeof window?ry:void 0;this._delegate=t.initialize({options:{persistence:function(e,t){let n=function(e,t){let n=rg();if(!n)return[];let r=er(rp,e,t);switch(n.getItem(r)){case rf.NONE:return[en];case rf.LOCAL:return[t0,tU];case rf.SESSION:return[tU];default:return[]}}(e,t);if("undefined"==typeof self||n.includes(t0)||n.push(t0),"undefined"!=typeof window)for(let e of[tF,tU])n.includes(e)||n.push(e);return n.includes(en)||n.push(en),n}(n,e.name),popupRedirectResolver:r}}),this._delegate._updateErrorMap(d),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?r_.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(e){this._delegate.languageCode=e}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(e){this._delegate.tenantId=e}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(e,t){!function(e,t,n){let r=ev(e);I(r._canInitEmulator,r,"emulator-config-failed"),I(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");let i=!!(null==n?void 0:n.disableWarnings),s=eb(t),{host:a,port:o}=function(e){let t=eb(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};let r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){let e=i[1];return{host:e,port:eI(r.substr(e.length+1))}}{let[e,t]=r.split(":");return{host:e,port:eI(t)}}}(t),l=null===o?"":`:${o}`;r.config.emulator={url:`${s}//${a}${l}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:a,port:o,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||function(){function e(){let e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(this._delegate,e,t)}applyActionCode(e){return td(this._delegate,e)}checkActionCode(e){return tf(this._delegate,e)}confirmPasswordReset(e,t){return th(this._delegate,e,t)}async createUserWithEmailAndPassword(e,t){return rw(this._delegate,tm(this._delegate,e,t))}fetchProvidersForEmail(e){return this.fetchSignInMethodsForEmail(e)}fetchSignInMethodsForEmail(e){return tw(this._delegate,e)}isSignInWithEmailLink(e){this._delegate;let t=e$.parseLink(e);return(null==t?void 0:t.operation)==="EMAIL_SIGNIN"}async getRedirectResult(){I(rc(),this._delegate,"operation-not-supported-in-this-environment");let e=await nR(this._delegate,ry);return e?rw(this._delegate,Promise.resolve(e)):{credential:null,user:null}}addFrameworkForLogging(e){var t;t=this._delegate,ev(t)._logFramework(e)}onAuthStateChanged(e,t,n){let{next:r,error:i,complete:s}=rT(e,t,n);return this._delegate.onAuthStateChanged(r,i,s)}onIdTokenChanged(e,t,n){let{next:r,error:i,complete:s}=rT(e,t,n);return this._delegate.onIdTokenChanged(r,i,s)}sendSignInLinkToEmail(e,t){return tg(this._delegate,e,t)}sendPasswordResetEmail(e,t){return tc(this._delegate,e,t||void 0)}async setPersistence(e){var t;let n;switch(t=this._delegate,(I(Object.values(rf).includes(e),t,"invalid-persistence-type"),(0,a.b$)())?I(e!==rf.SESSION,t,"unsupported-persistence-type"):(0,a.UG)()?I(e===rf.NONE,t,"unsupported-persistence-type"):ru()?I(e===rf.NONE||e===rf.LOCAL&&(0,a.hl)(),t,"unsupported-persistence-type"):I(e===rf.NONE||rl(),t,"unsupported-persistence-type"),e){case rf.SESSION:n=tU;break;case rf.LOCAL:n=await T(t0)._isAvailable()?t0:tF;break;case rf.NONE:n=en;break;default:return g("argument-error",{appName:this._delegate.name})}return this._delegate.setPersistence(n)}signInAndRetrieveDataWithCredential(e){return this.signInWithCredential(e)}signInAnonymously(){return rw(this._delegate,e3(this._delegate))}signInWithCredential(e){return rw(this._delegate,tn(this._delegate,e))}signInWithCustomToken(e){return rw(this._delegate,ta(this._delegate,e))}signInWithEmailAndPassword(e,t){var n;return rw(this._delegate,(n=this._delegate,tn((0,a.m9)(n),eG.credential(e,t))))}signInWithEmailLink(e,t){return rw(this._delegate,ty(this._delegate,e,t))}signInWithPhoneNumber(e,t){return rb(this._delegate,ni(this._delegate,e,t))}async signInWithPopup(e){return I(rc(),this._delegate,"operation-not-supported-in-this-environment"),rw(this._delegate,ny(this._delegate,e,ry))}async signInWithRedirect(e){return I(rc(),this._delegate,"operation-not-supported-in-this-environment"),await rm(this._delegate),nC(this._delegate,e,ry)}updateCurrentUser(e){return this._delegate.updateCurrentUser(e)}verifyPasswordResetCode(e){return tp(this._delegate,e)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}function rT(e,t,n){let r=e;"function"!=typeof e&&({next:r,error:t,complete:n}=e);let i=r;return{next:e=>i(e&&r_.getOrCreate(e)),error:t,complete:n}}rE.Persistence=rf;class rS{constructor(){this.providerId="phone",this._delegate=new nu(s.Z.auth().unwrap())}static credential(e,t){return nu.credential(e,t)}verifyPhoneNumber(e,t){return this._delegate.verifyPhoneNumber(e,t)}unwrap(){return this._delegate}}rS.PHONE_SIGN_IN_METHOD=nu.PHONE_SIGN_IN_METHOD,rS.PROVIDER_ID=nu.PROVIDER_ID;(i=s.Z).INTERNAL.registerComponent(new c.wA("auth-compat",e=>new rE(e.getProvider("app-compat").getImmediate(),e.getProvider("auth")),"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"}},EmailAuthProvider:eG,FacebookAuthProvider:eH,GithubAuthProvider:eY,GoogleAuthProvider:eQ,OAuthProvider:eW,SAMLAuthProvider:eJ,PhoneAuthProvider:rS,PhoneMultiFactorGenerator:n1,RecaptchaVerifier:class e{constructor(e,t,n=s.Z.app()){var r;I(null==(r=n.options)?void 0:r.apiKey,"invalid-api-key",{appName:n.name}),this._delegate=new nn(e,t,n.auth()),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}},TwitterAuthProvider:eZ,Auth:rE,AuthCredential:e_,Error:a.ZR}).setInstantiationMode("LAZY").setMultipleInstances(!1)),i.registerVersion("@firebase/auth-compat","0.3.3")},74067:function(e,t,n){"use strict";var r,i,s,a,o,l,u,c,h,d,f=n(99789),p=n(36513),m=n(86808),g=n(13660),y=n(83395),v="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self?self:{},w={},b=b||{},I=v||self;function _(){}function E(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function T(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function S(e,t,n){return e.call.apply(e.bind,arguments)}function k(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function A(e,t,n){return(A=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?S:k).apply(null,arguments)}function C(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function D(e,t){function n(){}n.prototype=t.prototype,e.X=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Wb=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}function N(){this.s=this.s,this.o=this.o}N.prototype.s=!1,N.prototype.na=function(){this.s||(this.s=!0,this.M())},N.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};let R=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return -1};function x(e){let t=e.length;if(0<t){let n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function O(e,t){for(let t=1;t<arguments.length;t++){let n=arguments[t];if(E(n)){let t=e.length||0,r=n.length||0;e.length=t+r;for(let i=0;i<r;i++)e[t+i]=n[i]}else e.push(n)}}function P(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}P.prototype.h=function(){this.defaultPrevented=!0};var L=function(){if(!I.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{I.addEventListener("test",_,t),I.removeEventListener("test",_,t)}catch(e){}return e}();function M(e){return/^[\s\xa0]*$/.test(e)}var F=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function U(){var e=I.navigator;return e&&(e=e.userAgent)?e:""}function V(e){return -1!=U().indexOf(e)}function q(e){return q[" "](e),e}q[" "]=_;var B=V("Opera"),j=V("Trident")||V("MSIE"),$=V("Edge"),G=$||j,K=V("Gecko")&&!(-1!=U().toLowerCase().indexOf("webkit")&&!V("Edge"))&&!(V("Trident")||V("MSIE"))&&!V("Edge"),z=-1!=U().toLowerCase().indexOf("webkit")&&!V("Edge");function W(){var e=I.document;return e?e.documentMode:void 0}e:{var H,Q="",Y=(H=U(),K?/rv:([^\);]+)(\)|;)/.exec(H):$?/Edge\/([\d\.]+)/.exec(H):j?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(H):z?/WebKit\/(\S+)/.exec(H):B?/(?:Version)[ \/]?(\S+)/.exec(H):void 0);if(Y&&(Q=Y?Y[1]:""),j){var X=W();if(null!=X&&X>parseFloat(Q)){a=String(X);break e}}a=Q}var J={},Z=o=I.document&&j&&(W()||parseInt(a,10))||void 0;function ee(e,t){if(P.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(K){e:{try{q(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:et[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&ee.X.h.call(this)}}D(ee,P);var et={2:"touch",3:"pen",4:"mouse"};ee.prototype.h=function(){ee.X.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var en="closure_listenable_"+(1e6*Math.random()|0),er=0;function ei(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=i,this.key=++er,this.ba=this.ea=!1}function es(e){e.ba=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function ea(e,t,n){for(let r in e)t.call(n,e[r],r,e)}function eo(e){let t={};for(let n in e)t[n]=e[n];return t}let el="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function eu(e,t){let n,r;for(let t=1;t<arguments.length;t++){for(n in r=arguments[t])e[n]=r[n];for(let t=0;t<el.length;t++)n=el[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function ec(e){this.src=e,this.g={},this.h=0}function eh(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],s=R(i,t);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(es(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function ed(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.ba&&s.listener==t&&!!n==s.capture&&s.ha==r)return i}return -1}ec.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var a=ed(e,t,r,i);return -1<a?(t=e[a],n||(t.ea=!1)):((t=new ei(t,this.src,s,!!r,i)).ea=n,e.push(t)),t};var ef="closure_lm_"+(1e6*Math.random()|0),ep={};function em(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var a=T(i)?!!i.capture:!!i,o=ew(e);if(o||(e[ef]=o=new ec(e)),(n=o.add(t,n,r,a,s)).proxy)return n;if(r=function e(t){return ev.call(e.src,e.listener,t)},n.proxy=r,r.src=e,r.listener=n,e.addEventListener)L||(i=a),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(ey(t.toString()),r);else if(e.addListener&&e.removeListener)e.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return n}function eg(e){if("number"!=typeof e&&e&&!e.ba){var t=e.src;if(t&&t[en])eh(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(ey(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=ew(t))?(eh(n,e),0==n.h&&(n.src=null,t[ef]=null)):es(e)}}}function ey(e){return e in ep?ep[e]:ep[e]="on"+e}function ev(e,t){if(e.ba)e=!0;else{t=new ee(t,this);var n=e.listener,r=e.ha||e.src;e.ea&&eg(e),e=n.call(r,t)}return e}function ew(e){return(e=e[ef])instanceof ec?e:null}var eb="__closure_events_fn_"+(1e9*Math.random()>>>0);function eI(e){return"function"==typeof e?e:(e[eb]||(e[eb]=function(t){return e.handleEvent(t)}),e[eb])}function e_(){N.call(this),this.i=new ec(this),this.P=this,this.I=null}function eE(e,t){var n,r=e.I;if(r)for(n=[];r;r=r.I)n.push(r);if(e=e.P,r=t.type||t,"string"==typeof t)t=new P(t,e);else if(t instanceof P)t.target=t.target||e;else{var i=t;eu(t=new P(r,e),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var a=t.g=n[s];i=eT(a,r,!0,t)&&i}if(i=eT(a=t.g=e,r,!0,t)&&i,i=eT(a,r,!1,t)&&i,n)for(s=0;s<n.length;s++)i=eT(a=t.g=n[s],r,!1,t)&&i}function eT(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var a=t[s];if(a&&!a.ba&&a.capture==n){var o=a.listener,l=a.ha||a.src;a.ea&&eh(e.i,a),i=!1!==o.call(l,r)&&i}}return i&&!r.defaultPrevented}D(e_,N),e_.prototype[en]=!0,e_.prototype.removeEventListener=function(e,t,n,r){!function e(t,n,r,i,s){if(Array.isArray(n))for(var a=0;a<n.length;a++)e(t,n[a],r,i,s);else(i=T(i)?!!i.capture:!!i,r=eI(r),t&&t[en])?(t=t.i,(n=String(n).toString())in t.g&&-1<(r=ed(a=t.g[n],r,i,s))&&(es(a[r]),Array.prototype.splice.call(a,r,1),0==a.length&&(delete t.g[n],t.h--))):t&&(t=ew(t))&&(n=t.g[n.toString()],t=-1,n&&(t=ed(n,r,i,s)),(r=-1<t?n[t]:null)&&eg(r))}(this,e,t,n,r)},e_.prototype.M=function(){if(e_.X.M.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)es(n[r]);delete t.g[e],t.h--}}this.I=null},e_.prototype.N=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},e_.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var eS=I.JSON.stringify,ek=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new eA,e=>e.reset());class eA{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function eC(e,t){var n;l||(n=I.Promise.resolve(void 0),l=function(){n.then(eR)}),eD||(l(),eD=!0),eN.add(e,t)}var eD=!1,eN=new class{constructor(){this.h=this.g=null}add(e,t){let n=ek.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}};function eR(){let e;for(var t;e=null,eN.g&&(e=eN.g,eN.g=eN.g.next,eN.g||(eN.h=null),e.next=null),t=e;){try{t.h.call(t.g)}catch(e){!function(e){I.setTimeout(()=>{throw e},0)}(e)}ek.j(t),100>ek.h&&(ek.h++,t.next=ek.g,ek.g=t)}eD=!1}function ex(e,t){e_.call(this),this.h=e||1,this.g=t||I,this.j=A(this.lb,this),this.l=Date.now()}function eO(e){e.ca=!1,e.R&&(e.g.clearTimeout(e.R),e.R=null)}function eP(e,t,n){if("function"==typeof e)n&&(e=A(e,n));else if(e&&"function"==typeof e.handleEvent)e=A(e.handleEvent,e);else throw Error("Invalid listener argument");return 0x7fffffff<Number(t)?-1:I.setTimeout(e,t||0)}D(ex,e_),(d=ex.prototype).ca=!1,d.R=null,d.lb=function(){if(this.ca){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.R=this.g.setTimeout(this.j,this.h-e):(this.R&&(this.g.clearTimeout(this.R),this.R=null),eE(this,"tick"),this.ca&&(eO(this),this.start()))}},d.start=function(){this.ca=!0,this.R||(this.R=this.g.setTimeout(this.j,this.h),this.l=Date.now())},d.M=function(){ex.X.M.call(this),eO(this),delete this.g};class eL extends N{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=eP(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.j);let n=t.h;t.h=null,t.m.apply(null,n)}(this)}M(){super.M(),this.g&&(I.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function eM(e){N.call(this),this.h=e,this.g={}}D(eM,N);var eF=[];function eU(e,t,n,r){Array.isArray(n)||(n&&(eF[0]=n.toString()),n=eF);for(var i=0;i<n.length;i++){var s=function e(t,n,r,i,s){if(i&&i.once)return function e(t,n,r,i,s){if(Array.isArray(n)){for(var a=0;a<n.length;a++)e(t,n[a],r,i,s);return null}return r=eI(r),t&&t[en]?t.O(n,r,T(i)?!!i.capture:!!i,s):em(t,n,r,!0,i,s)}(t,n,r,i,s);if(Array.isArray(n)){for(var a=0;a<n.length;a++)e(t,n[a],r,i,s);return null}return r=eI(r),t&&t[en]?t.N(n,r,T(i)?!!i.capture:!!i,s):em(t,n,r,!1,i,s)}(t,n[i],r||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function eV(e){ea(e.g,function(e,t){this.g.hasOwnProperty(t)&&eg(e)},e),e.g={}}function eq(){this.g=!0}function eB(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n){for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var a=1;a<i.length;a++)i[a]=""}}}}return eS(n)}catch(e){return t}}(e,n)+(r?" "+r:"")})}eM.prototype.M=function(){eM.X.M.call(this),eV(this)},eM.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},eq.prototype.Aa=function(){this.g=!1},eq.prototype.info=function(){};var ej={},e$=null;function eG(){return e$=e$||new e_}function eK(e){P.call(this,ej.Pa,e)}function ez(e){let t=eG();eE(t,new eK(t))}function eW(e,t){P.call(this,ej.STAT_EVENT,e),this.stat=t}function eH(e){let t=eG();eE(t,new eW(t,e))}function eQ(e,t){P.call(this,ej.Qa,e),this.size=t}function eY(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return I.setTimeout(function(){e()},t)}ej.Pa="serverreachability",D(eK,P),ej.STAT_EVENT="statevent",D(eW,P),ej.Qa="timingevent",D(eQ,P);var eX={NO_ERROR:0,mb:1,zb:2,yb:3,tb:4,xb:5,Ab:6,Ma:7,TIMEOUT:8,Db:9},eJ={rb:"complete",Nb:"success",Na:"error",Ma:"abort",Fb:"ready",Gb:"readystatechange",TIMEOUT:"timeout",Bb:"incrementaldata",Eb:"progress",ub:"downloadprogress",Vb:"uploadprogress"};function eZ(){}function e0(e){return e.h||(e.h=e.i())}function e1(){}eZ.prototype.h=null;var e2={OPEN:"a",qb:"b",Na:"c",Cb:"d"};function e3(){P.call(this,"d")}function e6(){P.call(this,"c")}function e4(){}function e5(e,t,n,r){this.l=e,this.j=t,this.m=n,this.U=r||1,this.S=new eM(this),this.O=e8,e=G?125:void 0,this.T=new ex(e),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.V=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.Y=-1,this.I=!1,this.N=0,this.L=null,this.$=this.J=this.Z=this.P=!1,this.h=new e9}function e9(){this.i=null,this.g="",this.h=!1}D(e3,P),D(e6,P),D(e4,eZ),e4.prototype.g=function(){return new XMLHttpRequest},e4.prototype.i=function(){return{}},u=new e4;var e8=45e3,e7={},te={};function tt(e,t,n){e.K=1,e.v=tw(tp(t)),e.s=n,e.P=!0,tn(e,null)}function tn(e,t){e.F=Date.now(),ts(e),e.A=tp(e.v);var n,r,i,s,a,o,l=e.A,u=e.U;Array.isArray(u)||(u=[String(u)]),tx(l.i,"t",u),e.C=0,l=e.l.H,e.h=new e9,e.g=nI(e.l,l?t:null,!e.s),0<e.N&&(e.L=new eL(A(e.La,e,e.g),e.N)),eU(e.S,e.g,"readystatechange",e.ib),t=e.H?eo(e.H):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.da(e.A,e.u,e.s,t)):(e.u="GET",e.g.da(e.A,e.u,null,t)),ez(),n=e.j,r=e.u,i=e.A,s=e.m,a=e.U,o=e.s,n.info(function(){if(n.g)if(o)for(var e="",t=o.split("&"),l=0;l<t.length;l++){var u=t[l].split("=");if(1<u.length){var c=u[0];u=u[1];var h=c.split("_");e=2<=h.length&&"type"==h[1]?e+(c+"=")+u+"&":e+(c+"=redacted&")}}else e=null;else e=o;return"XMLHTTP REQ ("+s+") [attempt "+a+"]: "+r+"\n"+i+"\n"+e})}function tr(e){return!!e.g&&"GET"==e.u&&2!=e.K&&e.l.Da}function ti(e,t,n){let r=!0,i;for(;!e.I&&e.C<n.length;)if((i=function(e,t){var n=e.C,r=t.indexOf("\n",n);return -1==r?te:isNaN(n=Number(t.substring(n,r)))?e7:(r+=1)+n>t.length?te:(t=t.substr(r,n),e.C=r+n,t)}(e,n))==te){4==t&&(e.o=4,eH(14),r=!1),eB(e.j,e.m,null,"[Incomplete Response]");break}else if(i==e7){e.o=4,eH(15),eB(e.j,e.m,n,"[Invalid Chunk]"),r=!1;break}else eB(e.j,e.m,i,null),tc(e,i);tr(e)&&i!=te&&i!=e7&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,eH(16),r=!1),e.i=e.i&&r,r?0<n.length&&!e.$&&(e.$=!0,(t=e.l).g==e&&t.$&&!t.K&&(t.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),nf(t),t.K=!0,eH(11))):(eB(e.j,e.m,n,"[Invalid Chunked Response]"),tu(e),tl(e))}function ts(e){e.V=Date.now()+e.O,ta(e,e.O)}function ta(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=eY(A(e.gb,e),t)}function to(e){e.B&&(I.clearTimeout(e.B),e.B=null)}function tl(e){0==e.l.G||e.I||ng(e.l,e)}function tu(e){to(e);var t=e.L;t&&"function"==typeof t.na&&t.na(),e.L=null,eO(e.T),eV(e.S),e.g&&(t=e.g,e.g=null,t.abort(),t.na())}function tc(e,t){try{var n=e.l;if(0!=n.G&&(n.g==e||tV(n.h,e))){if(!e.J&&tV(n.h,e)&&3==n.G){try{var r=n.Fa.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g)if(n.g.F+3e3<e.F)nm(n),ns(n);else break e;nd(n),eH(18)}}else n.Ba=i[1],0<n.Ba-n.T&&37500>i[2]&&n.L&&0==n.A&&!n.v&&(n.v=eY(A(n.cb,n),6e3));if(1>=tU(n.h)&&n.ja){try{n.ja()}catch(e){}n.ja=void 0}}else nv(n,11)}else if((e.J||n.g==e)&&nm(n),!M(t))for(i=n.Fa.g.parse(t),t=0;t<i.length;t++){let o=i[t];if(n.T=o[0],o=o[1],2==n.G)if("c"==o[0]){n.I=o[1],n.ka=o[2];let t=o[3];null!=t&&(n.ma=t,n.j.info("VER="+n.ma));let i=o[4];null!=i&&(n.Ca=i,n.j.info("SVER="+n.Ca));let l=o[5];null!=l&&"number"==typeof l&&0<l&&(n.J=r=1.5*l,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;let u=e.g;if(u){let e=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.h;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(tq(s,s.h),s.h=null))}if(r.D){let e=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.za=e,tv(r.F,r.D,e))}}if(n.G=3,n.l&&n.l.xa(),n.$&&(n.P=Date.now()-e.F,n.j.info("Handshake RTT: "+n.P+"ms")),(r=n).sa=nb(r,r.H?r.ka:null,r.V),e.J){tB(r.h,e);var a=r.J;a&&e.setTimeout(a),e.B&&(to(e),ts(e)),r.g=e}else nh(r);0<n.i.length&&no(n)}else"stop"!=o[0]&&"close"!=o[0]||nv(n,7);else 3==n.G&&("stop"==o[0]||"close"==o[0]?"stop"==o[0]?nv(n,7):ni(n):"noop"!=o[0]&&n.l&&n.l.wa(o),n.A=0)}}ez(4)}catch(e){}}function th(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(E(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.oa&&"function"==typeof e.oa)return e.oa();if(!e.W||"function"!=typeof e.W){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(E(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}for(let r in t=[],n=0,e)t[n++]=r;return t}}}(e),r=function(e){if(e.W&&"function"==typeof e.W)return e.W();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(E(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length,s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}(d=e5.prototype).setTimeout=function(e){this.O=e},d.ib=function(e){e=e.target;let t=this.L;t&&3==t8(e)?t.l():this.La(e)},d.La=function(e){try{if(e==this.g)e:{let g=t8(this.g);var t=this.g.Ea();let y=this.g.aa();if(!(3>g)&&(3!=g||G||this.g&&(this.h.h||this.g.fa()||t7(this.g)))){this.I||4!=g||7==t||(8==t||0>=y?ez(3):ez(2)),to(this);var n=this.g.aa();this.Y=n;t:if(tr(this)){var r=t7(this.g);e="";var i=r.length,s=4==t8(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){tu(this),tl(this);var a="";break t}this.h.i=new I.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:s&&t==i-1});r.splice(0,i),this.h.g+=e,this.C=0,a=this.h.g}else a=this.g.fa();if(this.i=200==n,o=this.j,l=this.u,u=this.A,c=this.m,h=this.U,d=n,o.info(function(){return"XMLHTTP RESP ("+c+") [ attempt "+h+"]: "+l+"\n"+u+"\n"+g+" "+d}),this.i){if(this.Z&&!this.J){t:{if(this.g){var o,l,u,c,h,d,f,p=this.g;if((f=p.g?p.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!M(f)){var m=f;break t}}m=null}if(n=m)eB(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,tc(this,n);else{this.i=!1,this.o=3,eH(12),tu(this),tl(this);break e}}this.P?(ti(this,g,a),G&&this.i&&3==g&&(eU(this.S,this.T,"tick",this.hb),this.T.start())):(eB(this.j,this.m,a,null),tc(this,a)),4==g&&tu(this),this.i&&!this.I&&(4==g?ng(this.l,this):(this.i=!1,ts(this)))}else 400==n&&0<a.indexOf("Unknown SID")?(this.o=3,eH(12)):(this.o=0,eH(13)),tu(this),tl(this)}}}catch(e){}finally{}},d.hb=function(){if(this.g){var e=t8(this.g),t=this.g.fa();this.C<t.length&&(to(this),ti(this,e,t),this.i&&4!=e&&ts(this))}},d.cancel=function(){this.I=!0,tu(this)},d.gb=function(){var e,t;this.B=null;let n=Date.now();0<=n-this.V?(e=this.j,t=this.A,e.info(function(){return"TIMEOUT: "+t}),2!=this.K&&(ez(),eH(17)),tu(this),this.o=2,tl(this)):ta(this,this.V-n)};var td=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function tf(e,t){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,e instanceof tf){this.h=void 0!==t?t:e.h,tm(this,e.j),this.s=e.s,this.g=e.g,tg(this,e.m),this.l=e.l,t=e.i;var n=new tC;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),ty(this,n),this.o=e.o}else e&&(n=String(e).match(td))?(this.h=!!t,tm(this,n[1]||"",!0),this.s=tb(n[2]||""),this.g=tb(n[3]||"",!0),tg(this,n[4]),this.l=tb(n[5]||"",!0),ty(this,n[6]||"",!0),this.o=tb(n[7]||"")):(this.h=!!t,this.i=new tC(null,this.h))}function tp(e){return new tf(e)}function tm(e,t,n){e.j=n?tb(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function tg(e,t){if(t){if(isNaN(t=Number(t))||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function ty(e,t,n){var r,i;t instanceof tC?(e.i=t,r=e.i,(i=e.h)&&!r.j&&(tD(r),r.i=null,r.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(tN(this,t),tx(this,n,e))},r)),r.j=i):(n||(t=tI(t,tk)),e.i=new tC(t,e.h))}function tv(e,t,n){e.i.set(t,n)}function tw(e){return tv(e,"zx",Math.floor(0x80000000*Math.random()).toString(36)+Math.abs(Math.floor(0x80000000*Math.random())^Date.now()).toString(36)),e}function tb(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function tI(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,t_),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function t_(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}tf.prototype.toString=function(){var e=[],t=this.j;t&&e.push(tI(t,tE,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(tI(t,tE,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(tI(n,"/"==n.charAt(0)?tS:tT,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.o)&&e.push("#",tI(n,tA)),e.join("")};var tE=/[#\/\?@]/g,tT=/[#\?:]/g,tS=/[#\?]/g,tk=/[#\?@]/g,tA=/#/g;function tC(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function tD(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var s=e[n].substring(0,r);i=e[n].substring(r+1)}else s=e[n];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function tN(e,t){tD(e),t=tO(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function tR(e,t){return tD(e),t=tO(e,t),e.g.has(t)}function tx(e,t,n){tN(e,t),0<n.length&&(e.i=null,e.g.set(tO(e,t),x(n)),e.h+=n.length)}function tO(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}(d=tC.prototype).add=function(e,t){tD(this),this.i=null,e=tO(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},d.forEach=function(e,t){tD(this),this.g.forEach(function(n,r){n.forEach(function(n){e.call(t,n,r,this)},this)},this)},d.oa=function(){tD(this);let e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){let i=e[r];for(let e=0;e<i.length;e++)n.push(t[r])}return n},d.W=function(e){tD(this);let t=[];if("string"==typeof e)tR(this,e)&&(t=t.concat(this.g.get(tO(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},d.set=function(e,t){return tD(this),this.i=null,tR(this,e=tO(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},d.get=function(e,t){return e&&0<(e=this.W(e)).length?String(e[0]):t},d.toString=function(){if(this.i)return this.i;if(!this.g)return"";let e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];let s=encodeURIComponent(String(r)),a=this.W(r);for(r=0;r<a.length;r++){var i=s;""!==a[r]&&(i+="="+encodeURIComponent(String(a[r]))),e.push(i)}}return this.i=e.join("&")};var tP=class{constructor(e,t){this.h=e,this.g=t}};function tL(e){this.l=e||tM,e=I.PerformanceNavigationTiming?0<(e=I.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(I.g&&I.g.Ga&&I.g.Ga()&&I.g.Ga().$b),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var tM=10;function tF(e){return!!e.h||!!e.g&&e.g.size>=e.j}function tU(e){return e.h?1:e.g?e.g.size:0}function tV(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function tq(e,t){e.g?e.g.add(t):e.h=t}function tB(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function tj(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(let n of e.g.values())t=t.concat(n.D);return t}return x(e.i)}function t$(){}function tG(){this.g=new t$}function tK(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(e){}}function tz(e){this.l=e.ac||null,this.j=e.jb||!1}function tW(e,t){e_.call(this),this.D=e,this.u=t,this.m=void 0,this.readyState=tH,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}tL.prototype.cancel=function(){if(this.i=tj(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(let e of this.g.values())e.cancel();this.g.clear()}},t$.prototype.stringify=function(e){return I.JSON.stringify(e,void 0)},t$.prototype.parse=function(e){return I.JSON.parse(e,void 0)},D(tz,eZ),tz.prototype.g=function(){return new tW(this.l,this.j)},tz.prototype.i=(r={},function(){return r}),D(tW,e_);var tH=0;function tQ(e){e.j.read().then(e.Ta.bind(e)).catch(e.ga.bind(e))}function tY(e){e.readyState=4,e.l=null,e.j=null,e.A=null,tX(e)}function tX(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(d=tW.prototype).open=function(e,t){if(this.readyState!=tH)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,tX(this)},d.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;let t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||I).fetch(new Request(this.B,t)).then(this.Wa.bind(this),this.ga.bind(this))},d.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,tY(this)),this.readyState=tH},d.Wa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,tX(this)),this.g&&(this.readyState=3,tX(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ua.bind(this),this.ga.bind(this));else if(void 0!==I.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;tQ(this)}else e.text().then(this.Va.bind(this),this.ga.bind(this))},d.Ta=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?tY(this):tX(this),3==this.readyState&&tQ(this)}},d.Va=function(e){this.g&&(this.response=this.responseText=e,tY(this))},d.Ua=function(e){this.g&&(this.response=e,tY(this))},d.ga=function(){this.g&&tY(this)},d.setRequestHeader=function(e,t){this.v.append(e,t)},d.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},d.getAllResponseHeaders=function(){if(!this.h)return"";let e=[],t=this.h.entries();for(var n=t.next();!n.done;)e.push((n=n.value)[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(tW.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var tJ=I.JSON.parse;function tZ(e){e_.call(this),this.headers=new Map,this.u=e||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=t0,this.K=this.L=!1}D(tZ,e_);var t0="",t1=/^https?$/i,t2=["POST","PUT"];function t3(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,t6(e),t5(e)}function t6(e){e.D||(e.D=!0,eE(e,"complete"),eE(e,"error"))}function t4(e){if(e.h&&void 0!==b&&(!e.C[1]||4!=t8(e)||2!=e.aa())){if(e.v&&4==t8(e))eP(e.Ha,0,e);else if(eE(e,"readystatechange"),4==t8(e)){e.h=!1;try{let o=e.aa();switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t,n,r=!0;break;default:r=!1}if(!(t=r)){if(n=0===o){var i=String(e.H).match(td)[1]||null;if(!i&&I.self&&I.self.location){var s=I.self.location.protocol;i=s.substr(0,s.length-1)}n=!t1.test(i?i.toLowerCase():"")}t=n}if(t)eE(e,"complete"),eE(e,"success");else{e.m=6;try{var a=2<t8(e)?e.g.statusText:""}catch(e){a=""}e.j=a+" ["+e.aa()+"]",t6(e)}}finally{t5(e)}}}}function t5(e,t){if(e.g){t9(e);let n=e.g,r=e.C[0]?_:null;e.g=null,e.C=null,t||eE(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function t9(e){e.g&&e.K&&(e.g.ontimeout=null),e.A&&(I.clearTimeout(e.A),e.A=null)}function t8(e){return e.g?e.g.readyState:0}function t7(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.J){case t0:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function ne(e){let t="";return ea(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}function nt(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=ne(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):tv(e,t,n))}function nn(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function nr(e){this.Ca=0,this.i=[],this.j=new eq,this.ka=this.sa=this.F=this.V=this.g=this.za=this.D=this.ia=this.o=this.S=this.s=null,this.ab=this.U=0,this.Za=nn("failFast",!1,e),this.L=this.v=this.u=this.m=this.l=null,this.Y=!0,this.pa=this.Ba=this.T=-1,this.Z=this.A=this.C=0,this.Xa=nn("baseRetryDelayMs",5e3,e),this.bb=nn("retryDelaySeedMs",1e4,e),this.$a=nn("forwardChannelMaxRetries",2,e),this.ta=nn("forwardChannelRequestTimeoutMs",2e4,e),this.ra=e&&e.xmlHttpFactory||void 0,this.Da=e&&e.Zb||!1,this.J=void 0,this.H=e&&e.supportsCrossDomainXhr||!1,this.I="",this.h=new tL(e&&e.concurrentRequestLimit),this.Fa=new tG,this.O=e&&e.fastHandshake||!1,this.N=e&&e.encodeInitMessageHeaders||!1,this.O&&this.N&&(this.N=!1),this.Ya=e&&e.Xb||!1,e&&e.Aa&&this.j.Aa(),e&&e.forceLongPolling&&(this.Y=!1),this.$=!this.O&&this.Y&&e&&e.detectBufferingProxy||!1,this.ja=void 0,this.P=0,this.K=!1,this.la=this.B=null}function ni(e){if(na(e),3==e.G){var t=e.U++,n=tp(e.F);tv(n,"SID",e.I),tv(n,"RID",t),tv(n,"TYPE","terminate"),nu(e,n),(t=new e5(e,e.j,t,void 0)).K=2,t.v=tw(tp(n)),n=!1,I.navigator&&I.navigator.sendBeacon&&(n=I.navigator.sendBeacon(t.v.toString(),"")),!n&&I.Image&&((new Image).src=t.v,n=!0),n||(t.g=nI(t.l,null),t.g.da(t.v)),t.F=Date.now(),ts(t)}nw(e)}function ns(e){e.g&&(nf(e),e.g.cancel(),e.g=null)}function na(e){ns(e),e.u&&(I.clearTimeout(e.u),e.u=null),nm(e),e.h.cancel(),e.m&&("number"==typeof e.m&&I.clearTimeout(e.m),e.m=null)}function no(e){tF(e.h)||e.m||(e.m=!0,eC(e.Ja,e),e.C=0)}function nl(e,t){var n;n=t?t.m:e.U++;let r=tp(e.F);tv(r,"SID",e.I),tv(r,"RID",n),tv(r,"AID",e.T),nu(e,r),e.o&&e.s&&nt(r,e.o,e.s),n=new e5(e,e.j,n,e.C+1),null===e.o&&(n.H=e.s),t&&(e.i=t.D.concat(e.i)),t=nc(e,n,1e3),n.setTimeout(Math.round(.5*e.ta)+Math.round(.5*e.ta*Math.random())),tq(e.h,n),tt(n,r,t)}function nu(e,t){e.ia&&ea(e.ia,function(e,n){tv(t,n,e)}),e.l&&th({},function(e,n){tv(t,n,e)})}function nc(e,t,n){n=Math.min(e.i.length,n);var r=e.l?A(e.l.Ra,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){let e=["count="+n];-1==t?0<n?(t=i[0].h,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let a=0;a<n;a++){let n=i[a].h,o=i[a].g;if(0>(n-=t))t=Math.max(0,i[a].h-100),s=!1;else try{!function(e,t,n){let r=n||"";try{th(e,function(e,n){let i=e;T(e)&&(i=eS(e)),t.push(r+n+"="+encodeURIComponent(i))})}catch(e){throw t.push(r+"type="+encodeURIComponent("_badmap")),e}}(o,e,"req"+n+"_")}catch(e){r&&r(o)}}if(s){r=e.join("&");break e}}}return t.D=e=e.i.splice(0,n),r}function nh(e){e.g||e.u||(e.Z=1,eC(e.Ia,e),e.A=0)}function nd(e){return!e.g&&!e.u&&!(3<=e.A)&&(e.Z++,e.u=eY(A(e.Ia,e),ny(e,e.A)),e.A++,!0)}function nf(e){null!=e.B&&(I.clearTimeout(e.B),e.B=null)}function np(e){e.g=new e5(e,e.j,"rpc",e.Z),null===e.o&&(e.g.H=e.s),e.g.N=0;var t=tp(e.sa);tv(t,"RID","rpc"),tv(t,"SID",e.I),tv(t,"CI",e.L?"0":"1"),tv(t,"AID",e.T),tv(t,"TYPE","xmlhttp"),nu(e,t),e.o&&e.s&&nt(t,e.o,e.s),e.J&&e.g.setTimeout(e.J);var n=e.g;e=e.ka,n.K=1,n.v=tw(tp(t)),n.s=null,n.P=!0,tn(n,e)}function nm(e){null!=e.v&&(I.clearTimeout(e.v),e.v=null)}function ng(e,t){var n,r=null;if(e.g==t){nm(e),nf(e),e.g=null;var i=2}else{if(!tV(e.h,t))return;r=t.D,tB(e.h,t),i=1}if(0!=e.G){if(e.pa=t.Y,t.i)if(1==i){r=t.s?t.s.length:0,t=Date.now()-t.F;var s=e.C;eE(i=eG(),new eQ(i,r)),no(e)}else nh(e);else if(3==(s=t.o)||0==s&&0<e.pa||!(1==i&&(n=t,!(tU(e.h)>=e.h.j-!!e.m)&&(e.m?(e.i=n.D.concat(e.i),!0):1!=e.G&&2!=e.G&&!(e.C>=(e.Za?0:e.$a))&&(e.m=eY(A(e.Ja,e,n),ny(e,e.C)),e.C++,!0)))||2==i&&nd(e)))switch(r&&0<r.length&&((t=e.h).i=t.i.concat(r)),s){case 1:nv(e,5);break;case 4:nv(e,10);break;case 3:nv(e,6);break;default:nv(e,2)}}}function ny(e,t){let n=e.Xa+Math.floor(Math.random()*e.bb);return e.l||(n*=2),n*t}function nv(e,t){if(e.j.info("Error code "+t),2==t){var n=null;e.l&&(n=null);var r=A(e.kb,e);n||(n=new tf("//www.google.com/images/cleardot.gif"),I.location&&"http"==I.location.protocol||tm(n,"https"),tw(n));var i=n.toString();let t=new eq;if(I.Image){let e=new Image;e.onload=C(tK,t,e,"TestLoadImage: loaded",!0,r),e.onerror=C(tK,t,e,"TestLoadImage: error",!1,r),e.onabort=C(tK,t,e,"TestLoadImage: abort",!1,r),e.ontimeout=C(tK,t,e,"TestLoadImage: timeout",!1,r),I.setTimeout(function(){e.ontimeout&&e.ontimeout()},1e4),e.src=i}else r(!1)}else eH(2);e.G=0,e.l&&e.l.va(t),nw(e),na(e)}function nw(e){if(e.G=0,e.la=[],e.l){let t=tj(e.h);(0!=t.length||0!=e.i.length)&&(O(e.la,t),O(e.la,e.i),e.h.i.length=0,x(e.i),e.i.length=0),e.l.ua()}}function nb(e,t,n){var r=n instanceof tf?tp(n):new tf(n,void 0);if(""!=r.g)t&&(r.g=t+"."+r.g),tg(r,r.m);else{var i=I.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var s=new tf(null,void 0);r&&tm(s,r),t&&(s.g=t),i&&tg(s,i),n&&(s.l=n),r=s}return n=e.D,t=e.za,n&&t&&tv(r,n,t),tv(r,"VER",e.ma),nu(e,r),r}function nI(e,t,n){if(t&&!e.H)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new tZ(n&&e.Da&&!e.ra?new tz({jb:!0}):e.ra)).Ka(e.H),t}function n_(){}function nE(){if(j&&!(10<=Number(Z)))throw Error("Environmental error: no available transport.")}function nT(e,t){e_.call(this),this.g=new nr(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.ya&&(e?e["X-WebChannel-Client-Profile"]=t.ya:e={"X-WebChannel-Client-Profile":t.ya}),this.g.S=e,(e=t&&t.Yb)&&!M(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!M(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new nA(this)}function nS(e){e3.call(this);var t=e.__sm__;if(t){e:{for(let n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function nk(){e6.call(this),this.status=1}function nA(e){this.g=e}(d=tZ.prototype).Ka=function(e){this.L=e},d.da=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+e);t=t?t.toUpperCase():"GET",this.H=e,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():u.g(),this.C=this.u?e0(this.u):e0(u),this.g.onreadystatechange=A(this.Ha,this);try{this.F=!0,this.g.open(t,String(e),!0),this.F=!1}catch(e){t3(this,e);return}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else if("function"==typeof r.keys&&"function"==typeof r.get)for(let e of r.keys())n.set(e,r.get(e));else throw Error("Unknown input type for opt_headers: "+String(r));for(let[s,a]of(r=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),i=I.FormData&&e instanceof I.FormData,!(0<=R(t2,t))||r||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),n))this.g.setRequestHeader(s,a);this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{var s,o;t9(this),0<this.B&&((this.K=(s=this.g,j&&(o=function(){let e=0,t=F(String(a)).split("."),n=F("9").split("."),r=Math.max(t.length,n.length);for(let a=0;0==e&&a<r;a++){var i,s,o,l,u,c,h=t[a]||"",d=n[a]||"";do{if(h=/(\d*)(\D*)(.*)/.exec(h)||["","","",""],d=/(\d*)(\D*)(.*)/.exec(d)||["","","",""],0==h[0].length&&0==d[0].length)break;e=(i=0==h[1].length?0:parseInt(h[1],10),s=0==d[1].length?0:parseInt(d[1],10),(i<s?-1:+(i>s))||(o=0==h[2].length,l=0==d[2].length,o<l?-1:+(o>l))||(u=h[2],c=d[2],u<c?-1:+(u>c))),h=h[3],d=d[3]}while(0==e)}return 0<=e},Object.prototype.hasOwnProperty.call(J,9)?J[9]:J[9]=o(9))&&"number"==typeof s.timeout&&void 0!==s.ontimeout))?(this.g.timeout=this.B,this.g.ontimeout=A(this.qa,this)):this.A=eP(this.qa,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){t3(this,e)}},d.qa=function(){void 0!==b&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,eE(this,"timeout"),this.abort(8))},d.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,eE(this,"complete"),eE(this,"abort"),t5(this))},d.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),t5(this,!0)),tZ.X.M.call(this)},d.Ha=function(){this.s||(this.F||this.v||this.l?t4(this):this.fb())},d.fb=function(){t4(this)},d.aa=function(){try{return 2<t8(this)?this.g.status:-1}catch(e){return -1}},d.fa=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},d.Sa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),tJ(t)}},d.Ea=function(){return this.m},d.Oa=function(){return"string"==typeof this.j?this.j:String(this.j)},(d=nr.prototype).ma=8,d.G=1,d.Ja=function(e){if(this.m)if(this.m=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;let i=new e5(this,this.j,e,void 0),s=this.s;if(this.S&&(s?eu(s=eo(s),this.S):s=this.S),null!==this.o||this.N||(i.H=s,s=null),this.O)e:{for(var t=0,n=0;n<this.i.length;n++){t:{var r=this.i[n];if("__data__"in r.g&&"string"==typeof(r=r.g.__data__)){r=r.length;break t}r=void 0}if(void 0===r)break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=nc(this,i,t),tv(n=tp(this.F),"RID",e),tv(n,"CVER",22),this.D&&tv(n,"X-HTTP-Session-Id",this.D),nu(this,n),s&&(this.N?t="headers="+encodeURIComponent(String(ne(s)))+"&"+t:this.o&&nt(n,this.o,s)),tq(this.h,i),this.Ya&&tv(n,"TYPE","init"),this.O?(tv(n,"$req",t),tv(n,"SID","null"),i.Z=!0,tt(i,n,null)):tt(i,n,t),this.G=2}}else 3==this.G&&(e?nl(this,e):0==this.i.length||tF(this.h)||nl(this))},d.Ia=function(){if(this.u=null,np(this),this.$&&!(this.K||null==this.g||0>=this.P)){var e=2*this.P;this.j.info("BP detection timer enabled: "+e),this.B=eY(A(this.eb,this),e)}},d.eb=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.L=!1,this.K=!0,eH(10),ns(this),np(this))},d.cb=function(){null!=this.v&&(this.v=null,ns(this),nd(this),eH(19))},d.kb=function(e){e?(this.j.info("Successfully pinged google.com"),eH(2)):(this.j.info("Failed to ping google.com"),eH(1))},(d=n_.prototype).xa=function(){},d.wa=function(){},d.va=function(){},d.ua=function(){},d.Ra=function(){},nE.prototype.g=function(e,t){return new nT(e,t)},D(nT,e_),nT.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.H=!0);var e=this.g,t=this.l,n=this.h||void 0;eH(0),e.V=t,e.ia=n||{},e.L=e.Y,e.F=nb(e,null,e.V),no(e)},nT.prototype.close=function(){ni(this.g)},nT.prototype.u=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=eS(e),e=n);t.i.push(new tP(t.ab++,e)),3==t.G&&no(t)},nT.prototype.M=function(){this.g.l=null,delete this.j,ni(this.g),delete this.g,nT.X.M.call(this)},D(nS,e3),D(nk,e6),D(nA,n_),nA.prototype.xa=function(){eE(this.g,"a")},nA.prototype.wa=function(e){eE(this.g,new nS(e))},nA.prototype.va=function(e){eE(this.g,new nk)},nA.prototype.ua=function(){eE(this.g,"b")},nE.prototype.createWebChannel=nE.prototype.g,nT.prototype.send=nT.prototype.u,nT.prototype.open=nT.prototype.m,nT.prototype.close=nT.prototype.close,eX.NO_ERROR=0,eX.TIMEOUT=8,eX.HTTP_ERROR=6,eJ.COMPLETE="complete",e1.EventType=e2,e2.OPEN="a",e2.CLOSE="b",e2.ERROR="c",e2.MESSAGE="d",e_.prototype.listen=e_.prototype.N,tZ.prototype.listenOnce=tZ.prototype.O,tZ.prototype.getLastError=tZ.prototype.Oa,tZ.prototype.getLastErrorCode=tZ.prototype.Ea,tZ.prototype.getStatus=tZ.prototype.aa,tZ.prototype.getResponseJson=tZ.prototype.Sa,tZ.prototype.getResponseText=tZ.prototype.fa,tZ.prototype.send=tZ.prototype.da,tZ.prototype.setWithCredentials=tZ.prototype.Ka;var nC=w.createWebChannelTransport=function(){return new nE},nD=w.getStatEventTarget=function(){return eG()},nN=w.ErrorCode=eX,nR=w.EventType=eJ,nx=w.Event=ej,nO=w.Stat={sb:0,vb:1,wb:2,Pb:3,Ub:4,Rb:5,Sb:6,Qb:7,Ob:8,Tb:9,PROXY:10,NOPROXY:11,Mb:12,Ib:13,Jb:14,Hb:15,Kb:16,Lb:17,ob:18,nb:19,pb:20},nP=w.FetchXmlHttpFactory=tz,nL=w.WebChannel=e1,nM=w.XhrIo=tZ;let nF="@firebase/firestore";class nU{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}nU.UNAUTHENTICATED=new nU(null),nU.GOOGLE_CREDENTIALS=new nU("google-credentials-uid"),nU.FIRST_PARTY=new nU("first-party-uid"),nU.MOCK_USER=new nU("mock-user");let nV="9.17.1",nq=new g.Yd("@firebase/firestore");function nB(){return nq.logLevel}function nj(e,...t){if(nq.logLevel<=g.in.DEBUG){let n=t.map(nK);nq.debug(`Firestore (${nV}): ${e}`,...n)}}function n$(e,...t){if(nq.logLevel<=g.in.ERROR){let n=t.map(nK);nq.error(`Firestore (${nV}): ${e}`,...n)}}function nG(e,...t){if(nq.logLevel<=g.in.WARN){let n=t.map(nK);nq.warn(`Firestore (${nV}): ${e}`,...n)}}function nK(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function nz(e="Unexpected state"){let t=`FIRESTORE (${nV}) INTERNAL ASSERTION FAILED: `+e;throw n$(t),Error(t)}let nW={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class nH extends y.ZR{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class nQ{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class nY{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class nX{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(nU.UNAUTHENTICATED))}shutdown(){}}class nJ{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class nZ{constructor(e){this.t=e,this.currentUser=nU.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i,r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve(),i=new nQ;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new nQ,e.enqueueRetryable(()=>r(this.currentUser))};let s=()=>{let t=i;e.enqueueRetryable(async()=>{await t.promise,await r(this.currentUser)})},a=e=>{nj("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),s()};this.t.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){let e=this.t.getImmediate({optional:!0});e?a(e):(nj("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new nQ)}},0),s()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(nj("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?("string"==typeof t.accessToken||nz(),new nY(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){let e=this.auth&&this.auth.getUid();return null===e||"string"==typeof e||nz(),new nU(e)}}class n0{constructor(e,t,n,r){this.h=e,this.l=t,this.m=n,this.g=r,this.type="FirstParty",this.user=nU.FIRST_PARTY,this.p=new Map}I(){return this.g?this.g():("object"==typeof this.h&&null!==this.h&&this.h.auth&&this.h.auth.getAuthHeaderValueForFirstParty||nz(),this.h.auth.getAuthHeaderValueForFirstParty([]))}get headers(){this.p.set("X-Goog-AuthUser",this.l);let e=this.I();return e&&this.p.set("Authorization",e),this.m&&this.p.set("X-Goog-Iam-Authorization-Token",this.m),this.p}}class n1{constructor(e,t,n,r){this.h=e,this.l=t,this.m=n,this.g=r}getToken(){return Promise.resolve(new n0(this.h,this.l,this.m,this.g))}start(e,t){e.enqueueRetryable(()=>t(nU.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class n2{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class n3{constructor(e){this.T=e,this.forceRefresh=!1,this.appCheck=null,this.A=null}start(e,t){let n=e=>{null!=e.error&&nj("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);let n=e.token!==this.A;return this.A=e.token,nj("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>n(t))};let r=e=>{nj("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.T.onInit(e=>r(e)),setTimeout(()=>{if(!this.appCheck){let e=this.T.getImmediate({optional:!0});e?r(e):nj("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?("string"==typeof e.token||nz(),this.A=e.token,new n2(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}class n6{static R(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,n="";for(;n.length<20;){let r=function(e){let t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(40);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let e=0;e<40;e++)n[e]=Math.floor(256*Math.random());return n}(40);for(let i=0;i<r.length;++i)n.length<20&&r[i]<t&&(n+=e.charAt(r[i]%e.length))}return n}}function n4(e,t){return e<t?-1:+(e>t)}function n5(e,t,n){return e.length===t.length&&e.every((e,r)=>n(e,t[r]))}class n9{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new nH(nW.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-0xe7791f700||e>=0x3afff44180)throw new nH(nW.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return n9.fromMillis(Date.now())}static fromDate(e){return n9.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new n9(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?n4(this.nanoseconds,e.nanoseconds):n4(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -0xe7791f700).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class n8{constructor(e){this.timestamp=e}static fromTimestamp(e){return new n8(e)}static min(){return new n8(new n9(0,0))}static max(){return new n8(new n9(0x3afff4417f,0x3b9ac9ff))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class n7{constructor(e,t,n){void 0===t?t=0:t>e.length&&nz(),void 0===n?n=e.length-t:n>e.length-t&&nz(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===n7.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n7?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let n=Math.min(e.length,t.length);for(let r=0;r<n;r++){let n=e.get(r),i=t.get(r);if(n<i)return -1;if(n>i)return 1}return e.length<t.length?-1:+(e.length>t.length)}}class re extends n7{construct(e,t,n){return new re(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){let t=[];for(let n of e){if(n.indexOf("//")>=0)throw new nH(nW.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>e.length>0))}return new re(t)}static emptyPath(){return new re([])}}let rt=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class rn extends n7{construct(e,t,n){return new rn(e,t,n)}static isValidIdentifier(e){return rt.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),rn.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new rn(["__name__"])}static fromServerFormat(e){let t=[],n="",r=0,i=()=>{if(0===n.length)throw new nH(nW.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""},s=!1;for(;r<e.length;){let t=e[r];if("\\"===t){if(r+1===e.length)throw new nH(nW.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new nH(nW.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?s=!s:"."!==t||s?n+=t:i(),r++}if(i(),s)throw new nH(nW.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new rn(t)}static emptyPath(){return new rn([])}}class rr{constructor(e){this.path=e}static fromPath(e){return new rr(re.fromString(e))}static fromName(e){return new rr(re.fromString(e).popFirst(5))}static empty(){return new rr(re.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===re.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return re.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new rr(new re(e.slice()))}}class ri{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function rs(e){return e.fields.find(e=>2===e.kind)}function ra(e){return e.fields.filter(e=>2!==e.kind)}ri.UNKNOWN_ID=-1;class ro{constructor(e,t){this.fieldPath=e,this.kind=t}}class rl{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new rl(0,rh.min())}}function ru(e,t){let n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1;return new rh(n8.fromTimestamp(1e9===r?new n9(n+1,0):new n9(n,r)),rr.empty(),t)}function rc(e){return new rh(e.readTime,e.key,-1)}class rh{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new rh(n8.min(),rr.empty(),-1)}static max(){return new rh(n8.max(),rr.empty(),-1)}}function rd(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n||0!==(n=rr.comparator(e.documentKey,t.documentKey))?n:n4(e.largestBatchId,t.largestBatchId)}let rf="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class rp{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function rm(e){if(e.code!==nW.FAILED_PRECONDITION||e.message!==rf)throw e;nj("LocalStore","Unexpectedly lost primary lease")}class rg{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&nz(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new rg((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof rg?t:rg.resolve(t)}catch(e){return rg.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):rg.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):rg.reject(t)}static resolve(e){return new rg((t,n)=>{t(e)})}static reject(e){return new rg((t,n)=>{n(e)})}static waitFor(e){return new rg((t,n)=>{let r=0,i=0,s=!1;e.forEach(e=>{++r,e.next(()=>{++i,s&&i===r&&t()},e=>n(e))}),s=!0,i===r&&t()})}static or(e){let t=rg.resolve(!1);for(let n of e)t=t.next(e=>e?rg.resolve(e):n());return t}static forEach(e,t){let n=[];return e.forEach((e,r)=>{n.push(t.call(this,e,r))}),this.waitFor(n)}static mapArray(e,t){return new rg((n,r)=>{let i=e.length,s=Array(i),a=0;for(let o=0;o<i;o++){let l=o;t(e[l]).next(e=>{s[l]=e,++a===i&&n(s)},e=>r(e))}})}static doWhile(e,t){return new rg((n,r)=>{let i=()=>{!0===e()?t().next(()=>{i()},r):n()};i()})}}class ry{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.P=new nQ,this.transaction.oncomplete=()=>{this.P.resolve()},this.transaction.onabort=()=>{t.error?this.P.reject(new rb(e,t.error)):this.P.resolve()},this.transaction.onerror=t=>{let n=rS(t.target.error);this.P.reject(new rb(e,n))}}static open(e,t,n,r){try{return new ry(t,e.transaction(r,n))}catch(e){throw new rb(t,e)}}get v(){return this.P.promise}abort(e){e&&this.P.reject(e),this.aborted||(nj("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}V(){let e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){return new r_(this.transaction.objectStore(e))}}class rv{constructor(e,t,n){this.name=e,this.version=t,this.S=n,12.2===rv.D((0,y.z$)())&&n$("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return nj("SimpleDb","Removing database:",e),rE(window.indexedDB.deleteDatabase(e)).toPromise()}static C(){if(!(0,y.hl)())return!1;if(rv.N())return!0;let e=(0,y.z$)(),t=rv.D(e),n=rv.k(e);return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||0<t&&t<10||0<n&&n<4.5)}static N(){return"undefined"!=typeof process&&false}static M(e,t){return e.store(t)}static D(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i);return Number(t?t[1].split("_").slice(0,2).join("."):"-1")}static k(e){let t=e.match(/Android ([\d.]+)/i);return Number(t?t[1].split(".").slice(0,2).join("."):"-1")}async F(e){return this.db||(nj("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,n)=>{let r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{t(e.target.result)},r.onblocked=()=>{n(new rb(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=t=>{let r=t.target.error;"VersionError"===r.name?n(new nH(nW.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new nH(nW.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new rb(e,r))},r.onupgradeneeded=e=>{nj("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);let t=e.target.result;this.S.$(t,r.transaction,e.oldVersion,this.version).next(()=>{nj("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.B&&(this.db.onversionchange=e=>this.B(e)),this.db}L(e){this.B=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,r){let i="readonly"===t,s=0;for(;;){++s;try{this.db=await this.F(e);let t=ry.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).next(e=>(t.V(),e)).catch(e=>(t.abort(e),rg.reject(e))).toPromise();return s.catch(()=>{}),await t.v,s}catch(t){let e="FirebaseError"!==t.name&&s<3;if(nj("SimpleDb","Transaction failed with error:",t.message,"Retrying:",e),this.close(),!e)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}class rw{constructor(e){this.q=e,this.U=!1,this.K=null}get isDone(){return this.U}get G(){return this.K}set cursor(e){this.q=e}done(){this.U=!0}j(e){this.K=e}delete(){return rE(this.q.delete())}}class rb extends nH{constructor(e,t){super(nW.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function rI(e){return"IndexedDbTransactionError"===e.name}class r_{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(nj("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(nj("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),rE(n)}add(e){return nj("SimpleDb","ADD",this.store.name,e,e),rE(this.store.add(e))}get(e){return rE(this.store.get(e)).next(t=>(void 0===t&&(t=null),nj("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return nj("SimpleDb","DELETE",this.store.name,e),rE(this.store.delete(e))}count(){return nj("SimpleDb","COUNT",this.store.name),rE(this.store.count())}W(e,t){let n=this.options(e,t);if(n.index||"function"!=typeof this.store.getAll){let e=this.cursor(n),t=[];return this.H(e,(e,n)=>{t.push(n)}).next(()=>t)}{let e=this.store.getAll(n.range);return new rg((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}}J(e,t){let n=this.store.getAll(e,null===t?void 0:t);return new rg((e,t)=>{n.onerror=e=>{t(e.target.error)},n.onsuccess=t=>{e(t.target.result)}})}Y(e,t){nj("SimpleDb","DELETE ALL",this.store.name);let n=this.options(e,t);n.X=!1;let r=this.cursor(n);return this.H(r,(e,t,n)=>n.delete())}Z(e,t){let n;t?n=e:(n={},t=e);let r=this.cursor(n);return this.H(r,t)}tt(e){let t=this.cursor({});return new rg((n,r)=>{t.onerror=e=>{r(rS(e.target.error))},t.onsuccess=t=>{let r=t.target.result;r?e(r.primaryKey,r.value).next(e=>{e?r.continue():n()}):n()}})}H(e,t){let n=[];return new rg((r,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{let i=e.target.result;if(!i)return void r();let s=new rw(i),a=t(i.primaryKey,i.value,s);if(a instanceof rg){let e=a.catch(e=>(s.done(),rg.reject(e)));n.push(e)}s.isDone?r():null===s.G?i.continue():i.continue(s.G)}}).next(()=>rg.waitFor(n))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let n=this.store.index(e.index);return e.X?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function rE(e){return new rg((t,n)=>{e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{n(rS(e.target.error))}})}let rT=!1;function rS(e){let t=rv.D((0,y.z$)());if(t>=12.2&&t<13){let t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){let e=new nH("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return rT||(rT=!0,setTimeout(()=>{throw e},0)),e}}return e}class rk{constructor(e,t){this.asyncQueue=e,this.et=t,this.task=null}start(){this.nt(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}nt(e){nj("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{nj("IndexBackiller",`Documents written: ${await this.et.st()}`)}catch(e){rI(e)?nj("IndexBackiller","Ignoring IndexedDB error during index backfill: ",e):await rm(e)}await this.nt(6e4)})}}class rA{constructor(e,t){this.localStore=e,this.persistence=t}async st(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.it(t,e))}it(e,t){let n=new Set,r=t,i=!0;return rg.doWhile(()=>!0===i&&r>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>{if(null!==t&&!n.has(t))return nj("IndexBackiller",`Processing collection: ${t}`),this.rt(e,t,r).next(e=>{r-=e,n.add(t)});i=!1})).next(()=>t-r)}rt(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(r=>this.localStore.localDocuments.getNextDocuments(e,t,r,n).next(n=>{let i=n.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next(()=>this.ot(r,n)).next(n=>(nj("IndexBackiller",`Updating offset: ${n}`),this.localStore.indexManager.updateCollectionGroup(e,t,n))).next(()=>i.size)}))}ot(e,t){let n=e;return t.changes.forEach((e,t)=>{let r=rc(t);rd(r,n)>0&&(n=r)}),new rh(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}class rC{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ut(e),this.ct=e=>t.writeSequenceNumber(e))}ut(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.ct&&this.ct(e),e}}rC.at=-1;class rD{constructor(e,t,n,r,i,s,a,o){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.useFetchStreams=o}}class rN{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new rN("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof rN&&e.projectId===this.projectId&&e.database===this.database}}function rR(e){let t=0;for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function rx(e,t){for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function rO(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function rP(e){return null==e}function rL(e){return 0===e&&1/e==-1/0}function rM(e){return"number"==typeof e&&Number.isInteger(e)&&!rL(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}class rF{constructor(e){this.binaryString=e}static fromBase64String(e){return new rF(atob(e))}static fromUint8Array(e){return new rF(function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){var e=this.binaryString;let t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return n4(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}rF.EMPTY_BYTE_STRING=new rF("");let rU=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function rV(e){if(e||nz(),"string"==typeof e){let t=0,n=rU.exec(e);if(n||nz(),n[1]){let e=n[1];t=Number(e=(e+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(e).getTime()/1e3),nanos:t}}return{seconds:rq(e.seconds),nanos:rq(e.nanos)}}function rq(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function rB(e){return"string"==typeof e?rF.fromBase64String(e):rF.fromUint8Array(e)}function rj(e){var t,n;return"server_timestamp"===(null==(n=((null==(t=null==e?void 0:e.mapValue)?void 0:t.fields)||{}).__type__)?void 0:n.stringValue)}function r$(e){let t=rV(e.mapValue.fields.__local_write_time__.timestampValue);return new n9(t.seconds,t.nanos)}let rG={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},rK={nullValue:"NULL_VALUE"};function rz(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?rj(e)?4:r4(e)?0x1fffffffffffff:10:nz()}function rW(e,t){if(e===t)return!0;let n=rz(e);if(n!==rz(t))return!1;switch(n){case 0:case 0x1fffffffffffff:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return r$(e).isEqual(r$(t));case 3:if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let r=rV(e.timestampValue),i=rV(t.timestampValue);return r.seconds===i.seconds&&r.nanos===i.nanos;case 5:return e.stringValue===t.stringValue;case 6:return rB(e.bytesValue).isEqual(rB(t.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return rq(e.geoPointValue.latitude)===rq(t.geoPointValue.latitude)&&rq(e.geoPointValue.longitude)===rq(t.geoPointValue.longitude);case 2:if("integerValue"in e&&"integerValue"in t)return rq(e.integerValue)===rq(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){let n=rq(e.doubleValue),r=rq(t.doubleValue);return n===r?rL(n)===rL(r):isNaN(n)&&isNaN(r)}return!1;case 9:return n5(e.arrayValue.values||[],t.arrayValue.values||[],rW);case 10:let s=e.mapValue.fields||{},a=t.mapValue.fields||{};if(rR(s)!==rR(a))return!1;for(let e in s)if(s.hasOwnProperty(e)&&(void 0===a[e]||!rW(s[e],a[e])))return!1;return!0;default:return nz()}}function rH(e,t){return void 0!==(e.values||[]).find(e=>rW(e,t))}function rQ(e,t){if(e===t)return 0;let n=rz(e),r=rz(t);if(n!==r)return n4(n,r);switch(n){case 0:case 0x1fffffffffffff:return 0;case 1:return n4(e.booleanValue,t.booleanValue);case 2:let i=rq(e.integerValue||e.doubleValue),s=rq(t.integerValue||t.doubleValue);return i<s?-1:i>s?1:i===s?0:isNaN(i)?isNaN(s)?0:-1:1;case 3:return rY(e.timestampValue,t.timestampValue);case 4:return rY(r$(e),r$(t));case 5:return n4(e.stringValue,t.stringValue);case 6:return function(e,t){let n=rB(e),r=rB(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){let n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){let t=n4(n[e],r[e]);if(0!==t)return t}return n4(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){let n=n4(rq(e.latitude),rq(t.latitude));return 0!==n?n:n4(rq(e.longitude),rq(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){let n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){let t=rQ(n[e],r[e]);if(t)return t}return n4(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===rG.mapValue&&t===rG.mapValue)return 0;if(e===rG.mapValue)return 1;if(t===rG.mapValue)return -1;let n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let e=0;e<r.length&&e<s.length;++e){let t=n4(r[e],s[e]);if(0!==t)return t;let a=rQ(n[r[e]],i[s[e]]);if(0!==a)return a}return n4(r.length,s.length)}(e.mapValue,t.mapValue);default:throw nz()}}function rY(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return n4(e,t);let n=rV(e),r=rV(t),i=n4(n.seconds,r.seconds);return 0!==i?i:n4(n.nanos,r.nanos)}function rX(e){var t,n;return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){let t=rV(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?rB(e.bytesValue).toBase64():"referenceValue"in e?(n=e.referenceValue,rr.fromName(n).toString()):"geoPointValue"in e?`geo(${(t=e.geoPointValue).latitude},${t.longitude})`:"arrayValue"in e?function(e){let t="[",n=!0;for(let r of e.values||[])n?n=!1:t+=",",t+=rX(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){let t=Object.keys(e.fields||{}).sort(),n="{",r=!0;for(let i of t)r?r=!1:n+=",",n+=`${i}:${rX(e.fields[i])}`;return n+"}"}(e.mapValue):nz()}function rJ(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function rZ(e){return!!e&&"integerValue"in e}function r0(e){return!!e&&"arrayValue"in e}function r1(e){return!!e&&"nullValue"in e}function r2(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function r3(e){return!!e&&"mapValue"in e}function r6(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){let t={mapValue:{fields:{}}};return rx(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=r6(n)),t}if(e.arrayValue){let t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=r6(e.arrayValue.values[n]);return t}return Object.assign({},e)}function r4(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}function r5(e,t){let n=rQ(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function r9(e,t){let n=rQ(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class r8{constructor(e,t){this.position=e,this.inclusive=t}}function r7(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){let s=t[i],a=e.position[i];if(r=s.field.isKeyField()?rr.comparator(rr.fromName(a.referenceValue),n.key):rQ(a,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function ie(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!rW(e.position[n],t.position[n]))return!1;return!0}class it{}class ir extends it{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new ic(e,t,n):"array-contains"===t?new im(e,n):"in"===t?new ig(e,n):"not-in"===t?new iy(e,n):"array-contains-any"===t?new iv(e,n):new ir(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new ih(e,n):new id(e,n)}matches(e){let t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(rQ(t,this.value)):null!==t&&rz(this.value)===rz(t)&&this.matchesComparison(rQ(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return nz()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class ii extends it{constructor(e,t){super(),this.filters=e,this.op=t,this.ht=null}static create(e,t){return new ii(e,t)}matches(e){return is(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ht||(this.ht=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ht}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){let e=this.lt(e=>e.isInequality());return null!==e?e.field:null}lt(e){for(let t of this.getFlattenedFilters())if(e(t))return t;return null}}function is(e){return"and"===e.op}function ia(e){return"or"===e.op}function io(e){return il(e)&&is(e)}function il(e){for(let t of e.filters)if(t instanceof ii)return!1;return!0}function iu(e,t){let n=e.filters.concat(t);return ii.create(n,e.op)}class ic extends ir{constructor(e,t,n){super(e,t,n),this.key=rr.fromName(n.referenceValue)}matches(e){let t=rr.comparator(e.key,this.key);return this.matchesComparison(t)}}class ih extends ir{constructor(e,t){super(e,"in",t),this.keys=ip("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class id extends ir{constructor(e,t){super(e,"not-in",t),this.keys=ip("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function ip(e,t){var n;return((null==(n=t.arrayValue)?void 0:n.values)||[]).map(e=>rr.fromName(e.referenceValue))}class im extends ir{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return r0(t)&&rH(t.arrayValue,this.value)}}class ig extends ir{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return null!==t&&rH(this.value.arrayValue,t)}}class iy extends ir{constructor(e,t){super(e,"not-in",t)}matches(e){if(rH(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return null!==t&&!rH(this.value.arrayValue,t)}}class iv extends ir{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!r0(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>rH(this.value.arrayValue,e))}}class iw{constructor(e,t="asc"){this.field=e,this.dir=t}}class ib{constructor(e,t){this.comparator=e,this.root=t||i_.EMPTY}insert(e,t){return new ib(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,i_.BLACK,null,null))}remove(e){return new ib(this.comparator,this.root.remove(e,this.comparator).copy(null,null,i_.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){let r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){let e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new iI(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new iI(this.root,e,this.comparator,!1)}getReverseIterator(){return new iI(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new iI(this.root,e,this.comparator,!0)}}class iI{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class i_{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:i_.RED,this.left=null!=r?r:i_.EMPTY,this.right=null!=i?i:i_.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new i_(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp()}removeMin(){if(this.left.isEmpty())return i_.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let n,r=this;if(0>t(e,r.key))r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return i_.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){let e=this.copy(null,null,i_.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,i_.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw nz();let e=this.left.check();if(e!==this.right.check())throw nz();return e+ +!this.isRed()}}i_.EMPTY=null,i_.RED=!0,i_.BLACK=!1,i_.EMPTY=new class{constructor(){this.size=0}get key(){throw nz()}get value(){throw nz()}get color(){throw nz()}get left(){throw nz()}get right(){throw nz()}copy(e,t,n,r,i){return this}insert(e,t,n){return new i_(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class iE{constructor(e){this.comparator=e,this.data=new ib(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){let n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){let r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new iT(this.data.getIterator())}getIteratorFrom(e){return new iT(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof iE)||this.size!==e.size)return!1;let t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){let e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new iE(this.comparator);return t.data=e,t}}class iT{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function iS(e){return e.hasNext()?e.getNext():void 0}class ik{constructor(e){this.fields=e,e.sort(rn.comparator)}static empty(){return new ik([])}unionWith(e){let t=new iE(rn.comparator);for(let e of this.fields)t=t.add(e);for(let n of e)t=t.add(n);return new ik(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return n5(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class iA{constructor(e){this.value=e}static empty(){return new iA({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(!r3(t=(t.mapValue.fields||{})[e.get(n)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=r6(t)}setAll(e){let t=rn.emptyPath(),n={},r=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){let e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=r6(e):r.push(i.lastSegment())});let i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){let t=this.field(e.popLast());r3(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return rW(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];r3(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){for(let r of(rx(t,(t,n)=>e[t]=n),n))delete e[r]}clone(){return new iA(r6(this.value))}}class iC{constructor(e,t,n,r,i,s,a){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=a}static newInvalidDocument(e){return new iC(e,0,n8.min(),n8.min(),n8.min(),iA.empty(),0)}static newFoundDocument(e,t,n,r){return new iC(e,1,t,n8.min(),n,r,0)}static newNoDocument(e,t){return new iC(e,2,t,n8.min(),n8.min(),iA.empty(),0)}static newUnknownDocument(e,t){return new iC(e,3,t,n8.min(),n8.min(),iA.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(n8.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=iA.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=iA.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=n8.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof iC&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new iC(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class iD{constructor(e,t=null,n=[],r=[],i=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=a,this.ft=null}}function iN(e,t=null,n=[],r=[],i=null,s=null,a=null){return new iD(e,t,n,r,i,s,a)}function iR(e){if(null===e.ft){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(e=>(function e(t){if(t instanceof ir)return t.field.canonicalString()+t.op.toString()+rX(t.value);if(io(t))return t.filters.map(t=>e(t)).join(",");{let n=t.filters.map(t=>e(t)).join(",");return`${t.op}(${n})`}})(e)).join(","),t+="|ob:",t+=e.orderBy.map(e=>e.field.canonicalString()+e.dir).join(","),rP(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>rX(e)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>rX(e)).join(",")),e.ft=t}return e.ft}function ix(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let i=0;i<e.orderBy.length;i++){var n,r;if(n=e.orderBy[i],r=t.orderBy[i],!(n.dir===r.dir&&n.field.isEqual(r.field)))return!1}if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!function e(t,n){return t instanceof ir?n instanceof ir&&t.op===n.op&&t.field.isEqual(n.field)&&rW(t.value,n.value):t instanceof ii?n instanceof ii&&t.op===n.op&&t.filters.length===n.filters.length&&t.filters.reduce((t,r,i)=>t&&e(r,n.filters[i]),!0):void nz()}(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!ie(e.startAt,t.startAt)&&ie(e.endAt,t.endAt)}function iO(e){return rr.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function iP(e,t){return e.filters.filter(e=>e instanceof ir&&e.field.isEqual(t))}function iL(e,t,n){let r=rK,i=!0;for(let n of iP(e,t)){let e=rK,t=!0;switch(n.op){case"<":case"<=":var s;e="nullValue"in(s=n.value)?rK:"booleanValue"in s?{booleanValue:!1}:"integerValue"in s||"doubleValue"in s?{doubleValue:NaN}:"timestampValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in s?{stringValue:""}:"bytesValue"in s?{bytesValue:""}:"referenceValue"in s?rJ(rN.empty(),rr.empty()):"geoPointValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in s?{arrayValue:{}}:"mapValue"in s?{mapValue:{}}:nz();break;case"==":case"in":case">=":e=n.value;break;case">":e=n.value,t=!1;break;case"!=":case"not-in":e=rK}0>r5({value:r,inclusive:i},{value:e,inclusive:t})&&(r=e,i=t)}if(null!==n){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=n.position[s];0>r5({value:r,inclusive:i},{value:e,inclusive:n.inclusive})&&(r=e,i=n.inclusive);break}}return{value:r,inclusive:i}}function iM(e,t,n){let r=rG,i=!0;for(let n of iP(e,t)){let e=rG,t=!0;switch(n.op){case">=":case">":var s;e="nullValue"in(s=n.value)?{booleanValue:!1}:"booleanValue"in s?{doubleValue:NaN}:"integerValue"in s||"doubleValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in s?{stringValue:""}:"stringValue"in s?{bytesValue:""}:"bytesValue"in s?rJ(rN.empty(),rr.empty()):"referenceValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in s?{arrayValue:{}}:"arrayValue"in s?{mapValue:{}}:"mapValue"in s?rG:nz(),t=!1;break;case"==":case"in":case"<=":e=n.value;break;case"<":e=n.value,t=!1;break;case"!=":case"not-in":e=rG}r9({value:r,inclusive:i},{value:e,inclusive:t})>0&&(r=e,i=t)}if(null!==n){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=n.position[s];r9({value:r,inclusive:i},{value:e,inclusive:n.inclusive})>0&&(r=e,i=n.inclusive);break}}return{value:r,inclusive:i}}class iF{constructor(e,t=null,n=[],r=[],i=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=a,this.endAt=o,this.dt=null,this._t=null,this.startAt,this.endAt}}function iU(e){return new iF(e)}function iV(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function iq(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function iB(e){for(let t of e.filters){let e=t.getFirstInequalityField();if(null!==e)return e}return null}function ij(e){return null!==e.collectionGroup}function i$(e){if(null===e.dt){e.dt=[];let t=iB(e),n=iq(e);if(null!==t&&null===n)t.isKeyField()||e.dt.push(new iw(t)),e.dt.push(new iw(rn.keyField(),"asc"));else{let t=!1;for(let n of e.explicitOrderBy)e.dt.push(n),n.field.isKeyField()&&(t=!0);if(!t){let t=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.dt.push(new iw(rn.keyField(),t))}}}return e.dt}function iG(e){if(!e._t)if("F"===e.limitType)e._t=iN(e.path,e.collectionGroup,i$(e),e.filters,e.limit,e.startAt,e.endAt);else{let t=[];for(let n of i$(e)){let e="desc"===n.dir?"asc":"desc";t.push(new iw(n.field,e))}let n=e.endAt?new r8(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new r8(e.startAt.position,e.startAt.inclusive):null;e._t=iN(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}return e._t}function iK(e,t){t.getFirstInequalityField(),iB(e);let n=e.filters.concat([t]);return new iF(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function iz(e,t,n){return new iF(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function iW(e,t){return ix(iG(e),iG(t))&&e.limitType===t.limitType}function iH(e){return`${iR(iG(e))}|lt:${e.limitType}`}function iQ(e){var t;let n;return`Query(target=${n=(t=iG(e)).path.canonicalString(),null!==t.collectionGroup&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(e=>(function e(t){return t instanceof ir?`${t.field.canonicalString()} ${t.op} ${rX(t.value)}`:t instanceof ii?t.op.toString()+" {"+t.getFilters().map(e).join(" ,")+"}":"Filter"})(e)).join(", ")}]`),rP(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(e=>`${e.field.canonicalString()} (${e.dir})`).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(e=>rX(e)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(e=>rX(e)).join(",")),`Target(${n})`}; limitType=${e.limitType})`}function iY(e,t){return t.isFoundDocument()&&function(e,t){let n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):rr.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(let n of i$(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(let n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&(!e.startAt||!!function(e,t,n){let r=r7(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,i$(e),t))&&(!e.endAt||!!function(e,t,n){let r=r7(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,i$(e),t))}function iX(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function iJ(e){return(t,n)=>{let r=!1;for(let i of i$(e)){let e=function(e,t,n){let r=e.field.isKeyField()?rr.comparator(t.key,n.key):function(e,t,n){let r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?rQ(r,i):nz()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return -1*r;default:return nz()}}(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}function iZ(e,t){if(e.wt){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:rL(t)?"-0":t}}function i0(e){return{integerValue:""+e}}function i1(e,t){return rM(t)?i0(t):iZ(e,t)}class i2{constructor(){this._=void 0}}function i3(e,t){return e instanceof i7?rZ(t)||t&&"doubleValue"in t?t:{integerValue:0}:null}class i6 extends i2{}class i4 extends i2{constructor(e){super(),this.elements=e}}function i5(e,t){let n=st(t);for(let t of e.elements)n.some(e=>rW(e,t))||n.push(t);return{arrayValue:{values:n}}}class i9 extends i2{constructor(e){super(),this.elements=e}}function i8(e,t){let n=st(t);for(let t of e.elements)n=n.filter(e=>!rW(e,t));return{arrayValue:{values:n}}}class i7 extends i2{constructor(e,t){super(),this.yt=e,this.gt=t}}function se(e){return rq(e.integerValue||e.doubleValue)}function st(e){return r0(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class sn{constructor(e,t){this.field=e,this.transform=t}}class sr{constructor(e,t){this.version=e,this.transformResults=t}}class si{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new si}static exists(e){return new si(void 0,e)}static updateTime(e){return new si(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function ss(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class sa{}function so(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new sm(e.key,si.none()):new sc(e.key,e.data,si.none());{let n=e.data,r=iA.empty(),i=new iE(rn.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new sh(e.key,r,new ik(i.toArray()),si.none())}}function sl(e,t,n,r){return e instanceof sc?function(e,t,n,r){if(!ss(e.precondition,t))return n;let i=e.value.clone(),s=sp(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof sh?function(e,t,n,r){if(!ss(e.precondition,t))return n;let i=sp(e.fieldTransforms,r,t),s=t.data;return(s.setAll(sd(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n)?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,r):ss(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}function su(e,t){var n,r;return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,r=t.fieldTransforms,!!(void 0===n&&void 0===r||!(!n||!r)&&n5(n,r,(e,t)=>{var n,r;return e.field.isEqual(t.field)&&(n=e.transform,r=t.transform,n instanceof i4&&r instanceof i4||n instanceof i9&&r instanceof i9?n5(n.elements,r.elements,rW):n instanceof i7&&r instanceof i7?rW(n.gt,r.gt):n instanceof i6&&r instanceof i6)})))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class sc extends sa{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class sh extends sa{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function sd(e){let t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){let r=e.data.field(n);t.set(n,r)}}),t}function sf(e,t,n){var r;let i=new Map;e.length===n.length||nz();for(let s=0;s<n.length;s++){let a=e[s],o=a.transform,l=t.data.field(a.field);i.set(a.field,(r=n[s],o instanceof i4?i5(o,l):o instanceof i9?i8(o,l):r))}return i}function sp(e,t,n){let r=new Map;for(let i of e){let e=i.transform,s=n.data.field(i.field);r.set(i.field,e instanceof i6?function(e,t){let n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&(n.fields.__previous_value__=t),{mapValue:n}}(t,s):e instanceof i4?i5(e,s):e instanceof i9?i8(e,s):function(e,t){let n=i3(e,t),r=se(n)+se(e.gt);return rZ(n)&&rZ(e.gt)?i0(r):iZ(e.yt,r)}(e,s))}return r}class sm extends sa{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class sg extends sa{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class sy{constructor(e){this.count=e}}function sv(e){switch(e){default:return nz();case nW.CANCELLED:case nW.UNKNOWN:case nW.DEADLINE_EXCEEDED:case nW.RESOURCE_EXHAUSTED:case nW.INTERNAL:case nW.UNAVAILABLE:case nW.UNAUTHENTICATED:return!1;case nW.INVALID_ARGUMENT:case nW.NOT_FOUND:case nW.ALREADY_EXISTS:case nW.PERMISSION_DENIED:case nW.FAILED_PRECONDITION:case nW.ABORTED:case nW.OUT_OF_RANGE:case nW.UNIMPLEMENTED:case nW.DATA_LOSS:return!0}}function sw(e){if(void 0===e)return n$("GRPC error has no .code"),nW.UNKNOWN;switch(e){case c.OK:return nW.OK;case c.CANCELLED:return nW.CANCELLED;case c.UNKNOWN:return nW.UNKNOWN;case c.DEADLINE_EXCEEDED:return nW.DEADLINE_EXCEEDED;case c.RESOURCE_EXHAUSTED:return nW.RESOURCE_EXHAUSTED;case c.INTERNAL:return nW.INTERNAL;case c.UNAVAILABLE:return nW.UNAVAILABLE;case c.UNAUTHENTICATED:return nW.UNAUTHENTICATED;case c.INVALID_ARGUMENT:return nW.INVALID_ARGUMENT;case c.NOT_FOUND:return nW.NOT_FOUND;case c.ALREADY_EXISTS:return nW.ALREADY_EXISTS;case c.PERMISSION_DENIED:return nW.PERMISSION_DENIED;case c.FAILED_PRECONDITION:return nW.FAILED_PRECONDITION;case c.ABORTED:return nW.ABORTED;case c.OUT_OF_RANGE:return nW.OUT_OF_RANGE;case c.UNIMPLEMENTED:return nW.UNIMPLEMENTED;case c.DATA_LOSS:return nW.DATA_LOSS;default:return nz()}}(h=c||(c={}))[h.OK=0]="OK",h[h.CANCELLED=1]="CANCELLED",h[h.UNKNOWN=2]="UNKNOWN",h[h.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",h[h.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",h[h.NOT_FOUND=5]="NOT_FOUND",h[h.ALREADY_EXISTS=6]="ALREADY_EXISTS",h[h.PERMISSION_DENIED=7]="PERMISSION_DENIED",h[h.UNAUTHENTICATED=16]="UNAUTHENTICATED",h[h.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",h[h.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",h[h.ABORTED=10]="ABORTED",h[h.OUT_OF_RANGE=11]="OUT_OF_RANGE",h[h.UNIMPLEMENTED=12]="UNIMPLEMENTED",h[h.INTERNAL=13]="INTERNAL",h[h.UNAVAILABLE=14]="UNAVAILABLE",h[h.DATA_LOSS=15]="DATA_LOSS";class sb{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n){for(let[t,r]of n)if(this.equalsFn(t,e))return r}}has(e){return void 0!==this.get(e)}set(e,t){let n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){rx(this.inner,(t,n)=>{for(let[t,r]of n)e(t,r)})}isEmpty(){return rO(this.inner)}size(){return this.innerSize}}let sI=new ib(rr.comparator),s_=new ib(rr.comparator);function sE(...e){let t=s_;for(let n of e)t=t.insert(n.key,n);return t}function sT(e){let t=s_;return e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function sS(){return new sb(e=>e.toString(),(e,t)=>e.isEqual(t))}let sk=new ib(rr.comparator),sA=new iE(rr.comparator);function sC(...e){let t=sA;for(let n of e)t=t.add(n);return t}let sD=new iE(n4);class sN{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){let r=new Map;return r.set(e,sR.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new sN(n8.min(),r,sD,sI,sC())}}class sR{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new sR(n,t,sC(),sC(),sC())}}class sx{constructor(e,t,n,r){this.It=e,this.removedTargetIds=t,this.key=n,this.Tt=r}}class sO{constructor(e,t){this.targetId=e,this.Et=t}}class sP{constructor(e,t,n=rF.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class sL{constructor(){this.At=0,this.Rt=sU(),this.bt=rF.EMPTY_BYTE_STRING,this.Pt=!1,this.vt=!0}get current(){return this.Pt}get resumeToken(){return this.bt}get Vt(){return 0!==this.At}get St(){return this.vt}Dt(e){e.approximateByteSize()>0&&(this.vt=!0,this.bt=e)}Ct(){let e=sC(),t=sC(),n=sC();return this.Rt.forEach((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:nz()}}),new sR(this.bt,this.Pt,e,t,n)}xt(){this.vt=!1,this.Rt=sU()}Nt(e,t){this.vt=!0,this.Rt=this.Rt.insert(e,t)}kt(e){this.vt=!0,this.Rt=this.Rt.remove(e)}Ot(){this.At+=1}Mt(){this.At-=1}Ft(){this.vt=!0,this.Pt=!0}}class sM{constructor(e){this.$t=e,this.Bt=new Map,this.Lt=sI,this.qt=sF(),this.Ut=new iE(n4)}Kt(e){for(let t of e.It)e.Tt&&e.Tt.isFoundDocument()?this.Gt(t,e.Tt):this.Qt(t,e.key,e.Tt);for(let t of e.removedTargetIds)this.Qt(t,e.key,e.Tt)}jt(e){this.forEachTarget(e,t=>{let n=this.Wt(t);switch(e.state){case 0:this.zt(t)&&n.Dt(e.resumeToken);break;case 1:n.Mt(),n.Vt||n.xt(),n.Dt(e.resumeToken);break;case 2:n.Mt(),n.Vt||this.removeTarget(t);break;case 3:this.zt(t)&&(n.Ft(),n.Dt(e.resumeToken));break;case 4:this.zt(t)&&(this.Ht(t),n.Dt(e.resumeToken));break;default:nz()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Bt.forEach((e,n)=>{this.zt(n)&&t(n)})}Jt(e){let t=e.targetId,n=e.Et.count,r=this.Yt(t);if(r){let e=r.target;if(iO(e))if(0===n){let n=new rr(e.path);this.Qt(t,n,iC.newNoDocument(n,n8.min()))}else 1===n||nz();else this.Xt(t)!==n&&(this.Ht(t),this.Ut=this.Ut.add(t))}}Zt(e){let t=new Map;this.Bt.forEach((n,r)=>{let i=this.Yt(r);if(i){if(n.current&&iO(i.target)){let t=new rr(i.target.path);null!==this.Lt.get(t)||this.te(r,t)||this.Qt(r,t,iC.newNoDocument(t,e))}n.St&&(t.set(r,n.Ct()),n.xt())}});let n=sC();this.qt.forEach((e,t)=>{let r=!0;t.forEachWhile(e=>{let t=this.Yt(e);return!t||2===t.purpose||(r=!1,!1)}),r&&(n=n.add(e))}),this.Lt.forEach((t,n)=>n.setReadTime(e));let r=new sN(e,t,this.Ut,this.Lt,n);return this.Lt=sI,this.qt=sF(),this.Ut=new iE(n4),r}Gt(e,t){if(!this.zt(e))return;let n=2*!!this.te(e,t.key);this.Wt(e).Nt(t.key,n),this.Lt=this.Lt.insert(t.key,t),this.qt=this.qt.insert(t.key,this.ee(t.key).add(e))}Qt(e,t,n){if(!this.zt(e))return;let r=this.Wt(e);this.te(e,t)?r.Nt(t,1):r.kt(t),this.qt=this.qt.insert(t,this.ee(t).delete(e)),n&&(this.Lt=this.Lt.insert(t,n))}removeTarget(e){this.Bt.delete(e)}Xt(e){let t=this.Wt(e).Ct();return this.$t.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ot(e){this.Wt(e).Ot()}Wt(e){let t=this.Bt.get(e);return t||(t=new sL,this.Bt.set(e,t)),t}ee(e){let t=this.qt.get(e);return t||(t=new iE(n4),this.qt=this.qt.insert(e,t)),t}zt(e){let t=null!==this.Yt(e);return t||nj("WatchChangeAggregator","Detected inactive target",e),t}Yt(e){let t=this.Bt.get(e);return t&&t.Vt?null:this.$t.ne(e)}Ht(e){this.Bt.set(e,new sL),this.$t.getRemoteKeysForTarget(e).forEach(t=>{this.Qt(e,t,null)})}te(e,t){return this.$t.getRemoteKeysForTarget(e).has(t)}}function sF(){return new ib(rr.comparator)}function sU(){return new ib(rr.comparator)}let sV={asc:"ASCENDING",desc:"DESCENDING"},sq={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},sB={and:"AND",or:"OR"};class sj{constructor(e,t){this.databaseId=e,this.wt=t}}function s$(e,t){return e.wt?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function sG(e,t){return e.wt?t.toBase64():t.toUint8Array()}function sK(e){return e||nz(),n8.fromTimestamp(function(e){let t=rV(e);return new n9(t.seconds,t.nanos)}(e))}function sz(e,t){return new re(["projects",e.projectId,"databases",e.database]).child("documents").child(t).canonicalString()}function sW(e){let t=re.fromString(e);return s7(t)||nz(),t}function sH(e,t){return sz(e.databaseId,t.path)}function sQ(e,t){let n=sW(t);if(n.get(1)!==e.databaseId.projectId)throw new nH(nW.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new nH(nW.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new rr(sZ(n))}function sY(e,t){return sz(e.databaseId,t)}function sX(e){let t=sW(e);return 4===t.length?re.emptyPath():sZ(t)}function sJ(e){return new re(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function sZ(e){return e.length>4&&"documents"===e.get(4)||nz(),e.popFirst(5)}function s0(e,t,n){return{name:sH(e,t),fields:n.value.mapValue.fields}}function s1(e,t,n){let r=sQ(e,t.name),i=sK(t.updateTime),s=t.createTime?sK(t.createTime):n8.min(),a=new iA({mapValue:{fields:t.fields}}),o=iC.newFoundDocument(r,i,s,a);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function s2(e,t){var n;let r;if(t instanceof sc)r={update:s0(e,t.key,t.value)};else if(t instanceof sm)r={delete:sH(e,t.key)};else if(t instanceof sh)r={update:s0(e,t.key,t.data),updateMask:function(e){let t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}(t.fieldMask)};else{if(!(t instanceof sg))return nz();r={verify:sH(e,t.key)}}return t.fieldTransforms.length>0&&(r.updateTransforms=t.fieldTransforms.map(e=>(function(e,t){let n=t.transform;if(n instanceof i6)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof i4)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof i9)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof i7)return{fieldPath:t.field.canonicalString(),increment:n.gt};throw nz()})(0,e))),t.precondition.isNone||(r.currentDocument=void 0!==(n=t.precondition).updateTime?{updateTime:s$(e,n.updateTime.toTimestamp())}:void 0!==n.exists?{exists:n.exists}:nz()),r}function s3(e,t){var n;let r=t.currentDocument?void 0!==(n=t.currentDocument).updateTime?si.updateTime(sK(n.updateTime)):void 0!==n.exists?si.exists(n.exists):si.none():si.none(),i=t.updateTransforms?t.updateTransforms.map(t=>{var n,r;let i;return n=e,i=null,"setToServerValue"in(r=t)?("REQUEST_TIME"===r.setToServerValue||nz(),i=new i6):"appendMissingElements"in r?i=new i4(r.appendMissingElements.values||[]):"removeAllFromArray"in r?i=new i9(r.removeAllFromArray.values||[]):"increment"in r?i=new i7(n,r.increment):nz(),new sn(rn.fromServerFormat(r.fieldPath),i)}):[];if(t.update){t.update.name;let n=sQ(e,t.update.name),s=new iA({mapValue:{fields:t.update.fields}});return t.updateMask?new sh(n,s,new ik((t.updateMask.fieldPaths||[]).map(e=>rn.fromServerFormat(e))),r,i):new sc(n,s,r,i)}return t.delete?new sm(sQ(e,t.delete),r):t.verify?new sg(sQ(e,t.verify),r):nz()}function s6(e,t){return{documents:[sY(e,t.path)]}}function s4(e,t){var n,r,i;let s={structuredQuery:{}},a=t.path;null!==t.collectionGroup?(s.parent=sY(e,a),s.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(s.parent=sY(e,a.popLast()),s.structuredQuery.from=[{collectionId:a.lastSegment()}]);let o=function(e){if(0!==e.length)return function e(t){return t instanceof ir?function(e){if("=="===e.op){if(r2(e.value))return{unaryFilter:{field:s9(e.field),op:"IS_NAN"}};if(r1(e.value))return{unaryFilter:{field:s9(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(r2(e.value))return{unaryFilter:{field:s9(e.field),op:"IS_NOT_NAN"}};if(r1(e.value))return{unaryFilter:{field:s9(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:s9(e.field),op:sq[e.op],value:e.value}}}(t):t instanceof ii?function(t){let n=t.getFilters().map(t=>e(t));return 1===n.length?n[0]:{compositeFilter:{op:sB[t.op],filters:n}}}(t):nz()}(ii.create(e,"and"))}(t.filters);o&&(s.structuredQuery.where=o);let l=function(e){if(0!==e.length)return e.map(e=>({field:s9(e.field),direction:sV[e.dir]}))}(t.orderBy);l&&(s.structuredQuery.orderBy=l);let u=(r=t.limit,e.wt||rP(r)?r:{value:r});return null!==u&&(s.structuredQuery.limit=u),t.startAt&&(s.structuredQuery.startAt={before:(n=t.startAt).inclusive,values:n.position}),t.endAt&&(s.structuredQuery.endAt={before:!(i=t.endAt).inclusive,values:i.position}),s}function s5(e){var t;let n,r=sX(e.parent),i=e.structuredQuery,s=i.from?i.from.length:0,a=null;if(s>0){1===s||nz();let e=i.from[0];e.allDescendants?a=e.collectionId:r=r.child(e.collectionId)}let o=[];i.where&&(o=function(e){let t=function e(t){return void 0!==t.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":let t=s8(e.unaryFilter.field);return ir.create(t,"==",{doubleValue:NaN});case"IS_NULL":let n=s8(e.unaryFilter.field);return ir.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let r=s8(e.unaryFilter.field);return ir.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=s8(e.unaryFilter.field);return ir.create(i,"!=",{nullValue:"NULL_VALUE"});default:return nz()}}(t):void 0!==t.fieldFilter?ir.create(s8(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return nz()}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==t.compositeFilter?ii.create(t.compositeFilter.filters.map(t=>e(t)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return nz()}}(t.compositeFilter.op)):nz()}(e);return t instanceof ii&&io(t)?t.getFilters():[t]}(i.where));let l=[];i.orderBy&&(l=i.orderBy.map(e=>new iw(s8(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))));let u=null;i.limit&&(u=rP(n="object"==typeof(t=i.limit)?t.value:t)?null:n);let c=null;i.startAt&&(c=function(e){let t=!!e.before;return new r8(e.values||[],t)}(i.startAt));let h=null;return i.endAt&&(h=function(e){let t=!e.before;return new r8(e.values||[],t)}(i.endAt)),new iF(r,a,l,o,u,"F",c,h)}function s9(e){return{fieldPath:e.canonicalString()}}function s8(e){return rn.fromServerFormat(e.fieldPath)}function s7(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}function ae(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t+="\x01\x01"),t=function(e,t){let n=t,r=e.length;for(let t=0;t<r;t++){let r=e.charAt(t);switch(r){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=r}}return n}(e.get(n),t);return t+"\x01\x01"}function at(e){let t=e.length;if(t>=2||nz(),2===t)return"\x01"===e.charAt(0)&&"\x01"===e.charAt(1)||nz(),re.emptyPath();let n=t-2,r=[],i="";for(let s=0;s<t;){let t=e.indexOf("\x01",s);switch((t<0||t>n)&&nz(),e.charAt(t+1)){case"\x01":let a,o=e.substring(s,t);0===i.length?a=o:(i+=o,a=i,i=""),r.push(a);break;case"\x10":i+=e.substring(s,t),i+="\0";break;case"\x11":i+=e.substring(s,t+1);break;default:nz()}s=t+2}return new re(r)}let an=["userId","batchId"],ar={},ai=["prefixPath","collectionGroup","readTime","documentId"],as=["prefixPath","collectionGroup","documentId"],aa=["collectionGroup","readTime","prefixPath","documentId"],ao=["canonicalId","targetId"],al=["targetId","path"],au=["path","targetId"],ac=["collectionId","parent"],ah=["indexId","uid"],ad=["uid","sequenceNumber"],af=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],ap=["indexId","uid","orderedDocumentKey"],am=["userId","collectionPath","documentId"],ag=["userId","collectionPath","largestBatchId"],ay=["userId","collectionGroup","largestBatchId"],av=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],aw=[...av,"documentOverlays"],ab=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],aI=[...ab,"indexConfiguration","indexState","indexEntries"];class a_ extends rp{constructor(e,t){super(),this.se=e,this.currentSequenceNumber=t}}function aE(e,t){return rv.M(e.se,t)}class aT{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){let n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){let r=this.mutations[t];r.key.isEqual(e.key)&&function(e,t,n){e instanceof sc?function(e,t,n){let r=e.value.clone(),i=sf(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof sh?function(e,t,n){if(!ss(e.precondition,t))return t.convertToUnknownDocument(n.version);let r=sf(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(sd(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):t.convertToNoDocument(n.version).setHasCommittedMutations()}(r,e,n[t])}}applyToLocalView(e,t){for(let n of this.baseMutations)n.key.isEqual(e.key)&&(t=sl(n,e,t,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(e.key)&&(t=sl(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let n=sS();return this.mutations.forEach(r=>{let i=e.get(r.key),s=i.overlayedDocument,a=this.applyToLocalView(s,i.mutatedFields),o=so(s,a=t.has(r.key)?null:a);null!==o&&n.set(r.key,o),s.isValidDocument()||s.convertToNoDocument(n8.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),sC())}isEqual(e){return this.batchId===e.batchId&&n5(this.mutations,e.mutations,(e,t)=>su(e,t))&&n5(this.baseMutations,e.baseMutations,(e,t)=>su(e,t))}}class aS{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){e.mutations.length===n.length||nz();let r=sk,i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new aS(e,t,n,r)}}class ak{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class aA{constructor(e,t,n,r,i=n8.min(),s=n8.min(),a=rF.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a}withSequenceNumber(e){return new aA(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new aA(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new aA(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class aC{constructor(e){this.ie=e}}function aD(e,t){let n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:aN(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument()){var i;r.document={name:sH(i=e.ie,t.key),fields:t.data.value.mapValue.fields,updateTime:s$(i,t.version.toTimestamp()),createTime:s$(i,t.createTime.toTimestamp())}}else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:aR(t.version)};else{if(!t.isUnknownDocument())return nz();r.unknownDocument={path:n.path.toArray(),version:aR(t.version)}}return r}function aN(e){let t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function aR(e){let t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function ax(e){let t=new n9(e.seconds,e.nanoseconds);return n8.fromTimestamp(t)}function aO(e,t){let n=(t.baseMutations||[]).map(t=>s3(e.ie,t));for(let e=0;e<t.mutations.length-1;++e){let n=t.mutations[e];e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform&&(n.updateTransforms=t.mutations[e+1].transform.fieldTransforms,t.mutations.splice(e+1,1),++e)}let r=t.mutations.map(t=>s3(e.ie,t)),i=n9.fromMillis(t.localWriteTimeMs);return new aT(t.batchId,i,n,r)}function aP(e){var t;let n,r=ax(e.readTime),i=void 0!==e.lastLimboFreeSnapshotVersion?ax(e.lastLimboFreeSnapshotVersion):n8.min();return void 0!==e.query.documents?(1===(t=e.query).documents.length||nz(),n=iG(iU(sX(t.documents[0])))):n=iG(s5(e.query)),new aA(n,e.targetId,0,e.lastListenSequenceNumber,r,i,rF.fromBase64String(e.resumeToken))}function aL(e,t){let n,r=aR(t.snapshotVersion),i=aR(t.lastLimboFreeSnapshotVersion);n=iO(t.target)?s6(e.ie,t.target):s4(e.ie,t.target);let s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:iR(t.target),readTime:r,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:n}}function aM(e){let t=s5({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?iz(t,t.limit,"L"):t}function aF(e,t){return new ak(t.largestBatchId,s3(e.ie,t.overlayMutation))}function aU(e,t){let n=t.path.lastSegment();return[e,ae(t.path.popLast()),n]}function aV(e,t,n,r){return{indexId:e,uid:t.uid||"",sequenceNumber:n,readTime:aR(r.readTime),documentKey:ae(r.documentKey.path),largestBatchId:r.largestBatchId}}class aq{getBundleMetadata(e,t){return aB(e).get(t).next(e=>{if(e)return{id:e.bundleId,createTime:ax(e.createTime),version:e.version}})}saveBundleMetadata(e,t){return aB(e).put({bundleId:t.id,createTime:aR(sK(t.createTime)),version:t.version})}getNamedQuery(e,t){return aj(e).get(t).next(e=>{if(e)return{name:e.name,query:aM(e.bundledQuery),readTime:ax(e.readTime)}})}saveNamedQuery(e,t){return aj(e).put({name:t.name,readTime:aR(sK(t.readTime)),bundledQuery:t.bundledQuery})}}function aB(e){return aE(e,"bundles")}function aj(e){return aE(e,"namedQueries")}class a${constructor(e,t){this.yt=e,this.userId=t}static re(e,t){return new a$(e,t.uid||"")}getOverlay(e,t){return aG(e).get(aU(this.userId,t)).next(e=>e?aF(this.yt,e):null)}getOverlays(e,t){let n=sS();return rg.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){let r=[];return n.forEach((n,i)=>{let s=new ak(t,i);r.push(this.oe(e,s))}),rg.waitFor(r)}removeOverlaysForBatchId(e,t,n){let r=new Set;t.forEach(e=>r.add(ae(e.getCollectionPath())));let i=[];return r.forEach(t=>{let r=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,n+1],!1,!0);i.push(aG(e).Y("collectionPathOverlayIndex",r))}),rg.waitFor(i)}getOverlaysForCollection(e,t,n){let r=sS(),i=ae(t),s=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,1/0],!0);return aG(e).W("collectionPathOverlayIndex",s).next(e=>{for(let t of e){let e=aF(this.yt,t);r.set(e.getKey(),e)}return r})}getOverlaysForCollectionGroup(e,t,n,r){let i,s=sS(),a=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,1/0],!0);return aG(e).Z({index:"collectionGroupOverlayIndex",range:a},(e,t,n)=>{let a=aF(this.yt,t);s.size()<r||a.largestBatchId===i?(s.set(a.getKey(),a),i=a.largestBatchId):n.done()}).next(()=>s)}oe(e,t){return aG(e).put(function(e,t,n){let[r,i,s]=aU(t,n.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:s2(e.ie,n.mutation)}}(this.yt,this.userId,t))}}function aG(e){return aE(e,"documentOverlays")}class aK{constructor(){}ue(e,t){this.ce(e,t),t.ae()}ce(e,t){if("nullValue"in e)this.he(t,5);else if("booleanValue"in e)this.he(t,10),t.le(+!!e.booleanValue);else if("integerValue"in e)this.he(t,15),t.le(rq(e.integerValue));else if("doubleValue"in e){let n=rq(e.doubleValue);isNaN(n)?this.he(t,13):(this.he(t,15),rL(n)?t.le(0):t.le(n))}else if("timestampValue"in e){let n=e.timestampValue;this.he(t,20),"string"==typeof n?t.fe(n):(t.fe(`${n.seconds||""}`),t.le(n.nanos||0))}else if("stringValue"in e)this.de(e.stringValue,t),this._e(t);else if("bytesValue"in e)this.he(t,30),t.we(rB(e.bytesValue)),this._e(t);else if("referenceValue"in e)this.me(e.referenceValue,t);else if("geoPointValue"in e){let n=e.geoPointValue;this.he(t,45),t.le(n.latitude||0),t.le(n.longitude||0)}else"mapValue"in e?r4(e)?this.he(t,Number.MAX_SAFE_INTEGER):(this.ge(e.mapValue,t),this._e(t)):"arrayValue"in e?(this.ye(e.arrayValue,t),this._e(t)):nz()}de(e,t){this.he(t,25),this.pe(e,t)}pe(e,t){t.fe(e)}ge(e,t){let n=e.fields||{};for(let e of(this.he(t,55),Object.keys(n)))this.de(e,t),this.ce(n[e],t)}ye(e,t){let n=e.values||[];for(let e of(this.he(t,50),n))this.ce(e,t)}me(e,t){this.he(t,37),rr.fromName(e).path.forEach(e=>{this.he(t,60),this.pe(e,t)})}he(e,t){e.le(t)}_e(e){e.le(2)}}function az(e){return Math.ceil((64-function(e){let t=0;for(let n=0;n<8;++n){let r=function(e){if(0===e)return 8;let t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}(255&e[n]);if(t+=r,8!==r)break}return t}(e))/8)}aK.Ie=new aK;class aW{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Te(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.Ee(n.value),n=t.next();this.Ae()}Re(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.be(n.value),n=t.next();this.Pe()}ve(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.Ee(e);else if(e<2048)this.Ee(960|e>>>6),this.Ee(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Ee(480|e>>>12),this.Ee(128|63&e>>>6),this.Ee(128|63&e);else{let e=t.codePointAt(0);this.Ee(240|e>>>18),this.Ee(128|63&e>>>12),this.Ee(128|63&e>>>6),this.Ee(128|63&e)}}this.Ae()}Ve(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.be(e);else if(e<2048)this.be(960|e>>>6),this.be(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.be(480|e>>>12),this.be(128|63&e>>>6),this.be(128|63&e);else{let e=t.codePointAt(0);this.be(240|e>>>18),this.be(128|63&e>>>12),this.be(128|63&e>>>6),this.be(128|63&e)}}this.Pe()}Se(e){let t=this.De(e),n=az(t);this.Ce(1+n),this.buffer[this.position++]=255&n;for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=255&t[e]}xe(e){let t=this.De(e),n=az(t);this.Ce(1+n),this.buffer[this.position++]=~(255&n);for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}Ne(){this.ke(255),this.ke(255)}Oe(){this.Me(255),this.Me(255)}reset(){this.position=0}seed(e){this.Ce(e.length),this.buffer.set(e,this.position),this.position+=e.length}Fe(){return this.buffer.slice(0,this.position)}De(e){let t=function(e){let t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=0!=(128&t[0]);t[0]^=n?255:128;for(let e=1;e<t.length;++e)t[e]^=255*!!n;return t}Ee(e){let t=255&e;0===t?(this.ke(0),this.ke(255)):255===t?(this.ke(255),this.ke(0)):this.ke(t)}be(e){let t=255&e;0===t?(this.Me(0),this.Me(255)):255===t?(this.Me(255),this.Me(0)):this.Me(e)}Ae(){this.ke(0),this.ke(1)}Pe(){this.Me(0),this.Me(1)}ke(e){this.Ce(1),this.buffer[this.position++]=e}Me(e){this.Ce(1),this.buffer[this.position++]=~e}Ce(e){let t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);let r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}}class aH{constructor(e){this.$e=e}we(e){this.$e.Te(e)}fe(e){this.$e.ve(e)}le(e){this.$e.Se(e)}ae(){this.$e.Ne()}}class aQ{constructor(e){this.$e=e}we(e){this.$e.Re(e)}fe(e){this.$e.Ve(e)}le(e){this.$e.xe(e)}ae(){this.$e.Oe()}}class aY{constructor(){this.$e=new aW,this.Be=new aH(this.$e),this.Le=new aQ(this.$e)}seed(e){this.$e.seed(e)}qe(e){return 0===e?this.Be:this.Le}Fe(){return this.$e.Fe()}reset(){this.$e.reset()}}class aX{constructor(e,t,n,r){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=r}Ue(){let e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new aX(this.indexId,this.documentKey,this.arrayValue,n)}}function aJ(e,t){let n=e.indexId-t.indexId;return 0!==n||0!==(n=aZ(e.arrayValue,t.arrayValue))||0!==(n=aZ(e.directionalValue,t.directionalValue))?n:rr.comparator(e.documentKey,t.documentKey)}function aZ(e,t){for(let n=0;n<e.length&&n<t.length;++n){let r=e[n]-t[n];if(0!==r)return r}return e.length-t.length}class a0{constructor(e){for(let t of(this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Ke=e.orderBy,this.Ge=[],e.filters))t.isInequality()?this.Qe=t:this.Ge.push(t)}je(e){e.collectionGroup===this.collectionId||nz();let t=rs(e);if(void 0!==t&&!this.We(t))return!1;let n=ra(e),r=0,i=0;for(;r<n.length&&this.We(n[r]);++r);if(r===n.length)return!0;if(void 0!==this.Qe){let e=n[r];if(!this.ze(this.Qe,e)||!this.He(this.Ke[i++],e))return!1;++r}for(;r<n.length;++r){let e=n[r];if(i>=this.Ke.length||!this.He(this.Ke[i++],e))return!1}return!0}We(e){for(let t of this.Ge)if(this.ze(t,e))return!0;return!1}ze(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;let n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===n}He(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function a1(e){return e instanceof ir}function a2(e){return e instanceof ii&&io(e)}function a3(e){return a1(e)||a2(e)||function(e){if(e instanceof ii&&ia(e)){for(let t of e.getFilters())if(!a1(t)&&!a2(t))return!1;return!0}return!1}(e)}function a6(e,t){return e instanceof ir||e instanceof ii||nz(),t instanceof ir||t instanceof ii||nz(),a5(e instanceof ir?t instanceof ir?ii.create([e,t],"and"):a4(e,t):t instanceof ir?a4(t,e):function(e,t){if(e.filters.length>0&&t.filters.length>0||nz(),is(e)&&is(t))return iu(e,t.getFilters());let n=ia(e)?e:t,r=ia(e)?t:e,i=n.filters.map(e=>a6(e,r));return ii.create(i,"or")}(e,t))}function a4(e,t){if(is(t))return iu(t,e.getFilters());{let n=t.filters.map(t=>a6(e,t));return ii.create(n,"or")}}function a5(e){if(e instanceof ir||e instanceof ii||nz(),e instanceof ir)return e;let t=e.getFilters();if(1===t.length)return a5(t[0]);if(il(e))return e;let n=t.map(e=>a5(e)),r=[];return n.forEach(t=>{t instanceof ir?r.push(t):t instanceof ii&&(t.op===e.op?r.push(...t.filters):r.push(t))}),1===r.length?r[0]:ii.create(r,e.op)}class a9{constructor(){this.Je=new a8}addToCollectionParentIndex(e,t){return this.Je.add(t),rg.resolve()}getCollectionParents(e,t){return rg.resolve(this.Je.getEntries(t))}addFieldIndex(e,t){return rg.resolve()}deleteFieldIndex(e,t){return rg.resolve()}getDocumentsMatchingTarget(e,t){return rg.resolve(null)}getIndexType(e,t){return rg.resolve(0)}getFieldIndexes(e,t){return rg.resolve([])}getNextCollectionGroupToUpdate(e){return rg.resolve(null)}getMinOffset(e,t){return rg.resolve(rh.min())}getMinOffsetFromCollectionGroup(e,t){return rg.resolve(rh.min())}updateCollectionGroup(e,t,n){return rg.resolve()}updateIndexEntries(e,t){return rg.resolve()}}class a8{constructor(){this.index={}}add(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new iE(re.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new iE(re.comparator)).toArray()}}let a7=new Uint8Array(0);class oe{constructor(e,t){this.user=e,this.databaseId=t,this.Ye=new a8,this.Xe=new sb(e=>iR(e),(e,t)=>ix(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.Ye.has(t)){let n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.Ye.add(t)});let i={collectionId:n,parent:ae(r)};return ot(e).put(i)}return rg.resolve()}getCollectionParents(e,t){let n=[],r=IDBKeyRange.bound([t,""],[t+"\0",""],!1,!0);return ot(e).W(r).next(e=>{for(let r of e){if(r.collectionId!==t)break;n.push(at(r.parent))}return n})}addFieldIndex(e,t){let n=or(e),r={indexId:t.indexId,collectionGroup:t.collectionGroup,fields:t.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])};delete r.indexId;let i=n.add(r);if(t.indexState){let n=oi(e);return i.next(e=>{n.put(aV(e,this.user,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){let n=or(e),r=oi(e),i=on(e);return n.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}getDocumentsMatchingTarget(e,t){let n=on(e),r=!0,i=new Map;return rg.forEach(this.Ze(t),t=>this.tn(e,t).next(e=>{r&&(r=!!e),i.set(t,e)})).next(()=>{if(r){let e=sC(),r=[];return rg.forEach(i,(i,s)=>{nj("IndexedDbIndexManager",`Using index id=${i.indexId}|cg=${i.collectionGroup}|f=${i.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")} to execute ${iR(t)}`);let a=function(e,t){let n=rs(t);if(void 0===n)return null;for(let t of iP(e,n.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(s,i),o=function(e,t){let n=new Map;for(let r of ra(t))for(let t of iP(e,r.fieldPath))switch(t.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}(s,i),l=function(e,t){let n=[],r=!0;for(let i of ra(t)){let t=0===i.kind?iL(e,i.fieldPath,e.startAt):iM(e,i.fieldPath,e.startAt);n.push(t.value),r&&(r=t.inclusive)}return new r8(n,r)}(s,i),u=function(e,t){let n=[],r=!0;for(let i of ra(t)){let t=0===i.kind?iM(e,i.fieldPath,e.endAt):iL(e,i.fieldPath,e.endAt);n.push(t.value),r&&(r=t.inclusive)}return new r8(n,r)}(s,i),c=this.en(i,s,l),h=this.en(i,s,u),d=this.nn(i,s,o),f=this.sn(i.indexId,a,c,l.inclusive,h,u.inclusive,d);return rg.forEach(f,i=>n.J(i,t.limit).next(t=>{t.forEach(t=>{let n=rr.fromSegments(t.documentKey);e.has(n)||(e=e.add(n),r.push(n))})}))}).next(()=>r)}return rg.resolve(null)})}Ze(e){let t=this.Xe.get(e);return t||(t=0===e.filters.length?[e]:(function(e){if(0===e.getFilters().length)return[];let t=function e(t){if(t instanceof ir||t instanceof ii||nz(),t instanceof ir)return t;if(1===t.filters.length)return e(t.filters[0]);let n=t.filters.map(t=>e(t)),r=ii.create(n,t.op);return a3(r=a5(r))?r:(r instanceof ii||nz(),is(r)||nz(),r.filters.length>1||nz(),r.filters.reduce((e,t)=>a6(e,t)))}(function e(t){var n,r;if(t instanceof ir||t instanceof ii||nz(),t instanceof ir){if(t instanceof ig){let e=(null==(r=null==(n=t.value.arrayValue)?void 0:n.values)?void 0:r.map(e=>ir.create(t.field,"==",e)))||[];return ii.create(e,"or")}return t}let i=t.filters.map(t=>e(t));return ii.create(i,t.op)}(e));return a3(t)||nz(),a1(t)||a2(t)?[t]:t.getFilters()})(ii.create(e.filters,"and")).map(t=>iN(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt)),this.Xe.set(e,t)),t}sn(e,t,n,r,i,s,a){let o=(null!=t?t.length:1)*Math.max(n.length,i.length),l=o/(null!=t?t.length:1),u=[];for(let c=0;c<o;++c){let o=t?this.rn(t[c/l]):a7,h=this.on(e,o,n[c%l],r),d=this.un(e,o,i[c%l],s),f=a.map(t=>this.on(e,o,t,!0));u.push(...this.createRange(h,d,f))}return u}on(e,t,n,r){let i=new aX(e,rr.empty(),t,n);return r?i:i.Ue()}un(e,t,n,r){let i=new aX(e,rr.empty(),t,n);return r?i.Ue():i}tn(e,t){let n=new a0(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next(e=>{let t=null;for(let r of e)n.je(r)&&(!t||r.fields.length>t.fields.length)&&(t=r);return t})}getIndexType(e,t){let n=2,r=this.Ze(t);return rg.forEach(r,t=>this.tn(e,t).next(e=>{e?0!==n&&e.fields.length<function(e){let t=new iE(rn.comparator),n=!1;for(let r of e.filters)for(let e of r.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field));for(let n of e.orderBy)n.field.isKeyField()||(t=t.add(n.field));return t.size+ +!!n}(t)&&(n=1):n=0})).next(()=>null!==t.limit&&r.length>1&&2===n?1:n)}cn(e,t){let n=new aY;for(let r of ra(e)){let e=t.data.field(r.fieldPath);if(null==e)return null;let i=n.qe(r.kind);aK.Ie.ue(e,i)}return n.Fe()}rn(e){let t=new aY;return aK.Ie.ue(e,t.qe(0)),t.Fe()}an(e,t){let n=new aY;return aK.Ie.ue(rJ(this.databaseId,t),n.qe(function(e){let t=ra(e);return 0===t.length?0:t[t.length-1].kind}(e))),n.Fe()}nn(e,t,n){if(null===n)return[];let r=[];r.push(new aY);let i=0;for(let s of ra(e)){let e=n[i++];for(let n of r)if(this.hn(t,s.fieldPath)&&r0(e))r=this.ln(r,s,e);else{let t=n.qe(s.kind);aK.Ie.ue(e,t)}}return this.fn(r)}en(e,t,n){return this.nn(e,t,n.position)}fn(e){let t=[];for(let n=0;n<e.length;++n)t[n]=e[n].Fe();return t}ln(e,t,n){let r=[...e],i=[];for(let e of n.arrayValue.values||[])for(let n of r){let r=new aY;r.seed(n.Fe()),aK.Ie.ue(e,r.qe(t.kind)),i.push(r)}return i}hn(e,t){return!!e.filters.find(e=>e instanceof ir&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){let n=or(e),r=oi(e);return(t?n.W("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.W()).next(e=>{let t=[];return rg.forEach(e,e=>r.get([e.indexId,this.uid]).next(n=>{t.push(function(e,t){let n=t?new rl(t.sequenceNumber,new rh(ax(t.readTime),new rr(at(t.documentKey)),t.largestBatchId)):rl.empty(),r=e.fields.map(([e,t])=>new ro(rn.fromServerFormat(e),t));return new ri(e.indexId,e.collectionGroup,r,n)}(e,n))})).next(()=>t)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{let n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==n?n:n4(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,t,n){let r=or(e),i=oi(e);return this.dn(e).next(e=>r.W("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(t=>rg.forEach(t,t=>i.put(aV(t.indexId,this.user,e,n)))))}updateIndexEntries(e,t){let n=new Map;return rg.forEach(t,(t,r)=>{let i=n.get(t.collectionGroup);return(i?rg.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next(i=>(n.set(t.collectionGroup,i),rg.forEach(i,n=>this._n(e,t,n).next(t=>{let i=this.wn(r,n);return t.isEqual(i)?rg.resolve():this.mn(e,r,n,t,i)}))))})}gn(e,t,n,r){return on(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.an(n,t.key),documentKey:t.key.path.toArray()})}yn(e,t,n,r){return on(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.an(n,t.key),t.key.path.toArray()])}_n(e,t,n){let r=on(e),i=new iE(aJ);return r.Z({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.an(n,t)])},(e,r)=>{i=i.add(new aX(n.indexId,t,r.arrayValue,r.directionalValue))}).next(()=>i)}wn(e,t){let n=new iE(aJ),r=this.cn(t,e);if(null==r)return n;let i=rs(t);if(null!=i){let s=e.data.field(i.fieldPath);if(r0(s))for(let i of s.arrayValue.values||[])n=n.add(new aX(t.indexId,e.key,this.rn(i),r))}else n=n.add(new aX(t.indexId,e.key,a7,r));return n}mn(e,t,n,r,i){nj("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);let s=[];return function(e,t,n,r,i){let s=e.getIterator(),a=t.getIterator(),o=iS(s),l=iS(a);for(;o||l;){let e=!1,t=!1;if(o&&l){let r=n(o,l);r<0?t=!0:r>0&&(e=!0)}else null!=o?t=!0:e=!0;e?(r(l),l=iS(a)):t?(i(o),o=iS(s)):(o=iS(s),l=iS(a))}}(r,i,aJ,r=>{s.push(this.gn(e,t,n,r))},r=>{s.push(this.yn(e,t,n,r))}),rg.waitFor(s)}dn(e){let t=1;return oi(e).Z({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,n,r)=>{r.done(),t=n.sequenceNumber+1}).next(()=>t)}createRange(e,t,n){n=n.sort((e,t)=>aJ(e,t)).filter((e,t,n)=>!t||0!==aJ(e,n[t-1]));let r=[];for(let i of(r.push(e),n)){let n=aJ(i,e),s=aJ(i,t);if(0===n)r[0]=e.Ue();else if(n>0&&s<0)r.push(i),r.push(i.Ue());else if(s>0)break}r.push(t);let i=[];for(let e=0;e<r.length;e+=2){if(this.pn(r[e],r[e+1]))return[];let t=[r[e].indexId,this.uid,r[e].arrayValue,r[e].directionalValue,a7,[]],n=[r[e+1].indexId,this.uid,r[e+1].arrayValue,r[e+1].directionalValue,a7,[]];i.push(IDBKeyRange.bound(t,n))}return i}pn(e,t){return aJ(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(os)}getMinOffset(e,t){return rg.mapArray(this.Ze(t),t=>this.tn(e,t).next(e=>e||nz())).next(os)}}function ot(e){return aE(e,"collectionParents")}function on(e){return aE(e,"indexEntries")}function or(e){return aE(e,"indexConfiguration")}function oi(e){return aE(e,"indexState")}function os(e){0!==e.length||nz();let t=e[0].indexState.offset,n=t.largestBatchId;for(let r=1;r<e.length;r++){let i=e[r].indexState.offset;0>rd(i,t)&&(t=i),n<i.largestBatchId&&(n=i.largestBatchId)}return new rh(t.readTime,t.documentKey,n)}let oa={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class oo{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new oo(e,oo.DEFAULT_COLLECTION_PERCENTILE,oo.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function ol(e,t,n){let r=e.store("mutations"),i=e.store("documentMutations"),s=[],a=IDBKeyRange.only(n.batchId),o=0,l=r.Z({range:a},(e,t,n)=>(o++,n.delete()));s.push(l.next(()=>{1===o||nz()}));let u=[];for(let e of n.mutations){var c,h;let r=(c=e.key.path,h=n.batchId,[t,ae(c),h]);s.push(i.delete(r)),u.push(e.key)}return rg.waitFor(s).next(()=>u)}function ou(e){let t;if(!e)return 0;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw nz();t=e.noDocument}return JSON.stringify(t).length}oo.DEFAULT_COLLECTION_PERCENTILE=10,oo.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,oo.DEFAULT=new oo(0x2800000,oo.DEFAULT_COLLECTION_PERCENTILE,oo.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),oo.DISABLED=new oo(-1,0,0);class oc{constructor(e,t,n,r){this.userId=e,this.yt=t,this.indexManager=n,this.referenceDelegate=r,this.In={}}static re(e,t,n,r){return""!==e.uid||nz(),new oc(e.isAuthenticated()?e.uid:"",t,n,r)}checkEmpty(e){let t=!0,n=IDBKeyRange.bound([this.userId,-1/0],[this.userId,1/0]);return od(e).Z({index:"userMutationsIndex",range:n},(e,n,r)=>{t=!1,r.done()}).next(()=>t)}addMutationBatch(e,t,n,r){let i=of(e),s=od(e);return s.add({}).next(a=>{var o,l;"number"==typeof a||nz();let u=new aT(a,t,n,r),c=function(e,t,n){let r=n.baseMutations.map(t=>s2(e.ie,t)),i=n.mutations.map(t=>s2(e.ie,t));return{userId:t,batchId:n.batchId,localWriteTimeMs:n.localWriteTime.toMillis(),baseMutations:r,mutations:i}}(this.yt,this.userId,u),h=[],d=new iE((e,t)=>n4(e.canonicalString(),t.canonicalString()));for(let e of r){let t=(o=this.userId,l=e.key.path,[o,ae(l),a]);d=d.add(e.key.path.popLast()),h.push(s.put(c)),h.push(i.put(t,ar))}return d.forEach(t=>{h.push(this.indexManager.addToCollectionParentIndex(e,t))}),e.addOnCommittedListener(()=>{this.In[a]=u.keys()}),rg.waitFor(h).next(()=>u)})}lookupMutationBatch(e,t){return od(e).get(t).next(e=>e?(e.userId===this.userId||nz(),aO(this.yt,e)):null)}Tn(e,t){return this.In[t]?rg.resolve(this.In[t]):this.lookupMutationBatch(e,t).next(e=>{if(e){let n=e.keys();return this.In[t]=n,n}return null})}getNextMutationBatchAfterBatchId(e,t){let n=t+1,r=IDBKeyRange.lowerBound([this.userId,n]),i=null;return od(e).Z({index:"userMutationsIndex",range:r},(e,t,r)=>{t.userId===this.userId&&(t.batchId>=n||nz(),i=aO(this.yt,t)),r.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,1/0]),n=-1;return od(e).Z({index:"userMutationsIndex",range:t,reverse:!0},(e,t,r)=>{n=t.batchId,r.done()}).next(()=>n)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,1/0]);return od(e).W("userMutationsIndex",t).next(e=>e.map(e=>aO(this.yt,e)))}getAllMutationBatchesAffectingDocumentKey(e,t){let n=[this.userId,ae(t.path)],r=IDBKeyRange.lowerBound(n),i=[];return of(e).Z({range:r},(n,r,s)=>{let[a,o,l]=n,u=at(o);if(a===this.userId&&t.path.isEqual(u))return od(e).get(l).next(e=>{if(!e)throw nz();e.userId===this.userId||nz(),i.push(aO(this.yt,e))});s.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new iE(n4),r=[];return t.forEach(t=>{let i=[this.userId,ae(t.path)],s=IDBKeyRange.lowerBound(i),a=of(e).Z({range:s},(e,r,i)=>{let[s,a,o]=e,l=at(a);s===this.userId&&t.path.isEqual(l)?n=n.add(o):i.done()});r.push(a)}),rg.waitFor(r).next(()=>this.En(e,n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,r=n.length+1,i=[this.userId,ae(n)],s=IDBKeyRange.lowerBound(i),a=new iE(n4);return of(e).Z({range:s},(e,t,i)=>{let[s,o,l]=e,u=at(o);s===this.userId&&n.isPrefixOf(u)?u.length===r&&(a=a.add(l)):i.done()}).next(()=>this.En(e,a))}En(e,t){let n=[],r=[];return t.forEach(t=>{r.push(od(e).get(t).next(e=>{if(null===e)throw nz();e.userId===this.userId||nz(),n.push(aO(this.yt,e))}))}),rg.waitFor(r).next(()=>n)}removeMutationBatch(e,t){return ol(e.se,this.userId,t).next(n=>(e.addOnCommittedListener(()=>{this.An(t.batchId)}),rg.forEach(n,t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))}An(e){delete this.In[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return rg.resolve();let n=IDBKeyRange.lowerBound([this.userId]),r=[];return of(e).Z({range:n},(e,t,n)=>{if(e[0]===this.userId){let t=at(e[1]);r.push(t)}else n.done()}).next(()=>{0===r.length||nz()})})}containsKey(e,t){return oh(e,this.userId,t)}Rn(e){return op(e).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function oh(e,t,n){let r=[t,ae(n.path)],i=r[1],s=IDBKeyRange.lowerBound(r),a=!1;return of(e).Z({range:s,X:!0},(e,n,r)=>{let[s,o,l]=e;s===t&&o===i&&(a=!0),r.done()}).next(()=>a)}function od(e){return aE(e,"mutations")}function of(e){return aE(e,"documentMutations")}function op(e){return aE(e,"mutationQueues")}class om{constructor(e){this.bn=e}next(){return this.bn+=2,this.bn}static Pn(){return new om(0)}static vn(){return new om(-1)}}class og{constructor(e,t){this.referenceDelegate=e,this.yt=t}allocateTargetId(e){return this.Vn(e).next(t=>{let n=new om(t.highestTargetId);return t.highestTargetId=n.next(),this.Sn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Vn(e).next(e=>n8.fromTimestamp(new n9(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Vn(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.Vn(e).next(r=>(r.highestListenSequenceNumber=t,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.Sn(e,r)))}addTargetData(e,t){return this.Dn(e,t).next(()=>this.Vn(e).next(n=>(n.targetCount+=1,this.Cn(t,n),this.Sn(e,n))))}updateTargetData(e,t){return this.Dn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>oy(e).delete(t.targetId)).next(()=>this.Vn(e)).next(t=>(t.targetCount>0||nz(),t.targetCount-=1,this.Sn(e,t)))}removeTargets(e,t,n){let r=0,i=[];return oy(e).Z((s,a)=>{let o=aP(a);o.sequenceNumber<=t&&null===n.get(o.targetId)&&(r++,i.push(this.removeTargetData(e,o)))}).next(()=>rg.waitFor(i)).next(()=>r)}forEachTarget(e,t){return oy(e).Z((e,n)=>{t(aP(n))})}Vn(e){return ov(e).get("targetGlobalKey").next(e=>(null!==e||nz(),e))}Sn(e,t){return ov(e).put("targetGlobalKey",t)}Dn(e,t){return oy(e).put(aL(this.yt,t))}Cn(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.Vn(e).next(e=>e.targetCount)}getTargetData(e,t){let n=iR(t),r=IDBKeyRange.bound([n,-1/0],[n,1/0]),i=null;return oy(e).Z({range:r,index:"queryTargetsIndex"},(e,n,r)=>{let s=aP(n);ix(t,s.target)&&(i=s,r.done())}).next(()=>i)}addMatchingKeys(e,t,n){let r=[],i=ow(e);return t.forEach(t=>{let s=ae(t.path);r.push(i.put({targetId:n,path:s})),r.push(this.referenceDelegate.addReference(e,n,t))}),rg.waitFor(r)}removeMatchingKeys(e,t,n){let r=ow(e);return rg.forEach(t,t=>{let i=ae(t.path);return rg.waitFor([r.delete([n,i]),this.referenceDelegate.removeReference(e,n,t)])})}removeMatchingKeysForTargetId(e,t){let n=ow(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){let n=IDBKeyRange.bound([t],[t+1],!1,!0),r=ow(e),i=sC();return r.Z({range:n,X:!0},(e,t,n)=>{let r=new rr(at(e[1]));i=i.add(r)}).next(()=>i)}containsKey(e,t){let n=ae(t.path),r=IDBKeyRange.bound([n],[n+"\0"],!1,!0),i=0;return ow(e).Z({index:"documentTargetsIndex",X:!0,range:r},([e,t],n,r)=>{0!==e&&(i++,r.done())}).next(()=>i>0)}ne(e,t){return oy(e).get(t).next(e=>e?aP(e):null)}}function oy(e){return aE(e,"targets")}function ov(e){return aE(e,"targetGlobal")}function ow(e){return aE(e,"targetDocuments")}function ob([e,t],[n,r]){let i=n4(e,n);return 0===i?n4(t,r):i}class oI{constructor(e){this.xn=e,this.buffer=new iE(ob),this.Nn=0}kn(){return++this.Nn}On(e){let t=[e,this.kn()];if(this.buffer.size<this.xn)this.buffer=this.buffer.add(t);else{let e=this.buffer.last();0>ob(t,e)&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class o_{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Mn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Fn(6e4)}stop(){this.Mn&&(this.Mn.cancel(),this.Mn=null)}get started(){return null!==this.Mn}Fn(e){nj("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Mn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Mn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){rI(e)?nj("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):await rm(e)}await this.Fn(3e5)})}}class oE{constructor(e,t){this.$n=e,this.params=t}calculateTargetCount(e,t){return this.$n.Bn(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return rg.resolve(rC.at);let n=new oI(t);return this.$n.forEachTarget(e,e=>n.On(e.sequenceNumber)).next(()=>this.$n.Ln(e,e=>n.On(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.$n.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.$n.removeOrphanedDocuments(e,t)}collect(e,t){return -1===this.params.cacheSizeCollectionThreshold?(nj("LruGarbageCollector","Garbage collection skipped; disabled"),rg.resolve(oa)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(nj("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),oa):this.qn(e,t))}getCacheSize(e){return this.$n.getCacheSize(e)}qn(e,t){let n,r,i,s,a,o,l,u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(nj("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,s=Date.now(),this.nthSequenceNumber(e,r))).next(r=>(n=r,a=Date.now(),this.removeTargets(e,n,t))).next(t=>(i=t,o=Date.now(),this.removeOrphanedDocuments(e,n))).next(e=>(l=Date.now(),nB()<=g.in.DEBUG&&nj("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${s-u}ms
	Determined least recently used ${r} in `+(a-s)+"ms\n"+`	Removed ${i} targets in `+(o-a)+"ms\n"+`	Removed ${e} documents in `+(l-o)+"ms\n"+`Total Duration: ${l-u}ms`),rg.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e})))}}class oT{constructor(e,t){this.db=e,this.garbageCollector=new oE(this,t)}Bn(e){let t=this.Un(e);return this.db.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}Un(e){let t=0;return this.Ln(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Ln(e,t){return this.Kn(e,(e,n)=>t(n))}addReference(e,t,n){return oS(e,n)}removeReference(e,t,n){return oS(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return oS(e,t)}Gn(e,t){let n;return n=!1,op(e).tt(r=>oh(e,r,t).next(e=>(e&&(n=!0),rg.resolve(!e)))).next(()=>n)}removeOrphanedDocuments(e,t){let n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[],i=0;return this.Kn(e,(s,a)=>{if(a<=t){let t=this.Gn(e,s).next(t=>{if(!t)return i++,n.getEntry(e,s).next(()=>(n.removeEntry(s,n8.min()),ow(e).delete([0,ae(s.path)])))});r.push(t)}}).next(()=>rg.waitFor(r)).next(()=>n.apply(e)).next(()=>i)}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return oS(e,t)}Kn(e,t){let n=ow(e),r,i=rC.at;return n.Z({index:"documentTargetsIndex"},([e,n],{path:s,sequenceNumber:a})=>{0===e?(i!==rC.at&&t(new rr(at(r)),i),i=a,r=s):i=rC.at}).next(()=>{i!==rC.at&&t(new rr(at(r)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function oS(e,t){var n;return ow(e).put((n=e.currentSequenceNumber,{targetId:0,path:ae(t.path),sequenceNumber:n}))}class ok{constructor(){this.changes=new sb(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,iC.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let n=this.changes.get(t);return void 0!==n?rg.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class oA{constructor(e){this.yt=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return oN(e).put(n)}removeEntry(e,t,n){return oN(e).delete(function(e,t){let n=e.path.toArray();return[n.slice(0,n.length-2),n[n.length-2],aN(t),n[n.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next(n=>(n.byteSize+=t,this.Qn(e,n)))}getEntry(e,t){let n=iC.newInvalidDocument(t);return oN(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(oR(t))},(e,r)=>{n=this.jn(t,r)}).next(()=>n)}Wn(e,t){let n={size:0,document:iC.newInvalidDocument(t)};return oN(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(oR(t))},(e,r)=>{n={document:this.jn(t,r),size:ou(r)}}).next(()=>n)}getEntries(e,t){let n=sI;return this.zn(e,t,(e,t)=>{let r=this.jn(e,t);n=n.insert(e,r)}).next(()=>n)}Hn(e,t){let n=sI,r=new ib(rr.comparator);return this.zn(e,t,(e,t)=>{let i=this.jn(e,t);n=n.insert(e,i),r=r.insert(e,ou(t))}).next(()=>({documents:n,Jn:r}))}zn(e,t,n){if(t.isEmpty())return rg.resolve();let r=new iE(oO);t.forEach(e=>r=r.add(e));let i=IDBKeyRange.bound(oR(r.first()),oR(r.last())),s=r.getIterator(),a=s.getNext();return oN(e).Z({index:"documentKeyIndex",range:i},(e,t,r)=>{let i=rr.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;a&&0>oO(a,i);)n(a,null),a=s.getNext();a&&a.isEqual(i)&&(n(a,t),a=s.hasNext()?s.getNext():null),a?r.j(oR(a)):r.done()}).next(()=>{for(;a;)n(a,null),a=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,t,n,r){let i=t.path,s=[i.popLast().toArray(),i.lastSegment(),aN(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],a=[i.popLast().toArray(),i.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return oN(e).W(IDBKeyRange.bound(s,a,!0)).next(e=>{let n=sI;for(let i of e){let e=this.jn(rr.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(iY(t,e)||r.has(e.key))&&(n=n.insert(e.key,e))}return n})}getAllFromCollectionGroup(e,t,n,r){let i=sI,s=ox(t,n),a=ox(t,rh.max());return oN(e).Z({index:"collectionGroupIndex",range:IDBKeyRange.bound(s,a,!0)},(e,t,n)=>{let s=this.jn(rr.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);(i=i.insert(s.key,s)).size===r&&n.done()}).next(()=>i)}newChangeBuffer(e){return new oC(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return oD(e).get("remoteDocumentGlobalKey").next(e=>(e||nz(),e))}Qn(e,t){return oD(e).put("remoteDocumentGlobalKey",t)}jn(e,t){if(t){let e=function(e,t){let n;if(t.document)n=s1(e.ie,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let e=rr.fromSegments(t.noDocument.path),r=ax(t.noDocument.readTime);n=iC.newNoDocument(e,r),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return nz();{let e=rr.fromSegments(t.unknownDocument.path),r=ax(t.unknownDocument.version);n=iC.newUnknownDocument(e,r)}}return t.readTime&&n.setReadTime(function(e){let t=new n9(e[0],e[1]);return n8.fromTimestamp(t)}(t.readTime)),n}(this.yt,t);if(!(e.isNoDocument()&&e.version.isEqual(n8.min())))return e}return iC.newInvalidDocument(e)}}class oC extends ok{constructor(e,t){super(),this.Yn=e,this.trackRemovals=t,this.Xn=new sb(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(e){let t=[],n=0,r=new iE((e,t)=>n4(e.canonicalString(),t.canonicalString()));return this.changes.forEach((i,s)=>{let a=this.Xn.get(i);if(t.push(this.Yn.removeEntry(e,i,a.readTime)),s.isValidDocument()){let o=aD(this.Yn.yt,s);r=r.add(i.path.popLast());let l=ou(o);n+=l-a.size,t.push(this.Yn.addEntry(e,i,o))}else if(n-=a.size,this.trackRemovals){let n=aD(this.Yn.yt,s.convertToNoDocument(n8.min()));t.push(this.Yn.addEntry(e,i,n))}}),r.forEach(n=>{t.push(this.Yn.indexManager.addToCollectionParentIndex(e,n))}),t.push(this.Yn.updateMetadata(e,n)),rg.waitFor(t)}getFromCache(e,t){return this.Yn.Wn(e,t).next(e=>(this.Xn.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.Yn.Hn(e,t).next(({documents:e,Jn:t})=>(t.forEach((t,n)=>{this.Xn.set(t,{size:n,readTime:e.get(t).readTime})}),e))}}function oD(e){return aE(e,"remoteDocumentGlobal")}function oN(e){return aE(e,"remoteDocumentsV14")}function oR(e){let t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function ox(e,t){let n=t.documentKey.path.toArray();return[e,aN(t.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function oO(e,t){let n=e.path.toArray(),r=t.path.toArray(),i=0;for(let e=0;e<n.length-2&&e<r.length-2;++e)if(i=n4(n[e],r[e]))return i;return(i=n4(n.length,r.length))||(i=n4(n[n.length-2],r[r.length-2]))||n4(n[n.length-1],r[r.length-1])}class oP{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class oL{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(n=r,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==n&&sl(n.mutation,e,ik.empty(),n9.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,sC()).next(()=>t))}getLocalViewOfDocuments(e,t,n=sC()){let r=sS();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(e=>{let t=sE();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){let n=sS();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,sC()))}populateOverlays(e,t,n){let r=[];return n.forEach(e=>{t.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,r){let i=sI,s=sS(),a=sS();return t.forEach((e,t)=>{let a=n.get(t.key);r.has(t.key)&&(void 0===a||a.mutation instanceof sh)?i=i.insert(t.key,t):void 0!==a?(s.set(t.key,a.mutation.getFieldMask()),sl(a.mutation,t,a.mutation.getFieldMask(),n9.now())):s.set(t.key,ik.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>{var n;return a.set(e,new oP(t,null!=(n=s.get(e))?n:null))}),a))}recalculateAndSaveOverlays(e,t){let n=sS(),r=new ib((e,t)=>e-t),i=sC();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(let i of e)i.keys().forEach(e=>{let s=t.get(e);if(null===s)return;let a=n.get(e)||ik.empty();a=i.applyToLocalView(s,a),n.set(e,a);let o=(r.get(i.batchId)||sC()).add(e);r=r.insert(i.batchId,o)})}).next(()=>{let s=[],a=r.getReverseIterator();for(;a.hasNext();){let r=a.getNext(),o=r.key,l=r.value,u=sS();l.forEach(e=>{if(!i.has(e)){let r=so(t.get(e),n.get(e));null!==r&&u.set(e,r),i=i.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,o,u))}return rg.waitFor(s)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n){return rr.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):ij(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n):this.getDocumentsMatchingCollectionQuery(e,t,n)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next(i=>{let s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):rg.resolve(sS()),a=-1,o=i;return s.next(t=>rg.forEach(t,(t,n)=>(a<n.largestBatchId&&(a=n.largestBatchId),i.get(t)?rg.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{o=o.insert(t,e)}))).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,o,t,sC())).next(e=>({batchId:a,changes:sT(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new rr(t)).next(e=>{let t=sE();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n){let r=t.collectionGroup,i=sE();return this.indexManager.getCollectionParents(e,r).next(s=>rg.forEach(s,s=>{let a=new iF(s.child(r),null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt);return this.getDocumentsMatchingCollectionQuery(e,a,n).next(e=>{e.forEach((e,t)=>{i=i.insert(e,t)})})}).next(()=>i))}getDocumentsMatchingCollectionQuery(e,t,n){let r;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(i=>(r=i,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,r))).next(e=>{r.forEach((t,n)=>{let r=n.getKey();null===e.get(r)&&(e=e.insert(r,iC.newInvalidDocument(r)))});let n=sE();return e.forEach((e,i)=>{let s=r.get(e);void 0!==s&&sl(s.mutation,i,ik.empty(),n9.now()),iY(t,i)&&(n=n.insert(e,i))}),n})}}class oM{constructor(e){this.yt=e,this.Zn=new Map,this.ts=new Map}getBundleMetadata(e,t){return rg.resolve(this.Zn.get(t))}saveBundleMetadata(e,t){return this.Zn.set(t.id,{id:t.id,version:t.version,createTime:sK(t.createTime)}),rg.resolve()}getNamedQuery(e,t){return rg.resolve(this.ts.get(t))}saveNamedQuery(e,t){return this.ts.set(t.name,{name:t.name,query:aM(t.bundledQuery),readTime:sK(t.readTime)}),rg.resolve()}}class oF{constructor(){this.overlays=new ib(rr.comparator),this.es=new Map}getOverlay(e,t){return rg.resolve(this.overlays.get(t))}getOverlays(e,t){let n=sS();return rg.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,r)=>{this.oe(e,t,r)}),rg.resolve()}removeOverlaysForBatchId(e,t,n){let r=this.es.get(n);return void 0!==r&&(r.forEach(e=>this.overlays=this.overlays.remove(e)),this.es.delete(n)),rg.resolve()}getOverlaysForCollection(e,t,n){let r=sS(),i=t.length+1,s=new rr(t.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){let e=a.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return rg.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new ib((e,t)=>e-t),s=this.overlays.getIterator();for(;s.hasNext();){let e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=sS(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}let a=sS(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=r)););return rg.resolve(a)}oe(e,t,n){let r=this.overlays.get(n.key);if(null!==r){let e=this.es.get(r.largestBatchId).delete(n.key);this.es.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new ak(t,n));let i=this.es.get(t);void 0===i&&(i=sC(),this.es.set(t,i)),this.es.set(t,i.add(n.key))}}class oU{constructor(){this.ns=new iE(oV.ss),this.rs=new iE(oV.os)}isEmpty(){return this.ns.isEmpty()}addReference(e,t){let n=new oV(e,t);this.ns=this.ns.add(n),this.rs=this.rs.add(n)}us(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.cs(new oV(e,t))}hs(e,t){e.forEach(e=>this.removeReference(e,t))}ls(e){let t=new rr(new re([])),n=new oV(t,e),r=new oV(t,e+1),i=[];return this.rs.forEachInRange([n,r],e=>{this.cs(e),i.push(e.key)}),i}fs(){this.ns.forEach(e=>this.cs(e))}cs(e){this.ns=this.ns.delete(e),this.rs=this.rs.delete(e)}ds(e){let t=new rr(new re([])),n=new oV(t,e),r=new oV(t,e+1),i=sC();return this.rs.forEachInRange([n,r],e=>{i=i.add(e.key)}),i}containsKey(e){let t=new oV(e,0),n=this.ns.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class oV{constructor(e,t){this.key=e,this._s=t}static ss(e,t){return rr.comparator(e.key,t.key)||n4(e._s,t._s)}static os(e,t){return n4(e._s,t._s)||rr.comparator(e.key,t.key)}}class oq{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.ws=1,this.gs=new iE(oV.ss)}checkEmpty(e){return rg.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){let i=this.ws;this.ws++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let s=new aT(i,t,n,r);for(let t of(this.mutationQueue.push(s),r))this.gs=this.gs.add(new oV(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return rg.resolve(s)}lookupMutationBatch(e,t){return rg.resolve(this.ys(t))}getNextMutationBatchAfterBatchId(e,t){let n=this.ps(t+1),r=n<0?0:n;return rg.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return rg.resolve(0===this.mutationQueue.length?-1:this.ws-1)}getAllMutationBatches(e){return rg.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let n=new oV(t,0),r=new oV(t,1/0),i=[];return this.gs.forEachInRange([n,r],e=>{let t=this.ys(e._s);i.push(t)}),rg.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new iE(n4);return t.forEach(e=>{let t=new oV(e,0),r=new oV(e,1/0);this.gs.forEachInRange([t,r],e=>{n=n.add(e._s)})}),rg.resolve(this.Is(n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,r=n.length+1,i=n;rr.isDocumentKey(i)||(i=i.child(""));let s=new oV(new rr(i),0),a=new iE(n4);return this.gs.forEachWhile(e=>{let t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(a=a.add(e._s)),!0)},s),rg.resolve(this.Is(a))}Is(e){let t=[];return e.forEach(e=>{let n=this.ys(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){0===this.Ts(t.batchId,"removed")||nz(),this.mutationQueue.shift();let n=this.gs;return rg.forEach(t.mutations,r=>{let i=new oV(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.gs=n})}An(e){}containsKey(e,t){let n=new oV(t,0),r=this.gs.firstAfterOrEqual(n);return rg.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,rg.resolve()}Ts(e,t){return this.ps(e)}ps(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}ys(e){let t=this.ps(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class oB{constructor(e){this.Es=e,this.docs=new ib(rr.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.Es(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let n=this.docs.get(t);return rg.resolve(n?n.document.mutableCopy():iC.newInvalidDocument(t))}getEntries(e,t){let n=sI;return t.forEach(e=>{let t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():iC.newInvalidDocument(e))}),rg.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=sI,s=t.path,a=new rr(s.child("")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){let{key:e,value:{document:a}}=o.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||0>=rd(rc(a),n)||(r.has(a.key)||iY(t,a))&&(i=i.insert(a.key,a.mutableCopy()))}return rg.resolve(i)}getAllFromCollectionGroup(e,t,n,r){nz()}As(e,t){return rg.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new oj(this)}getSize(e){return rg.resolve(this.size)}}class oj extends ok{constructor(e){super(),this.Yn=e}applyChanges(e){let t=[];return this.changes.forEach((n,r)=>{r.isValidDocument()?t.push(this.Yn.addEntry(e,r)):this.Yn.removeEntry(n)}),rg.waitFor(t)}getFromCache(e,t){return this.Yn.getEntry(e,t)}getAllFromCache(e,t){return this.Yn.getEntries(e,t)}}class o${constructor(e){this.persistence=e,this.Rs=new sb(e=>iR(e),ix),this.lastRemoteSnapshotVersion=n8.min(),this.highestTargetId=0,this.bs=0,this.Ps=new oU,this.targetCount=0,this.vs=om.Pn()}forEachTarget(e,t){return this.Rs.forEach((e,n)=>t(n)),rg.resolve()}getLastRemoteSnapshotVersion(e){return rg.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return rg.resolve(this.bs)}allocateTargetId(e){return this.highestTargetId=this.vs.next(),rg.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.bs&&(this.bs=t),rg.resolve()}Dn(e){this.Rs.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.vs=new om(t),this.highestTargetId=t),e.sequenceNumber>this.bs&&(this.bs=e.sequenceNumber)}addTargetData(e,t){return this.Dn(t),this.targetCount+=1,rg.resolve()}updateTargetData(e,t){return this.Dn(t),rg.resolve()}removeTargetData(e,t){return this.Rs.delete(t.target),this.Ps.ls(t.targetId),this.targetCount-=1,rg.resolve()}removeTargets(e,t,n){let r=0,i=[];return this.Rs.forEach((s,a)=>{a.sequenceNumber<=t&&null===n.get(a.targetId)&&(this.Rs.delete(s),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),r++)}),rg.waitFor(i).next(()=>r)}getTargetCount(e){return rg.resolve(this.targetCount)}getTargetData(e,t){let n=this.Rs.get(t)||null;return rg.resolve(n)}addMatchingKeys(e,t,n){return this.Ps.us(t,n),rg.resolve()}removeMatchingKeys(e,t,n){this.Ps.hs(t,n);let r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(t=>{i.push(r.markPotentiallyOrphaned(e,t))}),rg.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Ps.ls(t),rg.resolve()}getMatchingKeysForTargetId(e,t){let n=this.Ps.ds(t);return rg.resolve(n)}containsKey(e,t){return rg.resolve(this.Ps.containsKey(t))}}class oG{constructor(e,t){this.Vs={},this.overlays={},this.Ss=new rC(0),this.Ds=!1,this.Ds=!0,this.referenceDelegate=e(this),this.Cs=new o$(this),this.indexManager=new a9,this.remoteDocumentCache=new oB(e=>this.referenceDelegate.xs(e)),this.yt=new aC(t),this.Ns=new oM(this.yt)}start(){return Promise.resolve()}shutdown(){return this.Ds=!1,Promise.resolve()}get started(){return this.Ds}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new oF,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Vs[e.toKey()];return n||(n=new oq(t,this.referenceDelegate),this.Vs[e.toKey()]=n),n}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ns}runTransaction(e,t,n){nj("MemoryPersistence","Starting transaction:",e);let r=new oK(this.Ss.next());return this.referenceDelegate.ks(),n(r).next(e=>this.referenceDelegate.Os(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Ms(e,t){return rg.or(Object.values(this.Vs).map(n=>()=>n.containsKey(e,t)))}}class oK extends rp{constructor(e){super(),this.currentSequenceNumber=e}}class oz{constructor(e){this.persistence=e,this.Fs=new oU,this.$s=null}static Bs(e){return new oz(e)}get Ls(){if(this.$s)return this.$s;throw nz()}addReference(e,t,n){return this.Fs.addReference(n,t),this.Ls.delete(n.toString()),rg.resolve()}removeReference(e,t,n){return this.Fs.removeReference(n,t),this.Ls.add(n.toString()),rg.resolve()}markPotentiallyOrphaned(e,t){return this.Ls.add(t.toString()),rg.resolve()}removeTarget(e,t){this.Fs.ls(t.targetId).forEach(e=>this.Ls.add(e.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.Ls.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}ks(){this.$s=new Set}Os(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return rg.forEach(this.Ls,n=>{let r=rr.fromPath(n);return this.qs(e,r).next(e=>{e||t.removeEntry(r,n8.min())})}).next(()=>(this.$s=null,t.apply(e)))}updateLimboDocument(e,t){return this.qs(e,t).next(e=>{e?this.Ls.delete(t.toString()):this.Ls.add(t.toString())})}xs(e){return 0}qs(e,t){return rg.or([()=>rg.resolve(this.Fs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ms(e,t)])}}class oW{constructor(e){this.yt=e}$(e,t,n,r){let i=new ry("createOrUpgrade",t);n<1&&r>=1&&(e.createObjectStore("owner"),e.createObjectStore("mutationQueues",{keyPath:"userId"}),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",an,{unique:!0}),e.createObjectStore("documentMutations"),oH(e),e.createObjectStore("remoteDocuments"));let s=rg.resolve();return n<3&&r>=3&&(0!==n&&(e.deleteObjectStore("targetDocuments"),e.deleteObjectStore("targets"),e.deleteObjectStore("targetGlobal"),oH(e)),s=s.next(()=>(function(e){let t=e.store("targetGlobal"),n={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:n8.min().toTimestamp(),targetCount:0};return t.put("targetGlobalKey",n)})(i))),n<4&&r>=4&&(0!==n&&(s=s.next(()=>i.store("mutations").W().next(t=>{e.deleteObjectStore("mutations"),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",an,{unique:!0});let n=i.store("mutations"),r=t.map(e=>n.put(e));return rg.waitFor(r)}))),s=s.next(()=>{e.createObjectStore("clientMetadata",{keyPath:"clientId"})})),n<5&&r>=5&&(s=s.next(()=>this.Us(i))),n<6&&r>=6&&(s=s.next(()=>(e.createObjectStore("remoteDocumentGlobal"),this.Ks(i)))),n<7&&r>=7&&(s=s.next(()=>this.Gs(i))),n<8&&r>=8&&(s=s.next(()=>this.Qs(e,i))),n<9&&r>=9&&(s=s.next(()=>{e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")})),n<10&&r>=10&&(s=s.next(()=>this.js(i))),n<11&&r>=11&&(s=s.next(()=>{e.createObjectStore("bundles",{keyPath:"bundleId"}),e.createObjectStore("namedQueries",{keyPath:"name"})})),n<12&&r>=12&&(s=s.next(()=>{let t=e.createObjectStore("documentOverlays",{keyPath:am});t.createIndex("collectionPathOverlayIndex",ag,{unique:!1}),t.createIndex("collectionGroupOverlayIndex",ay,{unique:!1})})),n<13&&r>=13&&(s=s.next(()=>(function(e){let t=e.createObjectStore("remoteDocumentsV14",{keyPath:ai});t.createIndex("documentKeyIndex",as),t.createIndex("collectionGroupIndex",aa)})(e)).next(()=>this.Ws(e,i)).next(()=>e.deleteObjectStore("remoteDocuments"))),n<14&&r>=14&&(s=s.next(()=>this.zs(e,i))),n<15&&r>=15&&(s=s.next(()=>{e.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),e.createObjectStore("indexState",{keyPath:ah}).createIndex("sequenceNumberIndex",ad,{unique:!1}),e.createObjectStore("indexEntries",{keyPath:af}).createIndex("documentKeyIndex",ap,{unique:!1})})),s}Ks(e){let t=0;return e.store("remoteDocuments").Z((e,n)=>{t+=ou(n)}).next(()=>{let n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)})}Us(e){let t=e.store("mutationQueues"),n=e.store("mutations");return t.W().next(t=>rg.forEach(t,t=>{let r=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return n.W("userMutationsIndex",r).next(n=>rg.forEach(n,n=>{n.userId===t.userId||nz();let r=aO(this.yt,n);return ol(e,t.userId,r).next(()=>{})}))}))}Gs(e){let t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(e=>{let r=[];return n.Z((n,i)=>{let s=new re(n),a=[0,ae(s)];r.push(t.get(a).next(n=>n?rg.resolve():t.put({targetId:0,path:ae(s),sequenceNumber:e.highestListenSequenceNumber})))}).next(()=>rg.waitFor(r))})}Qs(e,t){e.createObjectStore("collectionParents",{keyPath:ac});let n=t.store("collectionParents"),r=new a8,i=e=>{if(r.add(e)){let t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:ae(r)})}};return t.store("remoteDocuments").Z({X:!0},(e,t)=>i(new re(e).popLast())).next(()=>t.store("documentMutations").Z({X:!0},([e,t,n],r)=>i(at(t).popLast())))}js(e){let t=e.store("targets");return t.Z((e,n)=>{let r=aP(n),i=aL(this.yt,r);return t.put(i)})}Ws(e,t){let n=t.store("remoteDocuments"),r=[];return n.Z((e,n)=>{let i=t.store("remoteDocumentsV14"),s=(n.document?new rr(re.fromString(n.document.name).popFirst(5)):n.noDocument?rr.fromSegments(n.noDocument.path):n.unknownDocument?rr.fromSegments(n.unknownDocument.path):nz()).path.toArray(),a={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};r.push(i.put(a))}).next(()=>rg.waitFor(r))}zs(e,t){let n=t.store("mutations"),r=new oA(this.yt),i=new oG(oz.Bs,this.yt.ie);return n.W().next(e=>{let n=new Map;return e.forEach(e=>{var t;let r=null!=(t=n.get(e.userId))?t:sC();aO(this.yt,e).keys().forEach(e=>r=r.add(e)),n.set(e.userId,r)}),rg.forEach(n,(e,n)=>{let s=new nU(n),a=a$.re(this.yt,s),o=i.getIndexManager(s);return new oL(r,oc.re(s,this.yt,o,i.referenceDelegate),a,o).recalculateAndSaveOverlaysForDocumentKeys(new a_(t,rC.at),e).next()})})}}function oH(e){e.createObjectStore("targetDocuments",{keyPath:al}).createIndex("documentTargetsIndex",au,{unique:!0}),e.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",ao,{unique:!0}),e.createObjectStore("targetGlobal")}let oQ="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class oY{constructor(e,t,n,r,i,s,a,o,l,u,c=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.Hs=i,this.window=s,this.document=a,this.Js=l,this.Ys=u,this.Xs=c,this.Ss=null,this.Ds=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Zs=null,this.inForeground=!1,this.ti=null,this.ei=null,this.ni=-1/0,this.si=e=>Promise.resolve(),!oY.C())throw new nH(nW.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new oT(this,r),this.ii=t+"main",this.yt=new aC(o),this.ri=new rv(this.ii,this.Xs,new oW(this.yt)),this.Cs=new og(this.referenceDelegate,this.yt),this.remoteDocumentCache=new oA(this.yt),this.Ns=new aq,this.window&&this.window.localStorage?this.oi=this.window.localStorage:(this.oi=null,!1===u&&n$("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.ui().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new nH(nW.FAILED_PRECONDITION,oQ);return this.ci(),this.ai(),this.hi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Cs.getHighestSequenceNumber(e))}).then(e=>{this.Ss=new rC(e,this.Js)}).then(()=>{this.Ds=!0}).catch(e=>(this.ri&&this.ri.close(),Promise.reject(e)))}li(e){return this.si=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.ri.L(async t=>{null===t.newVersion&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Hs.enqueueAndForget(async()=>{this.started&&await this.ui()}))}ui(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>oJ(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.fi(e).next(e=>{e||(this.isPrimary=!1,this.Hs.enqueueRetryable(()=>this.si(!1)))})}).next(()=>this.di(e)).next(t=>this.isPrimary&&!t?this._i(e).next(()=>!1):!!t&&this.wi(e).next(()=>!0))).catch(e=>{if(rI(e))return nj("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return nj("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Hs.enqueueRetryable(()=>this.si(e)),this.isPrimary=e})}fi(e){return oX(e).get("owner").next(e=>rg.resolve(this.mi(e)))}gi(e){return oJ(e).delete(this.clientId)}async yi(){if(this.isPrimary&&!this.pi(this.ni,18e5)){this.ni=Date.now();let e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let t=aE(e,"clientMetadata");return t.W().next(e=>{let n=this.Ii(e,18e5),r=e.filter(e=>-1===n.indexOf(e));return rg.forEach(r,e=>t.delete(e.clientId)).next(()=>r)})}).catch(()=>[]);if(this.oi)for(let t of e)this.oi.removeItem(this.Ti(t.clientId))}}hi(){this.ei=this.Hs.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.ui().then(()=>this.yi()).then(()=>this.hi()))}mi(e){return!!e&&e.ownerId===this.clientId}di(e){return this.Ys?rg.resolve(!0):oX(e).get("owner").next(t=>{if(null!==t&&this.pi(t.leaseTimestampMs,5e3)&&!this.Ei(t.ownerId)){if(this.mi(t)&&this.networkEnabled)return!0;if(!this.mi(t)){if(!t.allowTabSynchronization)throw new nH(nW.FAILED_PRECONDITION,oQ);return!1}}return!(!this.networkEnabled||!this.inForeground)||oJ(e).W().next(e=>void 0===this.Ii(e,5e3).find(e=>{if(this.clientId!==e.clientId){let t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&nj("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.Ds=!1,this.Ai(),this.ei&&(this.ei.cancel(),this.ei=null),this.Ri(),this.bi(),await this.ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{let t=new a_(e,rC.at);return this._i(t).next(()=>this.gi(t))}),this.ri.close(),this.Pi()}Ii(e,t){return e.filter(e=>this.pi(e.updateTimeMs,t)&&!this.Ei(e.clientId))}vi(){return this.runTransaction("getActiveClients","readonly",e=>oJ(e).W().next(e=>this.Ii(e,18e5).map(e=>e.clientId)))}get started(){return this.Ds}getMutationQueue(e,t){return oc.re(e,this.yt,t,this.referenceDelegate)}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new oe(e,this.yt.ie.databaseId)}getDocumentOverlayCache(e){return a$.re(this.yt,e)}getBundleCache(){return this.Ns}runTransaction(e,t,n){var r;let i;nj("IndexedDbPersistence","Starting transaction:",e);let s=15===(r=this.Xs)?aI:14===r||13===r?ab:12===r?aw:11===r?av:void nz();return this.ri.runTransaction(e,"readonly"===t?"readonly":"readwrite",s,r=>(i=new a_(r,this.Ss?this.Ss.next():rC.at),"readwrite-primary"===t?this.fi(i).next(e=>!!e||this.di(i)).next(t=>{if(!t)throw n$(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Hs.enqueueRetryable(()=>this.si(!1)),new nH(nW.FAILED_PRECONDITION,rf);return n(i)}).next(e=>this.wi(i).next(()=>e)):this.Vi(i).next(()=>n(i)))).then(e=>(i.raiseOnCommittedEvent(),e))}Vi(e){return oX(e).get("owner").next(e=>{if(null!==e&&this.pi(e.leaseTimestampMs,5e3)&&!this.Ei(e.ownerId)&&!this.mi(e)&&!(this.Ys||this.allowTabSynchronization&&e.allowTabSynchronization))throw new nH(nW.FAILED_PRECONDITION,oQ)})}wi(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return oX(e).put("owner",t)}static C(){return rv.C()}_i(e){let t=oX(e);return t.get("owner").next(e=>this.mi(e)?(nj("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):rg.resolve())}pi(e,t){let n=Date.now();return!(e<n-t)&&(!(e>n)||(n$(`Detected an update time that is in the future: ${e} > ${n}`),!1))}ci(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ti=()=>{this.Hs.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.ui()))},this.document.addEventListener("visibilitychange",this.ti),this.inForeground="visible"===this.document.visibilityState)}Ri(){this.ti&&(this.document.removeEventListener("visibilitychange",this.ti),this.ti=null)}ai(){var e;"function"==typeof(null==(e=this.window)?void 0:e.addEventListener)&&(this.Zs=()=>{this.Ai(),(0,y.G6)()&&navigator.appVersion.match(/Version\/1[45]/)&&this.Hs.enterRestrictedMode(!0),this.Hs.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Zs))}bi(){this.Zs&&(this.window.removeEventListener("pagehide",this.Zs),this.Zs=null)}Ei(e){var t;try{let n=null!==(null==(t=this.oi)?void 0:t.getItem(this.Ti(e)));return nj("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return n$("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}Ai(){if(this.oi)try{this.oi.setItem(this.Ti(this.clientId),String(Date.now()))}catch(e){n$("Failed to set zombie client id.",e)}}Pi(){if(this.oi)try{this.oi.removeItem(this.Ti(this.clientId))}catch(e){}}Ti(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function oX(e){return aE(e,"owner")}function oJ(e){return aE(e,"clientMetadata")}function oZ(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class o0{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Si=n,this.Di=r}static Ci(e,t){let n=sC(),r=sC();for(let e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new o0(e,t.fromCache,n,r)}}class o1{constructor(){this.xi=!1}initialize(e,t){this.Ni=e,this.indexManager=t,this.xi=!0}getDocumentsMatchingQuery(e,t,n,r){return this.ki(e,t).next(i=>i||this.Oi(e,t,r,n)).next(n=>n||this.Mi(e,t))}ki(e,t){if(iV(t))return rg.resolve(null);let n=iG(t);return this.indexManager.getIndexType(e,n).next(r=>0===r?null:(null!==t.limit&&1===r&&(n=iG(t=iz(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,n).next(r=>{let i=sC(...r);return this.Ni.getDocuments(e,i).next(r=>this.indexManager.getMinOffset(e,n).next(n=>{let s=this.Fi(t,r);return this.$i(t,s,i,n.readTime)?this.ki(e,iz(t,null,"F")):this.Bi(e,s,t,n)}))})))}Oi(e,t,n,r){return iV(t)||r.isEqual(n8.min())?this.Mi(e,t):this.Ni.getDocuments(e,n).next(i=>{let s=this.Fi(t,i);return this.$i(t,s,n,r)?this.Mi(e,t):(nB()<=g.in.DEBUG&&nj("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),iQ(t)),this.Bi(e,s,t,ru(r,-1)))})}Fi(e,t){let n=new iE(iJ(e));return t.forEach((t,r)=>{iY(e,r)&&(n=n.add(r))}),n}$i(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;let i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Mi(e,t){return nB()<=g.in.DEBUG&&nj("QueryEngine","Using full collection scan to execute query:",iQ(t)),this.Ni.getDocumentsMatchingQuery(e,t,rh.min())}Bi(e,t,n,r){return this.Ni.getDocumentsMatchingQuery(e,n,r).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}class o2{constructor(e,t,n,r){this.persistence=e,this.Li=t,this.yt=r,this.qi=new ib(n4),this.Ui=new sb(e=>iR(e),ix),this.Ki=new Map,this.Gi=e.getRemoteDocumentCache(),this.Cs=e.getTargetCache(),this.Ns=e.getBundleCache(),this.Qi(n)}Qi(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new oL(this.Gi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Gi.setIndexManager(this.indexManager),this.Li.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.qi))}}async function o3(e,t){return await e.persistence.runTransaction("Handle user change","readonly",n=>{let r;return e.mutationQueue.getAllMutationBatches(n).next(i=>(r=i,e.Qi(t),e.mutationQueue.getAllMutationBatches(n))).next(t=>{let i=[],s=[],a=sC();for(let e of r)for(let t of(i.push(e.batchId),e.mutations))a=a.add(t.key);for(let e of t)for(let t of(s.push(e.batchId),e.mutations))a=a.add(t.key);return e.localDocuments.getDocuments(n,a).next(e=>({ji:e,removedBatchIds:i,addedBatchIds:s}))})})}function o6(e){return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Cs.getLastRemoteSnapshotVersion(t))}function o4(e,t,n){let r=sC(),i=sC();return n.forEach(e=>r=r.add(e)),t.getEntries(e,r).next(e=>{let r=sI;return n.forEach((n,s)=>{let a=e.get(n);s.isFoundDocument()!==a.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(n8.min())?(t.removeEntry(n,s.readTime),r=r.insert(n,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(s),r=r.insert(n,s)):nj("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",s.version)}),{Wi:r,zi:i}})}function o5(e,t){return e.persistence.runTransaction("Allocate target","readwrite",n=>{let r;return e.Cs.getTargetData(n,t).next(i=>i?(r=i,rg.resolve(r)):e.Cs.allocateTargetId(n).next(i=>(r=new aA(t,i,0,n.currentSequenceNumber),e.Cs.addTargetData(n,r).next(()=>r))))}).then(n=>{let r=e.qi.get(n.targetId);return(null===r||n.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(e.qi=e.qi.insert(n.targetId,n),e.Ui.set(t,n.targetId)),n})}async function o9(e,t,n){let r=e.qi.get(t);try{n||await e.persistence.runTransaction("Release target",n?"readwrite":"readwrite-primary",t=>e.persistence.referenceDelegate.removeTarget(t,r))}catch(e){if(!rI(e))throw e;nj("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}e.qi=e.qi.remove(t),e.Ui.delete(r.target)}function o8(e,t,n){let r=n8.min(),i=sC();return e.persistence.runTransaction("Execute query","readonly",s=>(function(e,t,n){let r=e.Ui.get(n);return void 0!==r?rg.resolve(e.qi.get(r)):e.Cs.getTargetData(t,n)})(e,s,iG(t)).next(t=>{if(t)return r=t.lastLimboFreeSnapshotVersion,e.Cs.getMatchingKeysForTargetId(s,t.targetId).next(e=>{i=e})}).next(()=>e.Li.getDocumentsMatchingQuery(s,t,n?r:n8.min(),n?i:sC())).next(n=>(lt(e,iX(t),n),{documents:n,Hi:i})))}function o7(e,t){let n=e.Cs,r=e.qi.get(t);return r?Promise.resolve(r.target):e.persistence.runTransaction("Get target data","readonly",e=>n.ne(e,t).next(e=>e?e.target:null))}function le(e,t){let n=e.Ki.get(t)||n8.min();return e.persistence.runTransaction("Get new document changes","readonly",r=>e.Gi.getAllFromCollectionGroup(r,t,ru(n,-1),Number.MAX_SAFE_INTEGER)).then(n=>(lt(e,t,n),n))}function lt(e,t,n){let r=e.Ki.get(t)||n8.min();n.forEach((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)}),e.Ki.set(t,r)}async function ln(e,t,n,r){let i=sC(),s=sI;for(let e of n){let n=t.Ji(e.metadata.name);e.document&&(i=i.add(n));let r=t.Yi(e);r.setReadTime(t.Xi(e.metadata.readTime)),s=s.insert(n,r)}let a=e.Gi.newChangeBuffer({trackRemovals:!0}),o=await o5(e,iG(iU(re.fromString(`__bundle__/docs/${r}`))));return e.persistence.runTransaction("Apply bundle documents","readwrite",t=>o4(t,a,s).next(e=>(a.apply(t),e)).next(n=>e.Cs.removeMatchingKeysForTargetId(t,o.targetId).next(()=>e.Cs.addMatchingKeys(t,i,o.targetId)).next(()=>e.localDocuments.getLocalViewOfDocuments(t,n.Wi,n.zi)).next(()=>n.Wi)))}async function lr(e,t,n=sC()){let r=await o5(e,iG(aM(t.bundledQuery)));return e.persistence.runTransaction("Save named query","readwrite",i=>{let s=sK(t.readTime);if(r.snapshotVersion.compareTo(s)>=0)return e.Ns.saveNamedQuery(i,t);let a=r.withResumeToken(rF.EMPTY_BYTE_STRING,s);return e.qi=e.qi.insert(a.targetId,a),e.Cs.updateTargetData(i,a).next(()=>e.Cs.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>e.Cs.addMatchingKeys(i,n,r.targetId)).next(()=>e.Ns.saveNamedQuery(i,t))})}function li(e,t){return`firestore_clients_${e}_${t}`}function ls(e,t,n){let r=`firestore_mutations_${e}_${n}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}function la(e,t){return`firestore_targets_${e}_${t}`}class lo{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static Zi(e,t,n){let r=JSON.parse(n),i,s="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(i=new nH(r.error.code,r.error.message)),s?new lo(e,t,r.state,i):(n$("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}tr(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class ll{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Zi(e,t){let n=JSON.parse(t),r,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(r=new nH(n.error.code,n.error.message)),i?new ll(e,n.state,r):(n$("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}tr(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class lu{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Zi(e,t){let n=JSON.parse(t),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=sD;for(let e=0;r&&e<n.activeTargetIds.length;++e)r=rM(n.activeTargetIds[e]),i=i.add(n.activeTargetIds[e]);return r?new lu(e,i):(n$("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class lc{constructor(e,t){this.clientId=e,this.onlineState=t}static Zi(e){let t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new lc(t.clientId,t.onlineState):(n$("SharedClientState",`Failed to parse online state: ${e}`),null)}}class lh{constructor(){this.activeTargetIds=sD}er(e){this.activeTargetIds=this.activeTargetIds.add(e)}nr(e){this.activeTargetIds=this.activeTargetIds.delete(e)}tr(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class ld{constructor(e,t,n,r,i){var s,a,o;this.window=e,this.Hs=t,this.persistenceKey=n,this.sr=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ir=this.rr.bind(this),this.ur=new ib(n4),this.started=!1,this.cr=[];let l=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.ar=li(this.persistenceKey,this.sr),this.hr=(s=this.persistenceKey,`firestore_sequence_number_${s}`),this.ur=this.ur.insert(this.sr,new lh),this.lr=RegExp(`^firestore_clients_${l}_([^_]*)$`),this.dr=RegExp(`^firestore_mutations_${l}_(\\d+)(?:_(.*))?$`),this._r=RegExp(`^firestore_targets_${l}_(\\d+)$`),this.wr=(a=this.persistenceKey,`firestore_online_state_${a}`),this.mr=(o=this.persistenceKey,`firestore_bundle_loaded_v2_${o}`),this.window.addEventListener("storage",this.ir)}static C(e){return!(!e||!e.localStorage)}async start(){for(let e of(await this.syncEngine.vi())){if(e===this.sr)continue;let t=this.getItem(li(this.persistenceKey,e));if(t){let n=lu.Zi(e,t);n&&(this.ur=this.ur.insert(n.clientId,n))}}this.gr();let e=this.storage.getItem(this.wr);if(e){let t=this.yr(e);t&&this.pr(t)}for(let e of this.cr)this.rr(e);this.cr=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.hr,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Ir(this.ur)}isActiveQueryTarget(e){let t=!1;return this.ur.forEach((n,r)=>{r.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Tr(e,"pending")}updateMutationState(e,t,n){this.Tr(e,t,n),this.Er(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){let n=this.storage.getItem(la(this.persistenceKey,e));if(n){let r=ll.Zi(e,n);r&&(t=r.state)}}return this.Ar.er(e),this.gr(),t}removeLocalQueryTarget(e){this.Ar.nr(e),this.gr()}isLocalQueryTarget(e){return this.Ar.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(la(this.persistenceKey,e))}updateQueryState(e,t,n){this.Rr(e,t,n)}handleUserChange(e,t,n){t.forEach(e=>{this.Er(e)}),this.currentUser=e,n.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.br(e)}notifyBundleLoaded(e){this.Pr(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ir),this.removeItem(this.ar),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return nj("SharedClientState","READ",e,t),t}setItem(e,t){nj("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){nj("SharedClientState","REMOVE",e),this.storage.removeItem(e)}rr(e){if(e.storageArea===this.storage){if(nj("SharedClientState","EVENT",e.key,e.newValue),e.key===this.ar)return void n$("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Hs.enqueueRetryable(async()=>{if(this.started){if(null!==e.key){if(this.lr.test(e.key)){if(null==e.newValue){let t=this.vr(e.key);return this.Vr(t,null)}{let t=this.Sr(e.key,e.newValue);if(t)return this.Vr(t.clientId,t)}}else if(this.dr.test(e.key)){if(null!==e.newValue){let t=this.Dr(e.key,e.newValue);if(t)return this.Cr(t)}}else if(this._r.test(e.key)){if(null!==e.newValue){let t=this.Nr(e.key,e.newValue);if(t)return this.kr(t)}}else if(e.key===this.wr){if(null!==e.newValue){let t=this.yr(e.newValue);if(t)return this.pr(t)}}else if(e.key===this.hr){let t=function(e){let t=rC.at;if(null!=e)try{let n=JSON.parse(e);"number"==typeof n||nz(),t=n}catch(e){n$("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(e.newValue);t!==rC.at&&this.sequenceNumberHandler(t)}else if(e.key===this.mr){let t=this.Or(e.newValue);await Promise.all(t.map(e=>this.syncEngine.Mr(e)))}}}else this.cr.push(e)})}}get Ar(){return this.ur.get(this.sr)}gr(){this.setItem(this.ar,this.Ar.tr())}Tr(e,t,n){let r=new lo(this.currentUser,e,t,n),i=ls(this.persistenceKey,this.currentUser,e);this.setItem(i,r.tr())}Er(e){let t=ls(this.persistenceKey,this.currentUser,e);this.removeItem(t)}br(e){let t={clientId:this.sr,onlineState:e};this.storage.setItem(this.wr,JSON.stringify(t))}Rr(e,t,n){let r=la(this.persistenceKey,e),i=new ll(e,t,n);this.setItem(r,i.tr())}Pr(e){let t=JSON.stringify(Array.from(e));this.setItem(this.mr,t)}vr(e){let t=this.lr.exec(e);return t?t[1]:null}Sr(e,t){let n=this.vr(e);return lu.Zi(n,t)}Dr(e,t){let n=this.dr.exec(e),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return lo.Zi(new nU(i),r,t)}Nr(e,t){let n=Number(this._r.exec(e)[1]);return ll.Zi(n,t)}yr(e){return lc.Zi(e)}Or(e){return JSON.parse(e)}async Cr(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Fr(e.batchId,e.state,e.error);nj("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}kr(e){return this.syncEngine.$r(e.targetId,e.state,e.error)}Vr(e,t){let n=t?this.ur.insert(e,t):this.ur.remove(e),r=this.Ir(this.ur),i=this.Ir(n),s=[],a=[];return i.forEach(e=>{r.has(e)||s.push(e)}),r.forEach(e=>{i.has(e)||a.push(e)}),this.syncEngine.Br(s,a).then(()=>{this.ur=n})}pr(e){this.ur.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Ir(e){let t=sD;return e.forEach((e,n)=>{t=t.unionWith(n.activeTargetIds)}),t}}class lf{constructor(){this.Lr=new lh,this.qr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.Lr.er(e),this.qr[e]||"not-current"}updateQueryState(e,t,n){this.qr[e]=t}removeLocalQueryTarget(e){this.Lr.nr(e)}isLocalQueryTarget(e){return this.Lr.activeTargetIds.has(e)}clearQueryState(e){delete this.qr[e]}getAllActiveQueryTargets(){return this.Lr.activeTargetIds}isActiveQueryTarget(e){return this.Lr.activeTargetIds.has(e)}start(){return this.Lr=new lh,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class lp{Ur(e){}shutdown(){}}class lm{constructor(){this.Kr=()=>this.Gr(),this.Qr=()=>this.jr(),this.Wr=[],this.zr()}Ur(e){this.Wr.push(e)}shutdown(){window.removeEventListener("online",this.Kr),window.removeEventListener("offline",this.Qr)}zr(){window.addEventListener("online",this.Kr),window.addEventListener("offline",this.Qr)}Gr(){for(let e of(nj("ConnectivityMonitor","Network connectivity changed: AVAILABLE"),this.Wr))e(0)}jr(){for(let e of(nj("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE"),this.Wr))e(1)}static C(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let lg={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class ly{constructor(e){this.Hr=e.Hr,this.Jr=e.Jr}Yr(e){this.Xr=e}Zr(e){this.eo=e}onMessage(e){this.no=e}close(){this.Jr()}send(e){this.Hr(e)}so(){this.Xr()}io(e){this.eo(e)}ro(e){this.no(e)}}class lv extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let t=e.ssl?"https":"http";this.oo=t+"://"+e.host,this.uo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get co(){return!1}ao(e,t,n,r,i){let s=this.ho(e,t);nj("RestConnection","Sending: ",s,n);let a={};return this.lo(a,r,i),this.fo(e,s,a,n).then(e=>(nj("RestConnection","Received: ",e),e),t=>{throw nG("RestConnection",`${e} failed with error: `,t,"url: ",s,"request:",n),t})}_o(e,t,n,r,i,s){return this.ao(e,t,n,r,i)}lo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+nV,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}ho(e,t){let n=lg[e];return`${this.oo}/v1/${t}:${n}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}fo(e,t,n,r){return new Promise((i,s)=>{let a=new nM;a.setWithCredentials(!0),a.listenOnce(nR.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case nN.NO_ERROR:let t=a.getResponseJson();nj("Connection","XHR received:",JSON.stringify(t)),i(t);break;case nN.TIMEOUT:nj("Connection",'RPC "'+e+'" timed out'),s(new nH(nW.DEADLINE_EXCEEDED,"Request time out"));break;case nN.HTTP_ERROR:let n=a.getStatus();if(nj("Connection",'RPC "'+e+'" failed with status:',n,"response text:",a.getResponseText()),n>0){let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);let t=null==e?void 0:e.error;if(t&&t.status&&t.message){let e=function(e){let t=e.toLowerCase().replace(/_/g,"-");return Object.values(nW).indexOf(t)>=0?t:nW.UNKNOWN}(t.status);s(new nH(e,t.message))}else s(new nH(nW.UNKNOWN,"Server responded with status "+a.getStatus()))}else s(new nH(nW.UNAVAILABLE,"Connection failed."));break;default:nz()}}finally{nj("Connection",'RPC "'+e+'" completed.')}});let o=JSON.stringify(r);a.send(t,"POST",o,n,15)})}wo(e,t,n){let r=[this.oo,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=nC(),s=nD(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(a.xmlHttpFactory=new nP({})),this.lo(a.initMessageHeaders,t,n),a.encodeInitMessageHeaders=!0;let o=r.join("");nj("Connection","Creating WebChannel: "+o,a);let l=i.createWebChannel(o,a),u=!1,h=!1,d=new ly({Hr:e=>{h?nj("Connection","Not sending because WebChannel is closed:",e):(u||(nj("Connection","Opening WebChannel transport."),l.open(),u=!0),nj("Connection","WebChannel sending:",e),l.send(e))},Jr:()=>l.close()}),f=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return f(l,nL.EventType.OPEN,()=>{h||nj("Connection","WebChannel transport opened.")}),f(l,nL.EventType.CLOSE,()=>{h||(h=!0,nj("Connection","WebChannel transport closed"),d.io())}),f(l,nL.EventType.ERROR,e=>{h||(h=!0,nG("Connection","WebChannel transport errored:",e),d.io(new nH(nW.UNAVAILABLE,"The operation could not be completed")))}),f(l,nL.EventType.MESSAGE,e=>{var t;if(!h){let n=e.data[0];n||nz();let r=n.error||(null==(t=n[0])?void 0:t.error);if(r){nj("Connection","WebChannel received error:",r);let e=r.status,t=function(e){let t=c[e];if(void 0!==t)return sw(t)}(e),n=r.message;void 0===t&&(t=nW.INTERNAL,n="Unknown error status: "+e+" with message "+r.message),h=!0,d.io(new nH(t,n)),l.close()}else nj("Connection","WebChannel received:",n),d.ro(n)}}),f(s,nx.STAT_EVENT,e=>{e.stat===nO.PROXY?nj("Connection","Detected buffering proxy"):e.stat===nO.NOPROXY&&nj("Connection","Detected no buffering proxy")}),setTimeout(()=>{d.so()},0),d}}function lw(){return"undefined"!=typeof window?window:null}function lb(){return"undefined"!=typeof document?document:null}function lI(e){return new sj(e,!0)}class l_{constructor(e,t,n=1e3,r=1.5,i=6e4){this.Hs=e,this.timerId=t,this.mo=n,this.yo=r,this.po=i,this.Io=0,this.To=null,this.Eo=Date.now(),this.reset()}reset(){this.Io=0}Ao(){this.Io=this.po}Ro(e){this.cancel();let t=Math.floor(this.Io+this.bo()),n=Math.max(0,Date.now()-this.Eo),r=Math.max(0,t-n);r>0&&nj("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Io} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.To=this.Hs.enqueueAfterDelay(this.timerId,r,()=>(this.Eo=Date.now(),e())),this.Io*=this.yo,this.Io<this.mo&&(this.Io=this.mo),this.Io>this.po&&(this.Io=this.po)}Po(){null!==this.To&&(this.To.skipDelay(),this.To=null)}cancel(){null!==this.To&&(this.To.cancel(),this.To=null)}bo(){return(Math.random()-.5)*this.Io}}class lE{constructor(e,t,n,r,i,s,a,o){this.Hs=e,this.vo=n,this.Vo=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.So=0,this.Do=null,this.Co=null,this.stream=null,this.xo=new l_(e,t)}No(){return 1===this.state||5===this.state||this.ko()}ko(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Oo()}async stop(){this.No()&&await this.close(0)}Mo(){this.state=0,this.xo.reset()}Fo(){this.ko()&&null===this.Do&&(this.Do=this.Hs.enqueueAfterDelay(this.vo,6e4,()=>this.$o()))}Bo(e){this.Lo(),this.stream.send(e)}async $o(){if(this.ko())return this.close(0)}Lo(){this.Do&&(this.Do.cancel(),this.Do=null)}qo(){this.Co&&(this.Co.cancel(),this.Co=null)}async close(e,t){this.Lo(),this.qo(),this.xo.cancel(),this.So++,4!==e?this.xo.reset():t&&t.code===nW.RESOURCE_EXHAUSTED?(n$(t.toString()),n$("Using maximum backoff delay to prevent overloading the backend."),this.xo.Ao()):t&&t.code===nW.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Uo(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Zr(t)}Uo(){}auth(){this.state=1;let e=this.Ko(this.So),t=this.So;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,n])=>{this.So===t&&this.Go(e,n)},t=>{e(()=>{let e=new nH(nW.UNKNOWN,"Fetching auth token failed: "+t.message);return this.Qo(e)})})}Go(e,t){let n=this.Ko(this.So);this.stream=this.jo(e,t),this.stream.Yr(()=>{n(()=>(this.state=2,this.Co=this.Hs.enqueueAfterDelay(this.Vo,1e4,()=>(this.ko()&&(this.state=3),Promise.resolve())),this.listener.Yr()))}),this.stream.Zr(e=>{n(()=>this.Qo(e))}),this.stream.onMessage(e=>{n(()=>this.onMessage(e))})}Oo(){this.state=5,this.xo.Ro(async()=>{this.state=0,this.start()})}Qo(e){return nj("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Ko(e){return t=>{this.Hs.enqueueAndForget(()=>this.So===e?t():(nj("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class lT extends lE{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.yt=i}jo(e,t){return this.connection.wo("Listen",e,t)}onMessage(e){this.xo.reset();let t=function(e,t){let n;if("targetChange"in t){var r,i;t.targetChange;let s="NO_CHANGE"===(r=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===r?1:"REMOVE"===r?2:"CURRENT"===r?3:"RESET"===r?4:nz(),a=t.targetChange.targetIds||[],o=(i=t.targetChange.resumeToken,e.wt?(void 0===i||"string"==typeof i||nz(),rF.fromBase64String(i||"")):(void 0===i||i instanceof Uint8Array||nz(),rF.fromUint8Array(i||new Uint8Array))),l=t.targetChange.cause;n=new sP(s,a,o,l&&new nH(void 0===l.code?nW.UNKNOWN:sw(l.code),l.message||"")||null)}else if("documentChange"in t){t.documentChange;let r=t.documentChange;r.document,r.document.name,r.document.updateTime;let i=sQ(e,r.document.name),s=sK(r.document.updateTime),a=r.document.createTime?sK(r.document.createTime):n8.min(),o=new iA({mapValue:{fields:r.document.fields}}),l=iC.newFoundDocument(i,s,a,o);n=new sx(r.targetIds||[],r.removedTargetIds||[],l.key,l)}else if("documentDelete"in t){t.documentDelete;let r=t.documentDelete;r.document;let i=sQ(e,r.document),s=r.readTime?sK(r.readTime):n8.min(),a=iC.newNoDocument(i,s);n=new sx([],r.removedTargetIds||[],a.key,a)}else if("documentRemove"in t){t.documentRemove;let r=t.documentRemove;r.document;let i=sQ(e,r.document);n=new sx([],r.removedTargetIds||[],i,null)}else{if(!("filter"in t))return nz();{t.filter;let e=t.filter;e.targetId;let r=new sy(e.count||0);n=new sO(e.targetId,r)}}return n}(this.yt,e),n=function(e){if(!("targetChange"in e))return n8.min();let t=e.targetChange;return t.targetIds&&t.targetIds.length?n8.min():t.readTime?sK(t.readTime):n8.min()}(e);return this.listener.Wo(t,n)}zo(e){let t={};t.database=sJ(this.yt),t.addTarget=function(e,t){let n,r=t.target;return(n=iO(r)?{documents:s6(e,r)}:{query:s4(e,r)}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0?n.resumeToken=sG(e,t.resumeToken):t.snapshotVersion.compareTo(n8.min())>0&&(n.readTime=s$(e,t.snapshotVersion.toTimestamp())),n}(this.yt,e);let n=function(e,t){let n=function(e,t){switch(t){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return nz()}}(0,t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.yt,e);n&&(t.labels=n),this.Bo(t)}Ho(e){let t={};t.database=sJ(this.yt),t.removeTarget=e,this.Bo(t)}}class lS extends lE{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.yt=i,this.Jo=!1}get Yo(){return this.Jo}start(){this.Jo=!1,this.lastStreamToken=void 0,super.start()}Uo(){this.Jo&&this.Xo([])}jo(e,t){return this.connection.wo("Write",e,t)}onMessage(e){var t,n;if(e.streamToken||nz(),this.lastStreamToken=e.streamToken,this.Jo){this.xo.reset();let r=(t=e.writeResults,n=e.commitTime,t&&t.length>0?(void 0!==n||nz(),t.map(e=>{let t;return(t=e.updateTime?sK(e.updateTime):sK(n)).isEqual(n8.min())&&(t=sK(n)),new sr(t,e.transformResults||[])})):[]),i=sK(e.commitTime);return this.listener.Zo(i,r)}return e.writeResults&&0!==e.writeResults.length&&nz(),this.Jo=!0,this.listener.tu()}eu(){let e={};e.database=sJ(this.yt),this.Bo(e)}Xo(e){let t={streamToken:this.lastStreamToken,writes:e.map(e=>s2(this.yt,e))};this.Bo(t)}}class lk extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.yt=r,this.nu=!1}su(){if(this.nu)throw new nH(nW.FAILED_PRECONDITION,"The client has already been terminated.")}ao(e,t,n){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,i])=>this.connection.ao(e,t,n,r,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===nW.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new nH(nW.UNKNOWN,e.toString())})}_o(e,t,n,r){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection._o(e,t,n,i,s,r)).catch(e=>{throw"FirebaseError"===e.name?(e.code===nW.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new nH(nW.UNKNOWN,e.toString())})}terminate(){this.nu=!0}}class lA{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.iu=0,this.ru=null,this.ou=!0}uu(){0===this.iu&&(this.cu("Unknown"),this.ru=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.ru=null,this.au("Backend didn't respond within 10 seconds."),this.cu("Offline"),Promise.resolve())))}hu(e){"Online"===this.state?this.cu("Unknown"):(this.iu++,this.iu>=1&&(this.lu(),this.au(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.cu("Offline")))}set(e){this.lu(),this.iu=0,"Online"===e&&(this.ou=!1),this.cu(e)}cu(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}au(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ou?(n$(t),this.ou=!1):nj("OnlineStateTracker",t)}lu(){null!==this.ru&&(this.ru.cancel(),this.ru=null)}}class lC{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.fu=[],this.du=new Map,this._u=new Set,this.wu=[],this.mu=i,this.mu.Ur(e=>{n.enqueueAndForget(async()=>{lF(this)&&(nj("RemoteStore","Restarting streams for network reachability change."),await async function(e){e._u.add(4),await lN(e),e.gu.set("Unknown"),e._u.delete(4),await lD(e)}(this))})}),this.gu=new lA(n,r)}}async function lD(e){if(lF(e))for(let t of e.wu)await t(!0)}async function lN(e){for(let t of e.wu)await t(!1)}function lR(e,t){e.du.has(t.targetId)||(e.du.set(t.targetId,t),lM(e)?lL(e):lJ(e).ko()&&lO(e,t))}function lx(e,t){let n=lJ(e);e.du.delete(t),n.ko()&&lP(e,t),0===e.du.size&&(n.ko()?n.Fo():lF(e)&&e.gu.set("Unknown"))}function lO(e,t){e.yu.Ot(t.targetId),lJ(e).zo(t)}function lP(e,t){e.yu.Ot(t),lJ(e).Ho(t)}function lL(e){e.yu=new sM({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),ne:t=>e.du.get(t)||null}),lJ(e).start(),e.gu.uu()}function lM(e){return lF(e)&&!lJ(e).No()&&e.du.size>0}function lF(e){return 0===e._u.size}async function lU(e){e.du.forEach((t,n)=>{lO(e,t)})}async function lV(e,t){e.yu=void 0,lM(e)?(e.gu.hu(t),lL(e)):e.gu.set("Unknown")}async function lq(e,t,n){if(e.gu.set("Online"),t instanceof sP&&2===t.state&&t.cause)try{await async function(e,t){let n=t.cause;for(let r of t.targetIds)e.du.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.du.delete(r),e.yu.removeTarget(r))}(e,t)}catch(n){nj("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await lB(e,n)}else if(t instanceof sx?e.yu.Kt(t):t instanceof sO?e.yu.Jt(t):e.yu.jt(t),!n.isEqual(n8.min()))try{let t=await o6(e.localStore);n.compareTo(t)>=0&&await function(e,t){let n=e.yu.Zt(t);return n.targetChanges.forEach((n,r)=>{if(n.resumeToken.approximateByteSize()>0){let i=e.du.get(r);i&&e.du.set(r,i.withResumeToken(n.resumeToken,t))}}),n.targetMismatches.forEach(t=>{let n=e.du.get(t);if(!n)return;e.du.set(t,n.withResumeToken(rF.EMPTY_BYTE_STRING,n.snapshotVersion)),lP(e,t);let r=new aA(n.target,t,1,n.sequenceNumber);lO(e,r)}),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){nj("RemoteStore","Failed to raise snapshot:",t),await lB(e,t)}}async function lB(e,t,n){if(!rI(t))throw t;e._u.add(1),await lN(e),e.gu.set("Offline"),n||(n=()=>o6(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{nj("RemoteStore","Retrying IndexedDB access"),await n(),e._u.delete(1),await lD(e)})}function lj(e,t){return t().catch(n=>lB(e,n,t))}async function l$(e){var t;let n=lZ(e),r=e.fu.length>0?e.fu[e.fu.length-1].batchId:-1;for(;lF(t=e)&&t.fu.length<10;)try{let t=await function(e,t){return e.persistence.runTransaction("Get next mutation batch","readonly",n=>(void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)))}(e.localStore,r);if(null===t){0===e.fu.length&&n.Fo();break}r=t.batchId,function(e,t){e.fu.push(t);let n=lZ(e);n.ko()&&n.Yo&&n.Xo(t.mutations)}(e,t)}catch(t){await lB(e,t)}lG(e)&&lK(e)}function lG(e){return lF(e)&&!lZ(e).No()&&e.fu.length>0}function lK(e){lZ(e).start()}async function lz(e){lZ(e).eu()}async function lW(e){let t=lZ(e);for(let n of e.fu)t.Xo(n.mutations)}async function lH(e,t,n){let r=e.fu.shift(),i=aS.from(r,t,n);await lj(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await l$(e)}async function lQ(e,t){t&&lZ(e).Yo&&await async function(e,t){var n;if(sv(n=t.code)&&n!==nW.ABORTED){let n=e.fu.shift();lZ(e).Mo(),await lj(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await l$(e)}}(e,t),lG(e)&&lK(e)}async function lY(e,t){e.asyncQueue.verifyOperationInProgress(),nj("RemoteStore","RemoteStore received new credentials");let n=lF(e);e._u.add(3),await lN(e),n&&e.gu.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e._u.delete(3),await lD(e)}async function lX(e,t){t?(e._u.delete(2),await lD(e)):t||(e._u.add(2),await lN(e),e.gu.set("Unknown"))}function lJ(e){var t,n,r;return e.pu||(t=e.datastore,n=e.asyncQueue,r={Yr:lU.bind(null,e),Zr:lV.bind(null,e),Wo:lq.bind(null,e)},t.su(),e.pu=new lT(n,t.connection,t.authCredentials,t.appCheckCredentials,t.yt,r),e.wu.push(async t=>{t?(e.pu.Mo(),lM(e)?lL(e):e.gu.set("Unknown")):(await e.pu.stop(),e.yu=void 0)})),e.pu}function lZ(e){var t,n,r;return e.Iu||(t=e.datastore,n=e.asyncQueue,r={Yr:lz.bind(null,e),Zr:lQ.bind(null,e),tu:lW.bind(null,e),Zo:lH.bind(null,e)},t.su(),e.Iu=new lS(n,t.connection,t.authCredentials,t.appCheckCredentials,t.yt,r),e.wu.push(async t=>{t?(e.Iu.Mo(),await l$(e)):(await e.Iu.stop(),e.fu.length>0&&(nj("RemoteStore",`Stopping write stream with ${e.fu.length} pending writes`),e.fu=[]))})),e.Iu}class l0{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new nQ,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}static createAndSchedule(e,t,n,r,i){let s=new l0(e,t,Date.now()+n,r,i);return s.start(n),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new nH(nW.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function l1(e,t){if(n$("AsyncQueue",`${t}: ${e}`),rI(e))return new nH(nW.UNAVAILABLE,`${t}: ${e}`);throw e}class l2{constructor(e){this.comparator=e?(t,n)=>e(t,n)||rr.comparator(t.key,n.key):(e,t)=>rr.comparator(e.key,t.key),this.keyedMap=sE(),this.sortedSet=new ib(this.comparator)}static emptySet(e){return new l2(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof l2)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){let e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){let n=new l2;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class l3{constructor(){this.Tu=new ib(rr.comparator)}track(e){let t=e.doc.key,n=this.Tu.get(t);n?0!==e.type&&3===n.type?this.Tu=this.Tu.insert(t,e):3===e.type&&1!==n.type?this.Tu=this.Tu.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.Tu=this.Tu.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.Tu=this.Tu.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.Tu=this.Tu.remove(t):1===e.type&&2===n.type?this.Tu=this.Tu.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.Tu=this.Tu.insert(t,{type:2,doc:e.doc}):nz():this.Tu=this.Tu.insert(t,e)}Eu(){let e=[];return this.Tu.inorderTraversal((t,n)=>{e.push(n)}),e}}class l6{constructor(e,t,n,r,i,s,a,o,l){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=l}static fromInitialDocuments(e,t,n,r,i){let s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new l6(e,t,l2.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&iW(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class l4{constructor(){this.Au=void 0,this.listeners=[]}}class l5{constructor(){this.queries=new sb(e=>iH(e),iW),this.onlineState="Unknown",this.Ru=new Set}}async function l9(e,t){let n=t.query,r=!1,i=e.queries.get(n);if(i||(r=!0,i=new l4),r)try{i.Au=await e.onListen(n)}catch(n){let e=l1(n,`Initialization of query '${iQ(t.query)}' failed`);return void t.onError(e)}e.queries.set(n,i),i.listeners.push(t),t.bu(e.onlineState),i.Au&&t.Pu(i.Au)&&ut(e)}async function l8(e,t){let n=t.query,r=!1,i=e.queries.get(n);if(i){let e=i.listeners.indexOf(t);e>=0&&(i.listeners.splice(e,1),r=0===i.listeners.length)}if(r)return e.queries.delete(n),e.onUnlisten(n)}function l7(e,t){let n=!1;for(let r of t){let t=r.query,i=e.queries.get(t);if(i){for(let e of i.listeners)e.Pu(r)&&(n=!0);i.Au=r}}n&&ut(e)}function ue(e,t,n){let r=e.queries.get(t);if(r)for(let e of r.listeners)e.onError(n);e.queries.delete(t)}function ut(e){e.Ru.forEach(e=>{e.next()})}class un{constructor(e,t,n){this.query=e,this.vu=t,this.Vu=!1,this.Su=null,this.onlineState="Unknown",this.options=n||{}}Pu(e){if(!this.options.includeMetadataChanges){let t=[];for(let n of e.docChanges)3!==n.type&&t.push(n);e=new l6(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Vu?this.Du(e)&&(this.vu.next(e),t=!0):this.Cu(e,this.onlineState)&&(this.xu(e),t=!0),this.Su=e,t}onError(e){this.vu.error(e)}bu(e){this.onlineState=e;let t=!1;return this.Su&&!this.Vu&&this.Cu(this.Su,e)&&(this.xu(this.Su),t=!0),t}Cu(e,t){return!e.fromCache||(!this.options.Nu||"Offline"===t)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Du(e){if(e.docChanges.length>0)return!0;let t=this.Su&&this.Su.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}xu(e){e=l6.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Vu=!0,this.vu.next(e)}}class ur{constructor(e,t){this.ku=e,this.byteLength=t}Ou(){return"metadata"in this.ku}}class ui{constructor(e){this.yt=e}Ji(e){return sQ(this.yt,e)}Yi(e){return e.metadata.exists?s1(this.yt,e.document,!1):iC.newNoDocument(this.Ji(e.metadata.name),this.Xi(e.metadata.readTime))}Xi(e){return sK(e)}}class us{constructor(e,t,n){this.Mu=e,this.localStore=t,this.yt=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=ua(e)}Fu(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.ku.namedQuery)this.queries.push(e.ku.namedQuery);else if(e.ku.documentMetadata){this.documents.push({metadata:e.ku.documentMetadata}),e.ku.documentMetadata.exists||++t;let n=re.fromString(e.ku.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.ku.document&&(this.documents[this.documents.length-1].document=e.ku.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}$u(e){let t=new Map,n=new ui(this.yt);for(let r of e)if(r.metadata.queries){let e=n.Ji(r.metadata.name);for(let n of r.metadata.queries){let r=(t.get(n)||sC()).add(e);t.set(n,r)}}return t}async complete(){let e=await ln(this.localStore,new ui(this.yt),this.documents,this.Mu.id),t=this.$u(this.documents);for(let e of this.queries)await lr(this.localStore,e,t.get(e.name));return this.progress.taskState="Success",{progress:this.progress,Bu:this.collectionGroups,Lu:e}}}function ua(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class uo{constructor(e){this.key=e}}class ul{constructor(e){this.key=e}}class uu{constructor(e,t){this.query=e,this.qu=t,this.Uu=null,this.hasCachedResults=!1,this.current=!1,this.Ku=sC(),this.mutatedKeys=sC(),this.Gu=iJ(e),this.Qu=new l2(this.Gu)}get ju(){return this.qu}Wu(e,t){let n=t?t.zu:new l3,r=t?t.Qu:this.Qu,i=t?t.mutatedKeys:this.mutatedKeys,s=r,a=!1,o="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,l="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((e,t)=>{let u=r.get(e),c=iY(this.query,t)?t:null,h=!!u&&this.mutatedKeys.has(u.key),d=!!c&&(c.hasLocalMutations||this.mutatedKeys.has(c.key)&&c.hasCommittedMutations),f=!1;u&&c?u.data.isEqual(c.data)?h!==d&&(n.track({type:3,doc:c}),f=!0):this.Hu(u,c)||(n.track({type:2,doc:c}),f=!0,(o&&this.Gu(c,o)>0||l&&0>this.Gu(c,l))&&(a=!0)):!u&&c?(n.track({type:0,doc:c}),f=!0):u&&!c&&(n.track({type:1,doc:u}),f=!0,(o||l)&&(a=!0)),f&&(c?(s=s.add(c),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){let e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{Qu:s,zu:n,$i:a,mutatedKeys:i}}Hu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){let r=this.Qu;this.Qu=e.Qu,this.mutatedKeys=e.mutatedKeys;let i=e.zu.Eu();i.sort((e,t)=>(function(e,t){let n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return nz()}};return n(e)-n(t)})(e.type,t.type)||this.Gu(e.doc,t.doc)),this.Ju(n);let s=t?this.Yu():[],a=0===this.Ku.size&&this.current?1:0,o=a!==this.Uu;return(this.Uu=a,0!==i.length||o)?{snapshot:new l6(this.query,e.Qu,r,i,e.mutatedKeys,0===a,o,!1,!!n&&n.resumeToken.approximateByteSize()>0),Xu:s}:{Xu:s}}bu(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Qu:this.Qu,zu:new l3,mutatedKeys:this.mutatedKeys,$i:!1},!1)):{Xu:[]}}Zu(e){return!this.qu.has(e)&&!!this.Qu.has(e)&&!this.Qu.get(e).hasLocalMutations}Ju(e){e&&(e.addedDocuments.forEach(e=>this.qu=this.qu.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.qu=this.qu.delete(e)),this.current=e.current)}Yu(){if(!this.current)return[];let e=this.Ku;this.Ku=sC(),this.Qu.forEach(e=>{this.Zu(e.key)&&(this.Ku=this.Ku.add(e.key))});let t=[];return e.forEach(e=>{this.Ku.has(e)||t.push(new ul(e))}),this.Ku.forEach(n=>{e.has(n)||t.push(new uo(n))}),t}tc(e){this.qu=e.Hi,this.Ku=sC();let t=this.Wu(e.documents);return this.applyChanges(t,!0)}ec(){return l6.fromInitialDocuments(this.query,this.Qu,this.mutatedKeys,0===this.Uu,this.hasCachedResults)}}class uc{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class uh{constructor(e){this.key=e,this.nc=!1}}class ud{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.sc={},this.ic=new sb(e=>iH(e),iW),this.rc=new Map,this.oc=new Set,this.uc=new ib(rr.comparator),this.cc=new Map,this.ac=new oU,this.hc={},this.lc=new Map,this.fc=om.vn(),this.onlineState="Unknown",this.dc=void 0}get isPrimaryClient(){return!0===this.dc}}async function uf(e,t){let n,r,i=uB(e),s=i.ic.get(t);if(s)n=s.targetId,i.sharedClientState.addLocalQueryTarget(n),r=s.view.ec();else{let e=await o5(i.localStore,iG(t));i.isPrimaryClient&&lR(i.remoteStore,e);let s=i.sharedClientState.addLocalQueryTarget(e.targetId);n=e.targetId,r=await up(i,t,n,"current"===s,e.resumeToken)}return r}async function up(e,t,n,r,i){e._c=(t,n,r)=>(async function(e,t,n,r){let i=t.view.Wu(n);i.$i&&(i=await o8(e.localStore,t.query,!1).then(({documents:e})=>t.view.Wu(e,i)));let s=r&&r.targetChanges.get(t.targetId),a=t.view.applyChanges(i,e.isPrimaryClient,s);return uA(e,t.targetId,a.Xu),a.snapshot})(e,t,n,r);let s=await o8(e.localStore,t,!0),a=new uu(t,s.Hi),o=a.Wu(s.documents),l=sR.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),u=a.applyChanges(o,e.isPrimaryClient,l);uA(e,n,u.Xu);let c=new uc(t,n,a);return e.ic.set(t,c),e.rc.has(n)?e.rc.get(n).push(t):e.rc.set(n,[t]),u.snapshot}async function um(e,t){let n=e.ic.get(t),r=e.rc.get(n.targetId);if(r.length>1)return e.rc.set(n.targetId,r.filter(e=>!iW(e,t))),void e.ic.delete(t);e.isPrimaryClient?(e.sharedClientState.removeLocalQueryTarget(n.targetId),e.sharedClientState.isActiveQueryTarget(n.targetId)||await o9(e.localStore,n.targetId,!1).then(()=>{e.sharedClientState.clearQueryState(n.targetId),lx(e.remoteStore,n.targetId),uS(e,n.targetId)}).catch(rm)):(uS(e,n.targetId),await o9(e.localStore,n.targetId,!0))}async function ug(e,t,n){let r=uj(e);try{var i;let e,s=await function(e,t){let n,r,i=n9.now(),s=t.reduce((e,t)=>e.add(t.key),sC());return e.persistence.runTransaction("Locally write mutations","readwrite",a=>{let o=sI,l=sC();return e.Gi.getEntries(a,s).next(e=>{(o=e).forEach((e,t)=>{t.isValidDocument()||(l=l.add(e))})}).next(()=>e.localDocuments.getOverlayedDocuments(a,o)).next(r=>{n=r;let s=[];for(let e of t){let t=function(e,t){let n=null;for(let r of e.fieldTransforms){let e=t.data.field(r.field),i=i3(r.transform,e||null);null!=i&&(null===n&&(n=iA.empty()),n.set(r.field,i))}return n||null}(e,n.get(e.key).overlayedDocument);null!=t&&s.push(new sh(e.key,t,function e(t){let n=[];return rx(t.fields,(t,r)=>{let i=new rn([t]);if(r3(r)){let t=e(r.mapValue).fields;if(0===t.length)n.push(i);else for(let e of t)n.push(i.child(e))}else n.push(i)}),new ik(n)}(t.value.mapValue),si.exists(!0)))}return e.mutationQueue.addMutationBatch(a,i,s,t)}).next(t=>{r=t;let i=t.applyToLocalDocumentSet(n,l);return e.documentOverlayCache.saveOverlays(a,t.batchId,i)})}).then(()=>({batchId:r.batchId,changes:sT(n)}))}(r.localStore,t);r.sharedClientState.addPendingMutation(s.batchId),i=s.batchId,(e=r.hc[r.currentUser.toKey()])||(e=new ib(n4)),e=e.insert(i,n),r.hc[r.currentUser.toKey()]=e,await uD(r,s.changes),await l$(r.remoteStore)}catch(t){let e=l1(t,"Failed to persist write");n.reject(e)}}async function uy(e,t){try{let n=await function(e,t){let n=t.snapshotVersion,r=e.qi;return e.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{let s=e.Gi.newChangeBuffer({trackRemovals:!0});r=e.qi;let a=[];t.targetChanges.forEach((s,o)=>{var l;let u=r.get(o);if(!u)return;a.push(e.Cs.removeMatchingKeys(i,s.removedDocuments,o).next(()=>e.Cs.addMatchingKeys(i,s.addedDocuments,o)));let c=u.withSequenceNumber(i.currentSequenceNumber);t.targetMismatches.has(o)?c=c.withResumeToken(rF.EMPTY_BYTE_STRING,n8.min()).withLastLimboFreeSnapshotVersion(n8.min()):s.resumeToken.approximateByteSize()>0&&(c=c.withResumeToken(s.resumeToken,n)),r=r.insert(o,c),l=c,(0===u.resumeToken.approximateByteSize()||l.snapshotVersion.toMicroseconds()-u.snapshotVersion.toMicroseconds()>=3e8||s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size>0)&&a.push(e.Cs.updateTargetData(i,c))});let o=sI,l=sC();if(t.documentUpdates.forEach(n=>{t.resolvedLimboDocuments.has(n)&&a.push(e.persistence.referenceDelegate.updateLimboDocument(i,n))}),a.push(o4(i,s,t.documentUpdates).next(e=>{o=e.Wi,l=e.zi})),!n.isEqual(n8.min())){let t=e.Cs.getLastRemoteSnapshotVersion(i).next(t=>e.Cs.setTargetsMetadata(i,i.currentSequenceNumber,n));a.push(t)}return rg.waitFor(a).next(()=>s.apply(i)).next(()=>e.localDocuments.getLocalViewOfDocuments(i,o,l)).next(()=>o)}).then(t=>(e.qi=r,t))}(e.localStore,t);t.targetChanges.forEach((t,n)=>{let r=e.cc.get(n);r&&(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1||nz(),t.addedDocuments.size>0?r.nc=!0:t.modifiedDocuments.size>0?r.nc||nz():t.removedDocuments.size>0&&(r.nc||nz(),r.nc=!1))}),await uD(e,n,t)}catch(e){await rm(e)}}function uv(e,t,n){var r;if(e.isPrimaryClient&&0===n||!e.isPrimaryClient&&1===n){let n,i=[];e.ic.forEach((e,n)=>{let r=n.view.bu(t);r.snapshot&&i.push(r.snapshot)}),(r=e.eventManager).onlineState=t,n=!1,r.queries.forEach((e,r)=>{for(let e of r.listeners)e.bu(t)&&(n=!0)}),n&&ut(r),i.length&&e.sc.Wo(i),e.onlineState=t,e.isPrimaryClient&&e.sharedClientState.setOnlineState(t)}}async function uw(e,t,n){e.sharedClientState.updateQueryState(t,"rejected",n);let r=e.cc.get(t),i=r&&r.key;if(i){let n=new ib(rr.comparator);n=n.insert(i,iC.newNoDocument(i,n8.min()));let r=sC().add(i),s=new sN(n8.min(),new Map,new iE(n4),n,r);await uy(e,s),e.uc=e.uc.remove(i),e.cc.delete(t),uC(e)}else await o9(e.localStore,t,!1).then(()=>uS(e,t,n)).catch(rm)}async function ub(e,t){var n;let r=t.batch.batchId;try{let i=await (n=e.localStore,n.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{let r=t.batch.keys(),i=n.Gi.newChangeBuffer({trackRemovals:!0});return(function(e,t,n,r){let i=n.batch,s=i.keys(),a=rg.resolve();return s.forEach(e=>{a=a.next(()=>r.getEntry(t,e)).next(t=>{let s=n.docVersions.get(e);null!==s||nz(),0>t.version.compareTo(s)&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))})}),a.next(()=>e.mutationQueue.removeMutationBatch(t,i))})(n,e,t,i).next(()=>i.apply(e)).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=sC();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))).next(()=>n.localDocuments.getDocuments(e,r))}));uT(e,r,null),uE(e,r),e.sharedClientState.updateMutationState(r,"acknowledged"),await uD(e,i)}catch(e){await rm(e)}}async function uI(e,t,n){var r;try{let i=await (r=e.localStore,r.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let n;return r.mutationQueue.lookupMutationBatch(e,t).next(t=>(null!==t||nz(),n=t.keys(),r.mutationQueue.removeMutationBatch(e,t))).next(()=>r.mutationQueue.performConsistencyCheck(e)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(e,n,t)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,n)).next(()=>r.localDocuments.getDocuments(e,n))}));uT(e,t,n),uE(e,t),e.sharedClientState.updateMutationState(t,"rejected",n),await uD(e,i)}catch(e){await rm(e)}}async function u_(e,t){var n;lF(e.remoteStore)||nj("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let r=await (n=e.localStore).persistence.runTransaction("Get highest unacknowledged batch id","readonly",e=>n.mutationQueue.getHighestUnacknowledgedBatchId(e));if(-1===r)return void t.resolve();let i=e.lc.get(r)||[];i.push(t),e.lc.set(r,i)}catch(n){let e=l1(n,"Initialization of waitForPendingWrites() operation failed");t.reject(e)}}function uE(e,t){(e.lc.get(t)||[]).forEach(e=>{e.resolve()}),e.lc.delete(t)}function uT(e,t,n){let r=e.hc[e.currentUser.toKey()];if(r){let i=r.get(t);i&&(n?i.reject(n):i.resolve(),r=r.remove(t)),e.hc[e.currentUser.toKey()]=r}}function uS(e,t,n=null){for(let r of(e.sharedClientState.removeLocalQueryTarget(t),e.rc.get(t)))e.ic.delete(r),n&&e.sc.wc(r,n);e.rc.delete(t),e.isPrimaryClient&&e.ac.ls(t).forEach(t=>{e.ac.containsKey(t)||uk(e,t)})}function uk(e,t){e.oc.delete(t.path.canonicalString());let n=e.uc.get(t);null!==n&&(lx(e.remoteStore,n),e.uc=e.uc.remove(t),e.cc.delete(n),uC(e))}function uA(e,t,n){for(let r of n)r instanceof uo?(e.ac.addReference(r.key,t),function(e,t){let n=t.key,r=n.path.canonicalString();e.uc.get(n)||e.oc.has(r)||(nj("SyncEngine","New document in limbo: "+n),e.oc.add(r),uC(e))}(e,r)):r instanceof ul?(nj("SyncEngine","Document no longer in limbo: "+r.key),e.ac.removeReference(r.key,t),e.ac.containsKey(r.key)||uk(e,r.key)):nz()}function uC(e){for(;e.oc.size>0&&e.uc.size<e.maxConcurrentLimboResolutions;){let t=e.oc.values().next().value;e.oc.delete(t);let n=new rr(re.fromString(t)),r=e.fc.next();e.cc.set(r,new uh(n)),e.uc=e.uc.insert(n,r),lR(e.remoteStore,new aA(iG(iU(n.path)),r,2,rC.at))}}async function uD(e,t,n){let r=[],i=[],s=[];e.ic.isEmpty()||(e.ic.forEach((a,o)=>{s.push(e._c(o,t,n).then(t=>{if((t||n)&&e.isPrimaryClient&&e.sharedClientState.updateQueryState(o.targetId,(null==t?void 0:t.fromCache)?"not-current":"current"),t){r.push(t);let e=o0.Ci(o.targetId,t);i.push(e)}}))}),await Promise.all(s),e.sc.Wo(r),await async function(e,t){try{await e.persistence.runTransaction("notifyLocalViewChanges","readwrite",n=>rg.forEach(t,t=>rg.forEach(t.Si,r=>e.persistence.referenceDelegate.addReference(n,t.targetId,r)).next(()=>rg.forEach(t.Di,r=>e.persistence.referenceDelegate.removeReference(n,t.targetId,r)))))}catch(e){if(!rI(e))throw e;nj("LocalStore","Failed to update sequence numbers: "+e)}for(let n of t){let t=n.targetId;if(!n.fromCache){let n=e.qi.get(t),r=n.snapshotVersion,i=n.withLastLimboFreeSnapshotVersion(r);e.qi=e.qi.insert(t,i)}}}(e.localStore,i))}async function uN(e,t){if(!e.currentUser.isEqual(t)){nj("SyncEngine","User change. New user:",t.toKey());let n=await o3(e.localStore,t);e.currentUser=t,e.lc.forEach(e=>{e.forEach(e=>{e.reject(new nH(nW.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.lc.clear(),e.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),await uD(e,n.ji)}}function uR(e,t){let n=e.cc.get(t);if(n&&n.nc)return sC().add(n.key);{let n=sC(),r=e.rc.get(t);if(!r)return n;for(let t of r){let r=e.ic.get(t);n=n.unionWith(r.view.ju)}return n}}async function ux(e,t){let n=await o8(e.localStore,t.query,!0),r=t.view.tc(n);return e.isPrimaryClient&&uA(e,t.targetId,r.Xu),r}async function uO(e,t){return le(e.localStore,t).then(t=>uD(e,t))}async function uP(e,t,n,r){var i;let s=await function(e,t){let n=e.mutationQueue;return e.persistence.runTransaction("Lookup mutation documents","readonly",r=>n.Tn(r,t).next(t=>t?e.localDocuments.getDocuments(r,t):rg.resolve(null)))}(e.localStore,t);null!==s?("pending"===n?await l$(e.remoteStore):"acknowledged"===n||"rejected"===n?(uT(e,t,r||null),uE(e,t),i=e.localStore,i.mutationQueue.An(t)):nz(),await uD(e,s)):nj("SyncEngine","Cannot apply mutation batch with id: "+t)}async function uL(e,t){if(uB(e),uj(e),!0===t&&!0!==e.dc){let t=e.sharedClientState.getAllActiveQueryTargets(),n=await uM(e,t.toArray());for(let t of(e.dc=!0,await lX(e.remoteStore,!0),n))lR(e.remoteStore,t)}else if(!1===t&&!1!==e.dc){let t=[],n=Promise.resolve();e.rc.forEach((r,i)=>{e.sharedClientState.isLocalQueryTarget(i)?t.push(i):n=n.then(()=>(uS(e,i),o9(e.localStore,i,!0))),lx(e.remoteStore,i)}),await n,await uM(e,t),e.cc.forEach((t,n)=>{lx(e.remoteStore,n)}),e.ac.fs(),e.cc=new Map,e.uc=new ib(rr.comparator),e.dc=!1,await lX(e.remoteStore,!1)}}async function uM(e,t,n){let r=[],i=[];for(let n of t){let t,s=e.rc.get(n);if(s&&0!==s.length)for(let n of(t=await o5(e.localStore,iG(s[0])),s)){let t=e.ic.get(n),r=await ux(e,t);r.snapshot&&i.push(r.snapshot)}else{let r=await o7(e.localStore,n);t=await o5(e.localStore,r),await up(e,uF(r),n,!1,t.resumeToken)}r.push(t)}return e.sc.Wo(i),r}function uF(e){var t,n,r,i,s;return t=e.path,n=e.collectionGroup,r=e.orderBy,i=e.filters,s=e.limit,new iF(t,n,r,i,s,"F",e.startAt,e.endAt)}function uU(e){return e.localStore.persistence.vi()}async function uV(e,t,n,r){if(e.dc)return void nj("SyncEngine","Ignoring unexpected query state notification.");let i=e.rc.get(t);if(i&&i.length>0)switch(n){case"current":case"not-current":{let r=await le(e.localStore,iX(i[0])),s=sN.createSynthesizedRemoteEventForCurrentChange(t,"current"===n,rF.EMPTY_BYTE_STRING);await uD(e,r,s);break}case"rejected":await o9(e.localStore,t,!0),uS(e,t,r);break;default:nz()}}async function uq(e,t,n){let r=uB(e);if(r.dc){for(let e of t){if(r.rc.has(e)){nj("SyncEngine","Adding an already active target "+e);continue}let t=await o7(r.localStore,e),n=await o5(r.localStore,t);await up(r,uF(t),n.targetId,!1,n.resumeToken),lR(r.remoteStore,n)}for(let e of n)r.rc.has(e)&&await o9(r.localStore,e,!1).then(()=>{lx(r.remoteStore,e),uS(r,e)}).catch(rm)}}function uB(e){return e.remoteStore.remoteSyncer.applyRemoteEvent=uy.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=uR.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=uw.bind(null,e),e.sc.Wo=l7.bind(null,e.eventManager),e.sc.wc=ue.bind(null,e.eventManager),e}function uj(e){return e.remoteStore.remoteSyncer.applySuccessfulWrite=ub.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=uI.bind(null,e),e}class u${constructor(){this.synchronizeTabs=!1}async initialize(e){this.yt=lI(e.databaseInfo.databaseId),this.sharedClientState=this.gc(e),this.persistence=this.yc(e),await this.persistence.start(),this.localStore=this.Ic(e),this.gcScheduler=this.Tc(e,this.localStore),this.indexBackfillerScheduler=this.Ec(e,this.localStore)}Tc(e,t){return null}Ec(e,t){return null}Ic(e){var t,n;return t=this.persistence,n=new o1,new o2(t,n,e.initialUser,this.yt)}yc(e){return new oG(oz.Bs,this.yt)}gc(e){return new lf}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class uG extends u${constructor(e,t,n){super(),this.Ac=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Ac.initialize(this,e),await uj(this.Ac.syncEngine),await l$(this.Ac.remoteStore),await this.persistence.li(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}Ic(e){var t,n;return t=this.persistence,n=new o1,new o2(t,n,e.initialUser,this.yt)}Tc(e,t){return new o_(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Ec(e,t){let n=new rA(t,this.persistence);return new rk(e.asyncQueue,n)}yc(e){let t=oZ(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?oo.withCacheSize(this.cacheSizeBytes):oo.DEFAULT;return new oY(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,lw(),lb(),this.yt,this.sharedClientState,!!this.forceOwnership)}gc(e){return new lf}}class uK extends uG{constructor(e,t){super(e,t,!1),this.Ac=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);let t=this.Ac.syncEngine;this.sharedClientState instanceof ld&&(this.sharedClientState.syncEngine={Fr:uP.bind(null,t),$r:uV.bind(null,t),Br:uq.bind(null,t),vi:uU.bind(null,t),Mr:uO.bind(null,t)},await this.sharedClientState.start()),await this.persistence.li(async e=>{await uL(this.Ac.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())})}gc(e){let t=lw();if(!ld.C(t))throw new nH(nW.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let n=oZ(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new ld(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class uz{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>uv(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=uN.bind(null,this.syncEngine),await lX(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new l5}createDatastore(e){var t;let n=lI(e.databaseInfo.databaseId),r=new lv(e.databaseInfo);return t=e.authCredentials,new lk(t,e.appCheckCredentials,r,n)}createRemoteStore(e){var t,n;return t=this.localStore,n=this.datastore,new lC(t,n,e.asyncQueue,e=>uv(this.syncEngine,e,0),lm.C()?new lm:new lp)}createSyncEngine(e,t){return function(e,t,n,r,i,s,a){let o=new ud(e,t,n,r,i,s);return a&&(o.dc=!0),o}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(e){nj("RemoteStore","RemoteStore shutting down."),e._u.add(5),await lN(e),e.mu.shutdown(),e.gu.set("Unknown")}(this.remoteStore)}}function uW(e,t,n){if(!n)throw new nH(nW.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function uH(e,t,n,r){if(!0===t&&!0===r)throw new nH(nW.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function uQ(e){if(!rr.isDocumentKey(e))throw new nH(nW.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function uY(e){if(rr.isDocumentKey(e))throw new nH(nW.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function uX(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{var t;let n=(t=e).constructor?t.constructor.name:null;return n?`a custom ${n} object`:"an object"}}return"function"==typeof e?"a function":nz()}function uJ(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new nH(nW.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let n=uX(e);throw new nH(nW.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function uZ(e,t){if(t<=0)throw new nH(nW.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}let u0=new Map;class u1{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new nH(nW.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null==(t=e.ssl)||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=0x2800000;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new nH(nW.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,uH("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class u2{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new u1({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new nH(nW.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new nH(nW.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new u1(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new nX;switch(e.type){case"gapi":return new n1(e.client,e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new nH(nW.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){let t=u0.get(e);t&&(nj("ComponentProvider","Removing Datastore"),u0.delete(e),t.terminate())}(this),Promise.resolve()}}class u3{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new u4(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new u3(this.firestore,e,this._key)}}class u6{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new u6(this.firestore,e,this._query)}}class u4 extends u6{constructor(e,t,n){super(e,t,iU(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new u3(this.firestore,null,new rr(e))}withConverter(e){return new u4(this.firestore,e,this._path)}}function u5(e,t,...n){if(e=(0,y.m9)(e),uW("collection","path",t),e instanceof u2){let r=re.fromString(t,...n);return uY(r),new u4(e,null,r)}{if(!(e instanceof u3||e instanceof u4))throw new nH(nW.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=e._path.child(re.fromString(t,...n));return uY(r),new u4(e.firestore,null,r)}}function u9(e,t,...n){if(e=(0,y.m9)(e),1==arguments.length&&(t=n6.R()),uW("doc","path",t),e instanceof u2){let r=re.fromString(t,...n);return uQ(r),new u3(e,null,new rr(r))}{if(!(e instanceof u3||e instanceof u4))throw new nH(nW.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=e._path.child(re.fromString(t,...n));return uQ(r),new u3(e.firestore,e instanceof u4?e.converter:null,new rr(r))}}function u8(e,t){return e=(0,y.m9)(e),t=(0,y.m9)(t),(e instanceof u3||e instanceof u4)&&(t instanceof u3||t instanceof u4)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function u7(e,t){return e=(0,y.m9)(e),t=(0,y.m9)(t),e instanceof u6&&t instanceof u6&&e.firestore===t.firestore&&iW(e._query,t._query)&&e.converter===t.converter}function ce(e,t=10240){let n=0;return{async read(){if(n<e.byteLength){let r={value:e.slice(n,n+t),done:!1};return n+=t,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.reject("unimplemented")}}class ct{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Rc(this.observer.next,e)}error(e){this.observer.error?this.Rc(this.observer.error,e):n$("Uncaught Error in snapshot listener:",e.toString())}bc(){this.muted=!0}Rc(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class cn{constructor(e,t){this.Pc=e,this.yt=t,this.metadata=new nQ,this.buffer=new Uint8Array,this.vc=new TextDecoder("utf-8"),this.Vc().then(e=>{e&&e.Ou()?this.metadata.resolve(e.ku.metadata):this.metadata.reject(Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(null==e?void 0:e.ku)}`))},e=>this.metadata.reject(e))}close(){return this.Pc.cancel()}async getMetadata(){return this.metadata.promise}async mc(){return await this.getMetadata(),this.Vc()}async Vc(){let e=await this.Sc();if(null===e)return null;let t=this.vc.decode(e),n=Number(t);return isNaN(n)&&this.Dc(`length string (${t}) is not valid number`),new ur(JSON.parse(await this.Cc(n)),e.length+n)}xc(){return this.buffer.findIndex(e=>123===e)}async Sc(){for(;0>this.xc()&&!await this.Nc(););if(0===this.buffer.length)return null;let e=this.xc();e<0&&this.Dc("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async Cc(e){for(;this.buffer.length<e;)await this.Nc()&&this.Dc("Reached the end of bundle when more is expected.");let t=this.vc.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}Dc(e){throw this.Pc.cancel(),Error(`Invalid bundle format: ${e}`)}async Nc(){let e=await this.Pc.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class cr{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new nH(nW.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");let t=await async function(e,t){let n=sJ(e.yt)+"/documents",r={documents:t.map(t=>sH(e.yt,t))},i=await e._o("BatchGetDocuments",n,r,t.length),s=new Map;i.forEach(t=>{var n;let r=(n=e.yt,"found"in t?function(e,t){t.found||nz(),t.found.name,t.found.updateTime;let n=sQ(e,t.found.name),r=sK(t.found.updateTime),i=t.found.createTime?sK(t.found.createTime):n8.min(),s=new iA({mapValue:{fields:t.found.fields}});return iC.newFoundDocument(n,r,i,s)}(n,t):"missing"in t?function(e,t){t.missing||nz(),t.readTime||nz();let n=sQ(e,t.missing),r=sK(t.readTime);return iC.newNoDocument(n,r)}(n,t):nz());s.set(r.key.toString(),r)});let a=[];return t.forEach(e=>{let t=s.get(e.toString());t||nz(),a.push(t)}),a}(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new sm(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((e,t)=>{let n=rr.fromPath(t);this.mutations.push(new sg(n,this.precondition(n)))}),await async function(e,t){let n=sJ(e.yt)+"/documents",r={writes:t.map(t=>s2(e.yt,t))};await e.ao("Commit",n,r)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw nz();t=n8.min()}let n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new nH(nW.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(n8.min())?si.exists(!1):si.updateTime(t):si.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(n8.min()))throw new nH(nW.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return si.updateTime(t)}return si.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class ci{constructor(e,t,n,r,i){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=r,this.deferred=i,this.kc=n.maxAttempts,this.xo=new l_(this.asyncQueue,"transaction_retry")}run(){this.kc-=1,this.Oc()}Oc(){this.xo.Ro(async()=>{let e=new cr(this.datastore),t=this.Mc(e);t&&t.then(t=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(t)}).catch(e=>{this.Fc(e)}))}).catch(e=>{this.Fc(e)})})}Mc(e){try{let t=this.updateFunction(e);return!rP(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Fc(e){this.kc>0&&this.$c(e)?(this.kc-=1,this.asyncQueue.enqueueAndForget(()=>(this.Oc(),Promise.resolve()))):this.deferred.reject(e)}$c(e){if("FirebaseError"===e.name){let t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!sv(t)}return!1}}class cs{constructor(e,t,n,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=nU.UNAUTHENTICATED,this.clientId=n6.R(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,async e=>{nj("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(nj("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new nH(nW.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let e=new nQ;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){let t=l1(n,"Failed to shutdown persistence");e.reject(t)}}),e.promise}}async function ca(e,t){e.asyncQueue.verifyOperationInProgress(),nj("FirestoreClient","Initializing OfflineComponentProvider");let n=await e.getConfiguration();await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await o3(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e.offlineComponents=t}async function co(e,t){e.asyncQueue.verifyOperationInProgress();let n=await cl(e);nj("FirestoreClient","Initializing OnlineComponentProvider");let r=await e.getConfiguration();await t.initialize(n,r),e.setCredentialChangeListener(e=>lY(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>lY(t.remoteStore,n)),e.onlineComponents=t}async function cl(e){return e.offlineComponents||(nj("FirestoreClient","Using default OfflineComponentProvider"),await ca(e,new u$)),e.offlineComponents}async function cu(e){return e.onlineComponents||(nj("FirestoreClient","Using default OnlineComponentProvider"),await co(e,new uz)),e.onlineComponents}function cc(e){return cl(e).then(e=>e.persistence)}function ch(e){return cl(e).then(e=>e.localStore)}function cd(e){return cu(e).then(e=>e.remoteStore)}function cf(e){return cu(e).then(e=>e.syncEngine)}async function cp(e){let t=await cu(e),n=t.eventManager;return n.onListen=uf.bind(null,t.syncEngine),n.onUnlisten=um.bind(null,t.syncEngine),n}function cm(e,t,n={}){let r=new nQ;return e.asyncQueue.enqueueAndForget(async()=>(function(e,t,n,r,i){let s=new ct({next:s=>{t.enqueueAndForget(()=>l8(e,a));let o=s.docs.has(n);!o&&s.fromCache?i.reject(new nH(nW.UNAVAILABLE,"Failed to get document because the client is offline.")):o&&s.fromCache&&r&&"server"===r.source?i.reject(new nH(nW.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(s)},error:e=>i.reject(e)}),a=new un(iU(n.path),s,{includeMetadataChanges:!0,Nu:!0});return l9(e,a)})(await cp(e),e.asyncQueue,t,n,r)),r.promise}function cg(e,t,n={}){let r=new nQ;return e.asyncQueue.enqueueAndForget(async()=>(function(e,t,n,r,i){let s=new un(n,new ct({next:n=>{t.enqueueAndForget(()=>l8(e,s)),n.fromCache&&"server"===r.source?i.reject(new nH(nW.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),{includeMetadataChanges:!0,Nu:!0});return l9(e,s)})(await cp(e),e.asyncQueue,t,n,r)),r.promise}class cy{constructor(){this.Bc=Promise.resolve(),this.Lc=[],this.qc=!1,this.Uc=[],this.Kc=null,this.Gc=!1,this.Qc=!1,this.jc=[],this.xo=new l_(this,"async_queue_retry"),this.Wc=()=>{let e=lb();e&&nj("AsyncQueue","Visibility state changed to "+e.visibilityState),this.xo.Po()};let e=lb();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Wc)}get isShuttingDown(){return this.qc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.zc(),this.Hc(e)}enterRestrictedMode(e){if(!this.qc){this.qc=!0,this.Qc=e||!1;let t=lb();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Wc)}}enqueue(e){if(this.zc(),this.qc)return new Promise(()=>{});let t=new nQ;return this.Hc(()=>this.qc&&this.Qc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Lc.push(e),this.Jc()))}async Jc(){if(0!==this.Lc.length){try{await this.Lc[0](),this.Lc.shift(),this.xo.reset()}catch(e){if(!rI(e))throw e;nj("AsyncQueue","Operation failed with retryable error: "+e)}this.Lc.length>0&&this.xo.Ro(()=>this.Jc())}}Hc(e){let t=this.Bc.then(()=>(this.Gc=!0,e().catch(e=>{let t;throw this.Kc=e,this.Gc=!1,n$("INTERNAL UNHANDLED ERROR: ",(t=e.message||"",e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t)),e}).then(e=>(this.Gc=!1,e))));return this.Bc=t,t}enqueueAfterDelay(e,t,n){this.zc(),this.jc.indexOf(e)>-1&&(t=0);let r=l0.createAndSchedule(this,e,t,n,e=>this.Yc(e));return this.Uc.push(r),r}zc(){this.Kc&&nz()}verifyOperationInProgress(){}async Xc(){let e;do e=this.Bc,await e;while(e!==this.Bc)}Zc(e){for(let t of this.Uc)if(t.timerId===e)return!0;return!1}ta(e){return this.Xc().then(()=>{for(let t of(this.Uc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs),this.Uc))if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Xc()})}ea(e){this.jc.push(e)}Yc(e){let t=this.Uc.indexOf(e);this.Uc.splice(t,1)}}function cv(e){if("object"!=typeof e||null===e)return!1;for(let t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}class cw{constructor(){this._progressObserver={},this._taskCompletionResolver=new nQ,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class cb extends u2{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new cy,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||c_(this),this._firestoreClient.terminate()}}function cI(e){return e._firestoreClient||c_(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function c_(e){var t,n,r;let i=e._freezeSettings(),s=(n=e._databaseId,r=(null==(t=e._app)?void 0:t.options.appId)||"",new rD(n,r,e._persistenceKey,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,i.useFetchStreams));e._firestoreClient=new cs(e._authCredentials,e._appCheckCredentials,e._queue,s)}function cE(e,t,n){let r=new nQ;return e.asyncQueue.enqueue(async()=>{try{await ca(e,n),await co(e,t),r.resolve()}catch(e){if(!("FirebaseError"===e.name?e.code===nW.FAILED_PRECONDITION||e.code===nW.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code))throw e;nG("Error enabling offline persistence. Falling back to persistence disabled: "+e),r.reject(e)}}).then(()=>r.promise)}function cT(e){if(e._initialized||e._terminated)throw new nH(nW.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class cS{constructor(e){this._byteString=e}static fromBase64String(e){try{return new cS(rF.fromBase64String(e))}catch(e){throw new nH(nW.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new cS(rF.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class ck{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new nH(nW.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new rn(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class cA{constructor(e){this._methodName=e}}class cC{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new nH(nW.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new nH(nW.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return n4(this._lat,e._lat)||n4(this._long,e._long)}}let cD=/^__.*__$/;class cN{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new sh(e,this.data,this.fieldMask,t,this.fieldTransforms):new sc(e,this.data,t,this.fieldTransforms)}}class cR{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new sh(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function cx(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw nz()}}class cO{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.yt=n,this.ignoreUndefinedProperties=r,void 0===i&&this.na(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get sa(){return this.settings.sa}ia(e){return new cO(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.yt,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ra(e){var t;let n=null==(t=this.path)?void 0:t.child(e),r=this.ia({path:n,oa:!1});return r.ua(e),r}ca(e){var t;let n=null==(t=this.path)?void 0:t.child(e),r=this.ia({path:n,oa:!1});return r.na(),r}aa(e){return this.ia({path:void 0,oa:!0})}ha(e){return cZ(e,this.settings.methodName,this.settings.la||!1,this.path,this.settings.fa)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}na(){if(this.path)for(let e=0;e<this.path.length;e++)this.ua(this.path.get(e))}ua(e){if(0===e.length)throw this.ha("Document fields must not be empty");if(cx(this.sa)&&cD.test(e))throw this.ha('Document fields cannot begin and end with "__"')}}class cP{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.yt=n||lI(e)}da(e,t,n,r=!1){return new cO({sa:e,methodName:t,fa:n,path:rn.emptyPath(),oa:!1,la:r},this.databaseId,this.yt,this.ignoreUndefinedProperties)}}function cL(e){let t=e._freezeSettings(),n=lI(e._databaseId);return new cP(e._databaseId,!!t.ignoreUndefinedProperties,n)}function cM(e,t,n,r,i,s={}){let a,o,l=e.da(s.merge||s.mergeFields?2:0,t,n,i);cQ("Data must be an object, but it was:",l,r);let u=cW(r,l);if(s.merge)a=new ik(l.fieldMask),o=l.fieldTransforms;else if(s.mergeFields){let e=[];for(let r of s.mergeFields){let i=cY(t,r,n);if(!l.contains(i))throw new nH(nW.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);c0(e,i)||e.push(i)}a=new ik(e),o=l.fieldTransforms.filter(e=>a.covers(e.field))}else a=null,o=l.fieldTransforms;return new cN(new iA(u),a,o)}class cF extends cA{_toFieldTransform(e){if(2!==e.sa)throw 1===e.sa?e.ha(`${this._methodName}() can only appear at the top level of your update data`):e.ha(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof cF}}function cU(e,t,n){return new cO({sa:3,fa:t.settings.fa,methodName:e._methodName,oa:n},t.databaseId,t.yt,t.ignoreUndefinedProperties)}class cV extends cA{_toFieldTransform(e){return new sn(e.path,new i6)}isEqual(e){return e instanceof cV}}class cq extends cA{constructor(e,t){super(e),this._a=t}_toFieldTransform(e){let t=cU(this,e,!0),n=new i4(this._a.map(e=>cz(e,t)));return new sn(e.path,n)}isEqual(e){return this===e}}class cB extends cA{constructor(e,t){super(e),this._a=t}_toFieldTransform(e){let t=cU(this,e,!0),n=new i9(this._a.map(e=>cz(e,t)));return new sn(e.path,n)}isEqual(e){return this===e}}class cj extends cA{constructor(e,t){super(e),this.wa=t}_toFieldTransform(e){let t=new i7(e.yt,i1(e.yt,this.wa));return new sn(e.path,t)}isEqual(e){return this===e}}function c$(e,t,n,r){let i=e.da(1,t,n);cQ("Data must be an object, but it was:",i,r);let s=[],a=iA.empty();return rx(r,(e,r)=>{let o=cJ(t,e,n);r=(0,y.m9)(r);let l=i.ca(o);if(r instanceof cF)s.push(o);else{let e=cz(r,l);null!=e&&(s.push(o),a.set(o,e))}}),new cR(a,new ik(s),i.fieldTransforms)}function cG(e,t,n,r,i,s){let a=e.da(1,t,n),o=[cY(t,r,n)],l=[i];if(s.length%2!=0)throw new nH(nW.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)o.push(cY(t,s[e])),l.push(s[e+1]);let u=[],c=iA.empty();for(let e=o.length-1;e>=0;--e)if(!c0(u,o[e])){let t=o[e],n=l[e];n=(0,y.m9)(n);let r=a.ca(t);if(n instanceof cF)u.push(t);else{let e=cz(n,r);null!=e&&(u.push(t),c.set(t,e))}}return new cR(c,new ik(u),a.fieldTransforms)}function cK(e,t,n,r=!1){return cz(n,e.da(r?4:3,t))}function cz(e,t){if(cH(e=(0,y.m9)(e)))return cQ("Unsupported field value:",t,e),cW(e,t);if(e instanceof cA)return function(e,t){if(!cx(t.sa))throw t.ha(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.ha(`${e._methodName}() is not currently supported inside arrays`);let n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.oa&&4!==t.sa)throw t.ha("Nested arrays are not supported");let n=[],r=0;for(let i of e){let e=cz(i,t.aa(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}var n=e;if(null===(n=(0,y.m9)(n)))return{nullValue:"NULL_VALUE"};if("number"==typeof n)return i1(t.yt,n);if("boolean"==typeof n)return{booleanValue:n};if("string"==typeof n)return{stringValue:n};if(n instanceof Date){let e=n9.fromDate(n);return{timestampValue:s$(t.yt,e)}}if(n instanceof n9){let e=new n9(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:s$(t.yt,e)}}if(n instanceof cC)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof cS)return{bytesValue:sG(t.yt,n._byteString)};if(n instanceof u3){let e=t.databaseId,r=n.firestore._databaseId;if(!r.isEqual(e))throw t.ha(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${e.projectId}/${e.database}`);return{referenceValue:sz(n.firestore._databaseId||t.databaseId,n._key.path)}}throw t.ha(`Unsupported field value: ${uX(n)}`)}function cW(e,t){let n={};return rO(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):rx(e,(e,r)=>{let i=cz(r,t.ra(e));null!=i&&(n[e]=i)}),{mapValue:{fields:n}}}function cH(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof n9||e instanceof cC||e instanceof cS||e instanceof u3||e instanceof cA)}function cQ(e,t,n){if(!cH(n)||"object"!=typeof n||null===n||Object.getPrototypeOf(n)!==Object.prototype&&null!==Object.getPrototypeOf(n)){let r=uX(n);throw"an object"===r?t.ha(e+" a custom object"):t.ha(e+" "+r)}}function cY(e,t,n){if((t=(0,y.m9)(t))instanceof ck)return t._internalPath;if("string"==typeof t)return cJ(e,t);throw cZ("Field path arguments must be of type string or ",e,!1,void 0,n)}let cX=RegExp("[~\\*/\\[\\]]");function cJ(e,t,n){if(t.search(cX)>=0)throw cZ(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new ck(...t.split("."))._internalPath}catch(r){throw cZ(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function cZ(e,t,n,r,i){let s=r&&!r.isEmpty(),a=void 0!==i,o=`Function ${t}() called with invalid data`;n&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${r}`),a&&(l+=` in document ${i}`),l+=")"),new nH(nW.INVALID_ARGUMENT,o+e+l)}function c0(e,t){return e.some(e=>e.isEqual(t))}class c1{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new u3(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){let e=new c2(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(c3("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class c2 extends c1{data(){return super.data()}}function c3(e,t){return"string"==typeof t?cJ(e,t):t instanceof ck?t._internalPath:t._delegate._internalPath}function c6(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new nH(nW.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class c4{}class c5 extends c4{}function c9(e,t,...n){let r=[];for(let i of(t instanceof c4&&r.push(t),function(e){let t=e.filter(e=>e instanceof c7).length,n=e.filter(e=>e instanceof c8).length;if(t>1||t>0&&n>0)throw new nH(nW.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r=r.concat(n)),r))e=i._apply(e);return e}class c8 extends c5{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new c8(e,t,n)}_apply(e){let t=this._parse(e);return ho(e._query,t),new u6(e.firestore,e.converter,iK(e._query,t))}_parse(e){let t=cL(e.firestore);return function(e,t,n,r,i,s,a){let o;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new nH(nW.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){ha(a,s);let t=[];for(let n of a)t.push(hs(r,e,n));o={arrayValue:{values:t}}}else o=hs(r,e,a)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||ha(a,s),o=cK(n,t,a,"in"===s||"not-in"===s);return ir.create(i,s,o)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}class c7 extends c4{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new c7(e,t)}_parse(e){let t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:ii.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;for(let e of t.getFlattenedFilters())ho(n,e),n=iK(n,e)}(e._query,t),new u6(e.firestore,e.converter,iK(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class he extends c5{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new he(e,t)}_apply(e){let t=function(e,t,n){if(null!==e.startAt)throw new nH(nW.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new nH(nW.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");let r=new iw(t,n);return function(e,t){if(null===iq(e)){let n=iB(e);null!==n&&hl(e,n,t.field)}}(e,r),r}(e._query,this._field,this._direction);return new u6(e.firestore,e.converter,function(e,t){let n=e.explicitOrderBy.concat([t]);return new iF(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}class ht extends c5{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new ht(e,t,n)}_apply(e){return new u6(e.firestore,e.converter,iz(e._query,this._limit,this._limitType))}}class hn extends c5{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new hn(e,t,n)}_apply(e){var t;let n=hi(e,this.type,this._docOrFields,this._inclusive);return new u6(e.firestore,e.converter,(t=e._query,new iF(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,n,t.endAt)))}}class hr extends c5{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new hr(e,t,n)}_apply(e){var t;let n=hi(e,this.type,this._docOrFields,this._inclusive);return new u6(e.firestore,e.converter,(t=e._query,new iF(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,n)))}}function hi(e,t,n,r){if(n[0]=(0,y.m9)(n[0]),n[0]instanceof c1)return function(e,t,n,r,i){if(!r)throw new nH(nW.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);let s=[];for(let n of i$(e))if(n.field.isKeyField())s.push(rJ(t,r.key));else{let e=r.data.field(n.field);if(rj(e))throw new nH(nW.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){let e=n.field.canonicalString();throw new nH(nW.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new r8(s,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);{let i=cL(e.firestore);return function(e,t,n,r,i,s){let a=e.explicitOrderBy;if(i.length>a.length)throw new nH(nW.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let o=[];for(let s=0;s<i.length;s++){let l=i[s];if(a[s].field.isKeyField()){if("string"!=typeof l)throw new nH(nW.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof l}`);if(!ij(e)&&-1!==l.indexOf("/"))throw new nH(nW.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${l}' contains a slash.`);let n=e.path.child(re.fromString(l));if(!rr.isDocumentKey(n))throw new nH(nW.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);let i=new rr(n);o.push(rJ(t,i))}else{let e=cK(n,r,l);o.push(e)}}return new r8(o,s)}(e._query,e.firestore._databaseId,i,t,n,r)}}function hs(e,t,n){if("string"==typeof(n=(0,y.m9)(n))){if(""===n)throw new nH(nW.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!ij(t)&&-1!==n.indexOf("/"))throw new nH(nW.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);let r=t.path.child(re.fromString(n));if(!rr.isDocumentKey(r))throw new nH(nW.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return rJ(e,new rr(r))}if(n instanceof u3)return rJ(e,n._key);throw new nH(nW.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${uX(n)}.`)}function ha(e,t){if(!Array.isArray(e)||0===e.length)throw new nH(nW.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`);if(e.length>10)throw new nH(nW.INVALID_ARGUMENT,`Invalid Query. '${t.toString()}' filters support a maximum of 10 elements in the value array.`)}function ho(e,t){if(t.isInequality()){let n=iB(e),r=t.field;if(null!==n&&!n.isEqual(r))throw new nH(nW.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${r.toString()}'`);let i=iq(e);null!==i&&hl(e,r,i)}let n=function(e,t){for(let n of e)for(let e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new nH(nW.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new nH(nW.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}function hl(e,t,n){if(!n.isEqual(t))throw new nH(nW.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${t.toString()}' and so you must also use '${t.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class hu{convertValue(e,t="none"){switch(rz(e)){case 0:return null;case 1:return e.booleanValue;case 2:return rq(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(rB(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw nz()}}convertObject(e,t){let n={};return rx(e.fields,(e,r)=>{n[e]=this.convertValue(r,t)}),n}convertGeoPoint(e){return new cC(rq(e.latitude),rq(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":let n=function e(t){let n=t.mapValue.fields.__previous_value__;return rj(n)?e(n):n}(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(r$(e));default:return null}}convertTimestamp(e){let t=rV(e);return new n9(t.seconds,t.nanos)}convertDocumentKey(e,t){let n=re.fromString(e);s7(n)||nz();let r=new rN(n.get(1),n.get(3)),i=new rr(n.popFirst(5));return r.isEqual(t)||n$(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function hc(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}class hh extends hu{constructor(e){super(),this.firestore=e}convertBytes(e){return new cS(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new u3(this.firestore,null,t)}}class hd{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class hf extends c1{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new hp(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let n=this._document.data.field(c3("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class hp extends hf{data(e={}){return super.data(e)}}class hm{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new hd(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new hp(this._firestore,this._userDataWriter,n.key,n,new hd(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new nH(nW.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>{let r=new hp(e._firestore,e._userDataWriter,n.doc.key,n.doc,new hd(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}})}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{let r=new hp(e._firestore,e._userDataWriter,t.doc.key,t.doc,new hd(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(s=(n=n.add(t.doc)).indexOf(t.doc.key)),{type:function(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return nz()}}(t.type),doc:r,oldIndex:i,newIndex:s}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function hg(e,t){return e instanceof hf&&t instanceof hf?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof hm&&t instanceof hm&&e._firestore===t._firestore&&u7(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}class hy extends hu{constructor(e){super(),this.firestore=e}convertBytes(e){return new cS(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new u3(this.firestore,null,t)}}function hv(e,t,n){e=uJ(e,u3);let r=uJ(e.firestore,cb),i=hc(e.converter,t,n);return hI(r,[cM(cL(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,si.none())])}function hw(e,t,n,...r){e=uJ(e,u3);let i=uJ(e.firestore,cb),s=cL(i);return hI(i,[("string"==typeof(t=(0,y.m9)(t))||t instanceof ck?cG(s,"updateDoc",e._key,t,n,r):c$(s,"updateDoc",e._key,t)).toMutation(e._key,si.exists(!0))])}function hb(e,...t){let n,r,i;e=(0,y.m9)(e);let s={includeMetadataChanges:!1},a=0;"object"!=typeof t[0]||cv(t[a])||(s=t[a],a++);let o={includeMetadataChanges:s.includeMetadataChanges};if(cv(t[a])){let e=t[a];t[a]=null==(l=e.next)?void 0:l.bind(e),t[a+1]=null==(u=e.error)?void 0:u.bind(e),t[a+2]=null==(c=e.complete)?void 0:c.bind(e)}if(e instanceof u3)r=uJ(e.firestore,cb),i=iU(e._key.path),n={next:n=>{t[a]&&t[a](h_(r,e,n))},error:t[a+1],complete:t[a+2]};else{let s=uJ(e,u6);r=uJ(s.firestore,cb),i=s._query;let o=new hy(r);n={next:e=>{t[a]&&t[a](new hm(r,o,s,e))},error:t[a+1],complete:t[a+2]},c6(e._query)}var l,u,c,h=cI(r),d=i;let f=new ct(n),p=new un(d,f,o);return h.asyncQueue.enqueueAndForget(async()=>l9(await cp(h),p)),()=>{f.bc(),h.asyncQueue.enqueueAndForget(async()=>l8(await cp(h),p))}}function hI(e,t){var n=cI(e);let r=new nQ;return n.asyncQueue.enqueueAndForget(async()=>ug(await cf(n),t,r)),r.promise}function h_(e,t,n){let r=n.docs.get(t._key),i=new hy(e);return new hf(e,i,t._key,r,new hd(n.hasPendingWrites,n.fromCache),t.converter)}let hE={maxAttempts:5};class hT{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=cL(e)}set(e,t,n){this._verifyNotCommitted();let r=hS(e,this._firestore),i=hc(r.converter,t,n),s=cM(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(s.toMutation(r._key,si.none())),this}update(e,t,n,...r){let i;this._verifyNotCommitted();let s=hS(e,this._firestore);return i="string"==typeof(t=(0,y.m9)(t))||t instanceof ck?cG(this._dataReader,"WriteBatch.update",s._key,t,n,r):c$(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(i.toMutation(s._key,si.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=hS(e,this._firestore);return this._mutations=this._mutations.concat(new sm(t._key,si.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new nH(nW.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function hS(e,t){if((e=(0,y.m9)(e)).firestore!==t)throw new nH(nW.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class hk extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=cL(e)}get(e){let t=hS(e,this._firestore),n=new hh(this._firestore);return this._transaction.lookup([t._key]).then(e=>{if(!e||1!==e.length)return nz();let r=e[0];if(r.isFoundDocument())return new c1(this._firestore,n,r.key,r,t.converter);if(r.isNoDocument())return new c1(this._firestore,n,t._key,null,t.converter);throw nz()})}set(e,t,n){let r=hS(e,this._firestore),i=hc(r.converter,t,n),s=cM(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,s),this}update(e,t,n,...r){let i,s=hS(e,this._firestore);return i="string"==typeof(t=(0,y.m9)(t))||t instanceof ck?cG(this._dataReader,"Transaction.update",s._key,t,n,r):c$(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,i),this}delete(e){let t=hS(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=hS(e,this._firestore),n=new hy(this._firestore);return super.get(e).then(e=>new hf(this._firestore,n,t._key,e._document,new hd(!1,!1),t.converter))}}function hA(e,t){if(void 0===t)return{merge:!1};if(void 0!==t.mergeFields&&void 0!==t.merge)throw new nH("invalid-argument",`Invalid options passed to function ${e}(): You cannot specify both "merge" and "mergeFields".`);return t}function hC(){if("undefined"==typeof Uint8Array)throw new nH("unimplemented","Uint8Arrays are not available in this environment.")}function hD(){if("undefined"==typeof atob)throw new nH("unimplemented","Blobs are unavailable in Firestore in this environment.")}!function(e,t=!0){nV=p.SDK_VERSION,(0,p._registerComponent)(new m.wA("firestore",(e,{instanceIdentifier:n,options:r})=>{let i=e.getProvider("app").getImmediate(),s=new cb(new nZ(e.getProvider("auth-internal")),new n3(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new nH(nW.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new rN(e.options.projectId,t)}(i,n),i);return r=Object.assign({useFetchStreams:t},r),s._setSettings(r),s},"PUBLIC").setMultipleInstances(!0)),(0,p.registerVersion)(nF,"3.8.3",void 0),(0,p.registerVersion)(nF,"3.8.3","esm2017")}();class hN{constructor(e){this._delegate=e}static fromBase64String(e){return hD(),new hN(cS.fromBase64String(e))}static fromUint8Array(e){return hC(),new hN(cS.fromUint8Array(e))}toBase64(){return hD(),this._delegate.toBase64()}toUint8Array(){return hC(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function hR(e){var t=e,n=["next","error","complete"];if("object"!=typeof t||null===t)return!1;for(let e of n)if(e in t&&"function"==typeof t[e])return!0;return!1}class hx{enableIndexedDbPersistence(e,t){return function(e,t){cT(e=uJ(e,cb));let n=cI(e),r=e._freezeSettings(),i=new uz;return cE(n,i,new uG(i,r.cacheSizeBytes,null==t?void 0:t.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function(e){cT(e=uJ(e,cb));let t=cI(e),n=e._freezeSettings(),r=new uz;return cE(t,r,new uK(r,n.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){var t=e._delegate;if(t._initialized&&!t._terminated)throw new nH(nW.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let n=new nQ;return t._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(e){if(!rv.C())return Promise.resolve();await rv.delete(e+"main")}(oZ(t._databaseId,t._persistenceKey)),n.resolve()}catch(e){n.reject(e)}}),n.promise}}class hO{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof rN||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){let t=this._delegate._getSettings();e.merge||t.host===e.host||nG("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,n={}){!function(e,t,n,r={}){var i;let s=(e=uJ(e,u2))._getSettings();if("firestore.googleapis.com"!==s.host&&s.host!==t&&nG("Host has been set in both settings() and useEmulator(), emulator host will be used"),e._setSettings(Object.assign(Object.assign({},s),{host:`${t}:${n}`,ssl:!1})),r.mockUserToken){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=nU.MOCK_USER;else{t=(0,y.Sg)(r.mockUserToken,null==(i=e._app)?void 0:i.options.projectId);let s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new nH(nW.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new nU(s)}e._authCredentials=new nJ(new nY(t,n))}}(this._delegate,e,t,n)}enableNetwork(){var e;return(e=cI(uJ(this._delegate,cb))).asyncQueue.enqueue(async()=>{let t=await cc(e),n=await cd(e);return t.setNetworkEnabled(!0),n._u.delete(0),lD(n)})}disableNetwork(){var e;return(e=cI(uJ(this._delegate,cb))).asyncQueue.enqueue(async()=>{let t=await cc(e),n=await cd(e);return t.setNetworkEnabled(!1),async function(e){e._u.add(0),await lN(e),e.gu.set("Offline")}(n)})}enablePersistence(e){let t=!1,n=!1;return e&&uH("synchronizeTabs",t=!!e.synchronizeTabs,"experimentalForceOwningTab",n=!!e.experimentalForceOwningTab),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){var e=this._delegate,t=cI(e=uJ(e,cb));let n=new nQ;return t.asyncQueue.enqueueAndForget(async()=>u_(await cf(t),n)),n.promise}onSnapshotsInSync(e){var t;return t=this._delegate,function(e,t){let n=new ct(t);return e.asyncQueue.enqueueAndForget(async()=>{var t;return t=await cp(e),void(t.Ru.add(n),n.next())}),()=>{n.bc(),e.asyncQueue.enqueueAndForget(async()=>{var t;return t=await cp(e),void t.Ru.delete(n)})}}(cI(t=uJ(t,cb)),cv(e)?e:{next:e})}get app(){if(!this._appCompat)throw new nH("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new hW(this,u5(this._delegate,e))}catch(e){throw hV(e,"collection()","Firestore.collection()")}}doc(e){try{return new hU(this,u9(this._delegate,e))}catch(e){throw hV(e,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new hG(this,function(e,t){if(e=uJ(e,u2),uW("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new nH(nW.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new u6(e,null,new iF(re.emptyPath(),t))}(this._delegate,e))}catch(e){throw hV(e,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return function(e,t,n){e=uJ(e,cb);let r=Object.assign(Object.assign({},hE),void 0);if(r.maxAttempts<1)throw new nH(nW.INVALID_ARGUMENT,"Max attempts must be at least 1");return function(e,t,n){let r=new nQ;return e.asyncQueue.enqueueAndForget(async()=>{let i=await cu(e).then(e=>e.datastore);new ci(e.asyncQueue,i,n,t,r).run()}),r.promise}(cI(e),n=>t(new hk(e,n)),r)}(this._delegate,t=>e(new hL(this,t)))}batch(){return cI(this._delegate),new hM(new hT(this._delegate,e=>hI(this._delegate,e)))}loadBundle(e){var t=this._delegate;let n=cI(t=uJ(t,cb)),r=new cw;return function(e,t,n,r){var i;let s=(i=lI(t),new cn(function(e,t){if(e instanceof Uint8Array)return ce(e,void 0);if(e instanceof ArrayBuffer)return ce(new Uint8Array(e),void 0);if(e instanceof ReadableStream)return e.getReader();throw Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof n?(new TextEncoder).encode(n):n),i));e.asyncQueue.enqueueAndForget(async()=>{var t;(async function(e,t,n){try{var r;let i=await t.getMetadata();if(await function(e,t){let n=sK(t.createTime);return e.persistence.runTransaction("hasNewerBundle","readonly",n=>e.Ns.getBundleMetadata(n,t.id)).then(e=>!!e&&e.createTime.compareTo(n)>=0)}(e.localStore,i))return await t.close(),n._completeWith({taskState:"Success",documentsLoaded:i.totalDocuments,bytesLoaded:i.totalBytes,totalDocuments:i.totalDocuments,totalBytes:i.totalBytes}),Promise.resolve(new Set);n._updateProgress(ua(i));let s=new us(i,e.localStore,t.yt),a=await t.mc();for(;a;){let e=await s.Fu(a);e&&n._updateProgress(e),a=await t.mc()}let o=await s.complete();return await uD(e,o.Lu,void 0),await (r=e.localStore,r.persistence.runTransaction("Save bundle","readwrite",e=>r.Ns.saveBundleMetadata(e,i))),n._completeWith(o.progress),Promise.resolve(o.Bu)}catch(e){return nG("SyncEngine",`Loading bundle failed with ${e}`),n._failWith(e),Promise.resolve(new Set)}})(t=await cf(e),s,r).then(e=>{t.sharedClientState.notifyBundleLoaded(e)})})}(n,t._databaseId,e,r),r}namedQuery(e){var t,n;return(t=this._delegate,(n=cI(t=uJ(t,cb)),n.asyncQueue.enqueue(async()=>{var t;return t=await ch(n),t.persistence.runTransaction("Get named query","readonly",n=>t.Ns.getNamedQuery(n,e))})).then(e=>e?new u6(t,null,e.query):null)).then(e=>e?new hG(this,e):null)}}class hP extends hu{constructor(e){super(),this.firestore=e}convertBytes(e){return new hN(new cS(e))}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return hU.forKey(t,this.firestore,null)}}class hL{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new hP(e)}get(e){let t=uJ(e,u3);return this._delegate.get(t).then(e=>new hj(this._firestore,new hf(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,t.converter)))}set(e,t,n){let r=uJ(e,u3);return n?(hA("Transaction.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){let i=uJ(e,u3);return 2==arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,n,...r),this}delete(e){let t=uJ(e,u3);return this._delegate.delete(t),this}}class hM{constructor(e){this._delegate=e}set(e,t,n){let r=uJ(e,u3);return n?(hA("WriteBatch.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){let i=uJ(e,u3);return 2==arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,n,...r),this}delete(e){let t=uJ(e,u3);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class hF{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){let n=new hp(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new h$(this._firestore,n),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){let n=hF.INSTANCES,r=n.get(e);r||(r=new WeakMap,n.set(e,r));let i=r.get(t);return i||(i=new hF(e,new hP(e),t),r.set(t,i)),i}}hF.INSTANCES=new WeakMap;class hU{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new hP(e)}static forPath(e,t,n){if(e.length%2!=0)throw new nH("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new hU(t,new u3(t._delegate,n,new rr(e)))}static forKey(e,t,n){return new hU(t,new u3(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new hW(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new hW(this.firestore,u5(this._delegate,e))}catch(e){throw hV(e,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=(0,y.m9)(e))instanceof u3&&u8(this._delegate,e)}set(e,t){t=hA("DocumentReference.set",t);try{if(t)return hv(this._delegate,e,t);return hv(this._delegate,e)}catch(e){throw hV(e,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{if(1==arguments.length)return hw(this._delegate,e);return hw(this._delegate,e,t,...n)}catch(e){throw hV(e,"updateDoc()","DocumentReference.update()")}}delete(){var e;return hI(uJ((e=this._delegate).firestore,cb),[new sm(e._key,si.none())])}onSnapshot(...e){let t=hq(e),n=hB(e,e=>new hj(this.firestore,new hf(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)));return hb(this._delegate,t,n)}get(e){return((null==e?void 0:e.source)==="cache"?function(e){e=uJ(e,u3);let t=uJ(e.firestore,cb),n=cI(t),r=new hy(t);return(function(e,t){let n=new nQ;return e.asyncQueue.enqueueAndForget(async()=>(async function(e,t,n){try{let r=await e.persistence.runTransaction("read document","readonly",n=>e.localDocuments.getDocument(n,t));r.isFoundDocument()?n.resolve(r):r.isNoDocument()?n.resolve(null):n.reject(new nH(nW.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(r){let e=l1(r,`Failed to get document '${t} from cache`);n.reject(e)}})(await ch(e),t,n)),n.promise})(n,e._key).then(n=>new hf(t,r,e._key,n,new hd(null!==n&&n.hasLocalMutations,!0),e.converter))}(this._delegate):(null==e?void 0:e.source)==="server"?function(e){e=uJ(e,u3);let t=uJ(e.firestore,cb);return cm(cI(t),e._key,{source:"server"}).then(n=>h_(t,e,n))}(this._delegate):function(e){e=uJ(e,u3);let t=uJ(e.firestore,cb);return cm(cI(t),e._key).then(n=>h_(t,e,n))}(this._delegate)).then(e=>new hj(this.firestore,new hf(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)))}withConverter(e){return new hU(this.firestore,e?this._delegate.withConverter(hF.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function hV(e,t,n){return e.message=e.message.replace(t,n),e}function hq(e){for(let t of e)if("object"==typeof t&&!hR(t))return t;return{}}function hB(e,t){var n,r;let i;return{next:e=>{i.next&&i.next(t(e))},error:null==(n=(i=hR(e[0])?e[0]:hR(e[1])?e[1]:"function"==typeof e[0]?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]}).error)?void 0:n.bind(i),complete:null==(r=i.complete)?void 0:r.bind(i)}}class hj{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new hU(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return hg(this._delegate,e._delegate)}}class h$ extends hj{data(e){let t=this._delegate.data(e);return void 0!==t||nz(),t}}class hG{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new hP(e)}where(e,t,n){try{return new hG(this.firestore,c9(this._delegate,function(e,t,n){let r=c3("where",e);return c8._create(r,t,n)}(e,t,n)))}catch(e){throw hV(e,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new hG(this.firestore,c9(this._delegate,function(e,t="asc"){let n=c3("orderBy",e);return he._create(n,t)}(e,t)))}catch(e){throw hV(e,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new hG(this.firestore,c9(this._delegate,(uZ("limit",e),ht._create("limit",e,"F"))))}catch(e){throw hV(e,"limit()","Query.limit()")}}limitToLast(e){try{return new hG(this.firestore,c9(this._delegate,(uZ("limitToLast",e),ht._create("limitToLast",e,"L"))))}catch(e){throw hV(e,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new hG(this.firestore,c9(this._delegate,function(...e){return hn._create("startAt",e,!0)}(...e)))}catch(e){throw hV(e,"startAt()","Query.startAt()")}}startAfter(...e){try{return new hG(this.firestore,c9(this._delegate,function(...e){return hn._create("startAfter",e,!1)}(...e)))}catch(e){throw hV(e,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new hG(this.firestore,c9(this._delegate,function(...e){return hr._create("endBefore",e,!1)}(...e)))}catch(e){throw hV(e,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new hG(this.firestore,c9(this._delegate,function(...e){return hr._create("endAt",e,!0)}(...e)))}catch(e){throw hV(e,"endAt()","Query.endAt()")}}isEqual(e){return u7(this._delegate,e._delegate)}get(e){return((null==e?void 0:e.source)==="cache"?function(e){e=uJ(e,u6);let t=uJ(e.firestore,cb),n=cI(t),r=new hy(t);return(function(e,t){let n=new nQ;return e.asyncQueue.enqueueAndForget(async()=>(async function(e,t,n){try{let r=await o8(e,t,!0),i=new uu(t,r.Hi),s=i.Wu(r.documents),a=i.applyChanges(s,!1);n.resolve(a.snapshot)}catch(r){let e=l1(r,`Failed to execute query '${t} against cache`);n.reject(e)}})(await ch(e),t,n)),n.promise})(n,e._query).then(n=>new hm(t,r,e,n))}(this._delegate):(null==e?void 0:e.source)==="server"?function(e){e=uJ(e,u6);let t=uJ(e.firestore,cb),n=cI(t),r=new hy(t);return cg(n,e._query,{source:"server"}).then(n=>new hm(t,r,e,n))}(this._delegate):function(e){e=uJ(e,u6);let t=uJ(e.firestore,cb),n=cI(t),r=new hy(t);return c6(e._query),cg(n,e._query).then(n=>new hm(t,r,e,n))}(this._delegate)).then(e=>new hz(this.firestore,new hm(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)))}onSnapshot(...e){let t=hq(e),n=hB(e,e=>new hz(this.firestore,new hm(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)));return hb(this._delegate,t,n)}withConverter(e){return new hG(this.firestore,e?this._delegate.withConverter(hF.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}class hK{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new h$(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class hz{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new hG(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new h$(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(e=>new hK(this._firestore,e))}forEach(e,t){this._delegate.forEach(n=>{e.call(t,new h$(this._firestore,n))})}isEqual(e){return hg(this._delegate,e._delegate)}}class hW extends hG{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let e=this._delegate.parent;return e?new hU(this.firestore,e):null}doc(e){try{if(void 0===e)return new hU(this.firestore,u9(this._delegate));return new hU(this.firestore,u9(this._delegate,e))}catch(e){throw hV(e,"doc()","CollectionReference.doc()")}}add(e){return(function(e,t){let n=uJ(e.firestore,cb),r=u9(e),i=hc(e.converter,t);return hI(n,[cM(cL(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,si.exists(!1))]).then(()=>r)})(this._delegate,e).then(e=>new hU(this.firestore,e))}isEqual(e){return u8(this._delegate,e._delegate)}withConverter(e){return new hW(this.firestore,e?this._delegate.withConverter(hF.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}class hH{constructor(...e){this._delegate=new ck(...e)}static documentId(){return new hH(rn.keyField().canonicalString())}isEqual(e){return(e=(0,y.m9)(e))instanceof ck&&this._delegate._internalPath.isEqual(e._internalPath)}}class hQ{constructor(e){this._delegate=e}static serverTimestamp(){let e=new cV("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new hQ(e)}static delete(){let e=new cF("deleteField");return e._methodName="FieldValue.delete",new hQ(e)}static arrayUnion(...e){let t=function(...e){return new cq("arrayUnion",e)}(...e);return t._methodName="FieldValue.arrayUnion",new hQ(t)}static arrayRemove(...e){let t=function(...e){return new cB("arrayRemove",e)}(...e);return t._methodName="FieldValue.arrayRemove",new hQ(t)}static increment(e){let t=new cj("increment",e);return t._methodName="FieldValue.increment",new hQ(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}s=i=f.Z,s.INTERNAL.registerComponent(new m.wA("firestore-compat",e=>((e,t)=>new hO(e,t,new hx))(e.getProvider("app-compat").getImmediate(),e.getProvider("firestore").getImmediate()),"PUBLIC").setServiceProps(Object.assign({},{Firestore:hO,GeoPoint:cC,Timestamp:n9,Blob:hN,Transaction:hL,WriteBatch:hM,DocumentReference:hU,DocumentSnapshot:hj,Query:hG,QueryDocumentSnapshot:h$,QuerySnapshot:hz,CollectionReference:hW,FieldPath:hH,FieldValue:hQ,setLogLevel:function(e){nq.setLogLevel(e)},CACHE_SIZE_UNLIMITED:-1}))),i.registerVersion("@firebase/firestore-compat","0.3.3")},16583:function(e,t,n){"use strict";n.d(t,{s:()=>s});var r,i=(r=function(e,t){return(r=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),s=function(e){function t(t){var n,r,i,s,a=this.constructor,o=e.call(this,t)||this;return Object.defineProperty(o,"name",{value:a.name,enumerable:!1,configurable:!0}),n=a.prototype,(r=Object.setPrototypeOf)?r(o,n):o.__proto__=n,void 0===i&&(i=o.constructor),(s=Error.captureStackTrace)&&s(o,i),o}return i(t,e),t}(Error)},7879:function(){"use strict";var e,t,n,r,i=null,s=function(e){"hidden"===document.visibilityState&&i>-1&&(i="visibilitychange"===e.type?e.timeStamp:0,a())},a=function(){removeEventListener("visibilitychange",s,!0),removeEventListener("prerenderingchange",s,!0)},o=new Date,l=function(r,i){e||(e=i,t=r,n=new Date,h(removeEventListener),u())},u=function(){if(t>=0&&t<n-o){var i={entryType:"first-input",name:e.type,target:e.target,cancelable:e.cancelable,startTime:e.timeStamp,processingStart:e.timeStamp+t};r.forEach(function(e){e(i)}),r=[]}},c=function(e){if(e.cancelable){var t,n,r,i=(e.timeStamp>1e12?new Date:performance.now())-e.timeStamp;"pointerdown"==e.type?(t=function(){l(i,e),r()},n=function(){r()},r=function(){removeEventListener("pointerup",t,null),removeEventListener("pointercancel",n,null)},addEventListener("pointerup",t,null),addEventListener("pointercancel",n,null)):l(i,e)}},h=function(e){["mousedown","keydown","touchstart","pointerdown"].forEach(function(t){return e(t,c,null)})}}}]);